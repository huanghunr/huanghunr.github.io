<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>常见加密和编码 | huanghunr's Blog</title><meta name="author" content="huanghunr"><meta name="copyright" content="huanghunr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#FFF8F0"><meta name="description" content="整理常见的加解密、编码脚本">
<meta property="og:type" content="article">
<meta property="og:title" content="常见加密和编码">
<meta property="og:url" content="http://example.com/2024/12/31/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86/index.html">
<meta property="og:site_name" content="huanghunr&#39;s Blog">
<meta property="og:description" content="整理常见的加解密、编码脚本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://huanghunr-blog.oss-cn-hangzhou.aliyuncs.com/website/img/qiaomi1.jpg">
<meta property="article:published_time" content="2024-12-30T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-09T16:00:00.000Z">
<meta property="article:author" content="huanghunr">
<meta property="article:tag" content="加解密、编码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://huanghunr-blog.oss-cn-hangzhou.aliyuncs.com/website/img/qiaomi1.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "常见加密和编码",
  "url": "http://example.com/2024/12/31/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86/",
  "image": "https://huanghunr-blog.oss-cn-hangzhou.aliyuncs.com/website/img/qiaomi1.jpg",
  "datePublished": "2024-12-30T16:00:00.000Z",
  "dateModified": "2025-08-09T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "huanghunr",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2024/12/31/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#402218')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#FFF8F0')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '常见加密和编码',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/tx4.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://huanghunr-blog.oss-cn-hangzhou.aliyuncs.com/website/img/qiaomi1.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">huanghunr's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">常见加密和编码</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">常见加密和编码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-12-30T16:00:00.000Z" title="Created 2024-12-31 00:00:00">2024-12-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-09T16:00:00.000Z" title="Updated 2025-08-10 00:00:00">2025-08-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/re%E5%AD%A6%E4%B9%A0/">re学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">23.5k</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h2><p>一种基于64个可打印的字符来表示二进制的数据的一种方法。</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1868972">https://cloud.tencent.com/developer/article/1868972</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Hp4y1g7Ex/?spm_id_from=333.1387.upload.video_card.click">动画演示</a></p>
<p>总的来说就是把原数据的二进制按3字节分块，后再按6位二进制分成4块，然后在每组二进制前面补00，变成8位（一块二进制内少于6位在末尾补0，三字节数据块内存在空字节就用等号补上。），按分块的二进制表示的值为索引到表中去寻找对应的元素。</p>
<p>解码时按4字节到表中寻找元素后计算索引按三字节恢复就行。</p>
<p>源码解读，来自</p>
<p> <a target="_blank" rel="noopener" href="https://gitcode.com/g310773517/base64/overview?isLogin=1">https://gitcode.com/g310773517/base64/overview?isLogin=1</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//base64查询表</span></span><br><span class="line"><span class="type">char</span>* base64_encodetable = (<span class="type">char</span>*)<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//base64反查询表</span></span><br><span class="line"><span class="type">char</span> base64_decodetable[<span class="number">128</span>] = &#123;     <span class="comment">//把结果的索引与结果进行映射，可以直接按下标查找</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//0-7</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//8-15</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//16-23</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//24-31</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//32-39</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">62</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">63</span>, <span class="comment">//40-47, + /</span></span><br><span class="line">	<span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="comment">//48-55, 0-7</span></span><br><span class="line">	<span class="number">60</span>, <span class="number">61</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>,  <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//56-63, 8-9</span></span><br><span class="line">	<span class="number">-1</span>,  <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="comment">//64-71, A-G</span></span><br><span class="line">	 <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="comment">//72-79, H-O</span></span><br><span class="line">	<span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="comment">//80-87, P-W</span></span><br><span class="line">	<span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//88-95, X-Z</span></span><br><span class="line">	<span class="number">-1</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="comment">//96-103, a-g</span></span><br><span class="line">	<span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="comment">//104-111, h-o</span></span><br><span class="line">	<span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="comment">//112-119, p-w</span></span><br><span class="line">	<span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="comment">//120-127, x-z</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//数字字符串表</span></span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* num_table = (<span class="type">char</span>*)<span class="string">&quot;0123456789&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char类型数转换为2进制字符串格式, 如2-&gt;&quot;10&quot;, 6-&gt;&quot;110&quot;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">char</span>* <span class="title">char2binstr</span><span class="params">(<span class="type">char</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> binstr[<span class="number">9</span>] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取到每一位之后，查表得到对应的字符拼接成一个字符串</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">		binstr[<span class="number">7</span> - i] = num_table[(value &amp; (<span class="number">0x1</span> &lt;&lt; i)) &gt;&gt; i];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> _strdup(binstr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2进制字符串格式数据转换为char类型数，如&quot;10&quot;-&gt;2, &quot;110&quot;-&gt;6</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">char</span> <span class="title">binstr2char</span><span class="params">(<span class="type">char</span>* binstr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> value = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!binstr)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	length = <span class="built_in">strlen</span>(binstr);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取得2进制字符串的每一个字节，将其转化对应的数字，然后还原数据。</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">		value += (binstr[length - <span class="number">1</span> - i] - <span class="number">0x30</span>) &lt;&lt; i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Base64编码说明</span></span><br><span class="line"><span class="comment"> *  Base64编码要求把3个8位字节（3*8=24）转化为4个6位的字节（4*6=24），之后在6位的前面补两个0，形成8位一个字节的形式。</span></span><br><span class="line"><span class="comment"> *  如果剩下的字符不足3个字节，则用0填充，输出字符使用&#x27;=&#x27;，因此编码后输出的文本末尾可能会出现1或2个&#x27;=&#x27;。</span></span><br><span class="line"><span class="comment"> *  Base64制定了一个编码表，以便进行统一转换。编码表的大小为2^6=64，这也是Base64名称的由来。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* _base64_section_encode(<span class="type">char</span>* src, <span class="type">int</span> length)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> dest[<span class="number">5</span>] = <span class="string">&quot;====&quot;</span>;</span><br><span class="line">	<span class="type">char</span> binstr[<span class="number">33</span>] = <span class="string">&quot;000000000000000000000000&quot;</span>;</span><br><span class="line">	<span class="type">char</span> tmp[<span class="number">7</span>] = &#123;&#125;;</span><br><span class="line">	<span class="type">char</span>* tmp1 = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//每字节8位，每次转换3字节，不足3字节时，高位补0</span></span><br><span class="line">	<span class="comment">//先拼接一个完整的24字节2进制字符串</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">		tmp1 = <span class="built_in">char2binstr</span>(src[i]);</span><br><span class="line">		<span class="built_in">strncpy</span>((<span class="type">char</span>*)binstr + i * <span class="number">8</span>, tmp1, <span class="number">8</span>);</span><br><span class="line">		<span class="built_in">free</span>(tmp1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//24字节，分4组，每组6字节，将每组转换为数字格式,每个数字查表得到对应码。</span></span><br><span class="line">	<span class="comment">//3种情况：</span></span><br><span class="line">	<span class="comment">// 1. 如果最后剩下1个数据，编码结果后加2个=，即查表2次，查表次数正好是数据字节数 + 1</span></span><br><span class="line">	<span class="comment">// 2. 如果最后剩下2个数据，编码结果后加1个=，即查表3次</span></span><br><span class="line">	<span class="comment">// 3. 如果没有剩下任何数据(剩下3个数据)，就什么都不要加,即查表4次</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length + <span class="number">1</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">strncpy</span>(tmp, binstr + <span class="number">6</span> * i, <span class="number">6</span>);</span><br><span class="line">		dest[i] = base64_encodetable[<span class="built_in">binstr2char</span>(tmp)];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> _strdup(dest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输入原始内容和长度，得到base64编码</span></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">base64_encode</span><span class="params">(<span class="type">char</span>* src, <span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* base64code = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> codelength = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* tmp = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//每3个字节一组转化为4字节（每6位一组得到4组，转换为新字符），不足3字节的填充到3字节进行转化。</span></span><br><span class="line">	<span class="comment">//因此计算共有多少组转换后的4字节乘以4就是编码后的长度</span></span><br><span class="line">	codelength = ((length / <span class="number">3</span>) + (length % <span class="number">3</span> &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>)) * <span class="number">4</span>;</span><br><span class="line">	base64code = (<span class="type">char</span>*)<span class="built_in">malloc</span>(codelength + <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">memset</span>(base64code, <span class="number">0</span>, codelength + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length / <span class="number">3</span>; i++) &#123;</span><br><span class="line">		tmp = _base64_section_encode(src + i * <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">		<span class="built_in">strcat</span>(base64code, tmp);</span><br><span class="line">		<span class="built_in">free</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (length % <span class="number">3</span>) &#123;</span><br><span class="line">		tmp = _base64_section_encode(src + length - (length % <span class="number">3</span>), length % <span class="number">3</span>);</span><br><span class="line">		<span class="built_in">strcat</span>(base64code, tmp);</span><br><span class="line">		<span class="built_in">free</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> base64code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4字节反转化为3字节</span></span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* _base64_section_decode(<span class="type">char</span>* dest)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> src[<span class="number">3</span>] = &#123;&#125;;</span><br><span class="line">	<span class="type">char</span> tmp[<span class="number">9</span>] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(src, <span class="number">0</span>, <span class="built_in">sizeof</span>(src) / <span class="built_in">sizeof</span>(src[<span class="number">0</span>]));</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">strncpy</span>(tmp, dest + <span class="number">8</span> * i, <span class="number">8</span>);</span><br><span class="line">		src[i] = <span class="built_in">binstr2char</span>(tmp);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> src;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">base64_decode_length</span><span class="params">(<span class="type">char</span>* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> padding_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (src[<span class="built_in">strlen</span>(src) - <span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">		padding_count++;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (src[<span class="built_in">strlen</span>(src) - <span class="number">2</span>] == <span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">		padding_count++;</span><br><span class="line"></span><br><span class="line">	length = <span class="built_in">strlen</span>(src) / <span class="number">4</span> * <span class="number">3</span> - padding_count;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输入base64编码后文本，解码出原始内容</span></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">base64_decode</span><span class="params">(<span class="type">char</span>* src, <span class="type">int</span>* destlen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* binstr = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> binstr_length = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* tmp = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">char</span>* tmp1 = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">char</span>* dest = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	binstr_length = <span class="built_in">strlen</span>(src) * <span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line">	binstr = (<span class="type">char</span>*)<span class="built_in">malloc</span>(binstr_length);</span><br><span class="line">	<span class="built_in">memset</span>(binstr, <span class="number">0</span>, binstr_length);</span><br><span class="line"></span><br><span class="line">	*destlen = <span class="built_in">base64_decode_length</span>(src);</span><br><span class="line">	dest = (<span class="type">char</span>*)<span class="built_in">malloc</span>(*destlen);</span><br><span class="line">	<span class="built_in">memset</span>(dest, <span class="number">0</span>, *destlen);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(src) / <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			tmp1 = <span class="built_in">char2binstr</span>(base64_decodetable[src[i * <span class="number">4</span> + j]]);</span><br><span class="line">			<span class="built_in">strcat</span>(binstr, tmp1 + <span class="number">2</span>);</span><br><span class="line">			<span class="built_in">free</span>(tmp1);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(src) / <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="comment">//因为_base64_section_decode函数每次固定返回3字节数据，此处需要根据提前计算出来的解码总长度和已解码长度来判断最后1次需要拷贝的准确数据量。</span></span><br><span class="line">		tmp = _base64_section_decode(binstr + i * <span class="number">24</span>);</span><br><span class="line">		<span class="built_in">memmove</span>(dest + i * <span class="number">3</span>, tmp, *destlen - cnt &lt; <span class="number">3</span> ? *destlen - cnt : <span class="number">3</span>);</span><br><span class="line">		cnt += <span class="number">3</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">free</span>(binstr);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> a[<span class="number">10</span>] = <span class="string">&quot;systema&quot;</span>;</span><br><span class="line">	<span class="type">char</span> * b = <span class="built_in">base64_encode</span>(a, <span class="built_in">strlen</span>(a));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="一般形式（特征）"><a href="#一般形式（特征）" class="headerlink" title="一般形式（特征）"></a>一般形式（特征）</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">encodeBase64</span><span class="params">(<span class="type">char</span>* str, <span class="type">int</span> len )</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> base64[<span class="number">65</span>] = <span class="string">&quot;stuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr&quot;</span>;</span><br><span class="line">    <span class="comment">//读取3个字节zxc，转换为二进制01111010 01111000 01100011</span></span><br><span class="line">    <span class="comment">//转换为4个6位字节，011110 100111 100001 100011</span></span><br><span class="line">    <span class="comment">//不足8位在前补0，变成00011110 00100111 00100001 00100011</span></span><br><span class="line">    <span class="comment">//若剩余的字节数不足以构成4个字节，补等号</span></span><br><span class="line">    <span class="type">int</span> encodeStrLen = <span class="number">1</span> + (len / <span class="number">3</span>) * <span class="number">4</span>, k = <span class="number">0</span>;</span><br><span class="line">    encodeStrLen += len % <span class="number">3</span> ? <span class="number">4</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span>* encodeStr = (<span class="type">char</span>*)(<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>) * encodeStrLen));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (len - i &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">            encodeStr[k++] = base64[(<span class="type">unsigned</span> <span class="type">char</span>)str[i] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            <span class="type">unsigned</span> <span class="type">char</span> a = ((<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x03</span>) ;</span><br><span class="line">            <span class="type">unsigned</span> <span class="type">char</span> b = (<span class="type">unsigned</span> <span class="type">char</span>)str[++i];</span><br><span class="line">            <span class="type">unsigned</span> <span class="type">char</span> c = a &lt;&lt; <span class="number">4</span> | b &gt;&gt; <span class="number">4</span>;</span><br><span class="line">            encodeStr[k++] = base64[ c];</span><br><span class="line">            a = ((<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x0f</span>);</span><br><span class="line">            b = (<span class="type">unsigned</span> <span class="type">char</span>)str[++i];</span><br><span class="line">            c = a &lt;&lt; <span class="number">2</span> | b &gt;&gt; <span class="number">6</span>;</span><br><span class="line">            encodeStr[k++] = base64[c ];</span><br><span class="line">            encodeStr[k++] = base64[(<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x3f</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (len - i == <span class="number">2</span>) &#123;</span><br><span class="line">            encodeStr[k++] = base64[(<span class="type">unsigned</span> <span class="type">char</span>)str[i] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            encodeStr[k++] = base64[((<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span> | ((<span class="type">unsigned</span> <span class="type">char</span>)str[++i] &gt;&gt; <span class="number">4</span>)];</span><br><span class="line">            encodeStr[k++] = base64[((<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x0f</span>) &lt;&lt; <span class="number">2</span>];</span><br><span class="line">            encodeStr[k++] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            encodeStr[k++] = base64[(<span class="type">unsigned</span> <span class="type">char</span>)str[i] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            encodeStr[k++] = base64[((<span class="type">unsigned</span> <span class="type">char</span>)str[i] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>];                                                                                                              <span class="comment">//末尾补两个等于号</span></span><br><span class="line">            encodeStr[k++] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            encodeStr[k++] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    encodeStr[k] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> encodeStr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解码既编码的逆过程，先找出编码后的字符在编码之前代表的数字</span></span><br><span class="line"><span class="comment">* 编码中将3位个字符变成4个字符，得到这4个字符的每个字符代表的原本数字</span></span><br><span class="line"><span class="comment">* 因为在编码中间每个字符用base64码表进行了替换，所以这里要先换回来</span></span><br><span class="line"><span class="comment">* 在对换回来的数字进行位运算使其还原成3个字符</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">decodeBase64</span><span class="params">(<span class="type">char</span>* str, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> base64[<span class="number">65</span>] = <span class="string">&quot;stuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ascill[<span class="number">129</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;table\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">        ascill[base64[i]] = k++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">129</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>, ascill[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> decodeStrlen = len / <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span>* decodeStr = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>) * decodeStrlen);</span><br><span class="line">    k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> a, b, c;</span><br><span class="line">        a = ascill[str[i]];</span><br><span class="line">        b = ascill[str[++i]];</span><br><span class="line">        c = (a &lt;&lt; <span class="number">2</span>) | (b &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        decodeStr[k++] = c;</span><br><span class="line">        <span class="keyword">if</span> (str[i + <span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a = ascill[str[i]];</span><br><span class="line">        b = ascill[str[++i]];</span><br><span class="line">        c = (a &lt;&lt; <span class="number">4</span>) |( b &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        decodeStr[k++] = c;</span><br><span class="line">        <span class="keyword">if</span> (str[i + <span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a = ascill[str[i]];</span><br><span class="line">        b = ascill[str[++i]];</span><br><span class="line">        c = (a &lt;&lt; <span class="number">6</span>) | (b);</span><br><span class="line">        decodeStr[k++] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    decodeStr[k] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= k; i++) &#123;</span><br><span class="line">        str[i] = decodeStr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(decodeStr);</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> input[<span class="number">100</span>] = &#123; &#125;;</span><br><span class="line">	<span class="type">char</span> dec[<span class="number">100</span>] = &#123; &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Salsa20"><a href="#Salsa20" class="headerlink" title="Salsa20"></a>Salsa20</h2><p>需要的数据：8字节的随机数noce，128位或256位的密钥，不定长度明文&#x2F;密文，一个16字节密钥拓展常量”expand 32-byte k”，一个常量[0x61707865, 0x3320646e, 0x79622d32, 0x6b206574]。</p>
<p>加密流程，密钥拓展-&gt;把拓展的密钥和随机数，计数器，常量排列成一个4x4的矩阵，每个元素4字节-&gt;行列分别多轮加密每行&#x2F;列3个为一组加密-&gt;把矩阵拆分成单字节的盒-&gt;明文与盒异或</p>
<h3 id="加解密脚本"><a href="#加解密脚本" class="headerlink" title="加解密脚本"></a>加解密脚本</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">s20_status_t</span>  //返回加解密结果状态</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    S20_SUCCESS,</span><br><span class="line">    S20_FAILURE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">s20_keylen_t</span>  //<span class="title">salsa20</span>支持128和256位密钥</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    S20_KEYLEN_256,</span><br><span class="line">    S20_KEYLEN_128</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">rotl</span><span class="params">(<span class="type">uint32_t</span> value, <span class="type">int</span> shift)</span>   <span class="comment">//32位数据位移交换操作</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (value &lt;&lt; shift) | (value &gt;&gt; (<span class="number">32</span> - shift));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_quarterround</span><span class="params">(<span class="type">uint32_t</span>* y0, <span class="type">uint32_t</span>* y1, <span class="type">uint32_t</span>* y2, <span class="type">uint32_t</span>* y3)</span>  <span class="comment">//行列加密逻辑</span></span><br><span class="line">&#123;</span><br><span class="line">    *y1 = *y1 ^ rotl(*y0 + *y3, <span class="number">7</span>);</span><br><span class="line">    *y2 = *y2 ^ rotl(*y1 + *y0, <span class="number">9</span>);</span><br><span class="line">    *y3 = *y3 ^ rotl(*y2 + *y1, <span class="number">13</span>);</span><br><span class="line">    *y0 = *y0 ^ rotl(*y3 + *y2, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_rowround</span><span class="params">(<span class="type">uint32_t</span> y[<span class="number">16</span>])</span>  <span class="comment">//列加密</span></span><br><span class="line">&#123;</span><br><span class="line">    s20_quarterround(&amp;y[<span class="number">0</span>], &amp;y[<span class="number">1</span>], &amp;y[<span class="number">2</span>], &amp;y[<span class="number">3</span>]);</span><br><span class="line">    s20_quarterround(&amp;y[<span class="number">5</span>], &amp;y[<span class="number">6</span>], &amp;y[<span class="number">7</span>], &amp;y[<span class="number">4</span>]);</span><br><span class="line">    s20_quarterround(&amp;y[<span class="number">10</span>], &amp;y[<span class="number">11</span>], &amp;y[<span class="number">8</span>], &amp;y[<span class="number">9</span>]);</span><br><span class="line">    s20_quarterround(&amp;y[<span class="number">15</span>], &amp;y[<span class="number">12</span>], &amp;y[<span class="number">13</span>], &amp;y[<span class="number">14</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_columnround</span><span class="params">(<span class="type">uint32_t</span> x[<span class="number">16</span>])</span>    <span class="comment">//行加密</span></span><br><span class="line">&#123;</span><br><span class="line">    s20_quarterround(&amp;x[<span class="number">0</span>], &amp;x[<span class="number">4</span>], &amp;x[<span class="number">8</span>], &amp;x[<span class="number">12</span>]);</span><br><span class="line">    s20_quarterround(&amp;x[<span class="number">5</span>], &amp;x[<span class="number">9</span>], &amp;x[<span class="number">13</span>], &amp;x[<span class="number">1</span>]);</span><br><span class="line">    s20_quarterround(&amp;x[<span class="number">10</span>], &amp;x[<span class="number">14</span>], &amp;x[<span class="number">2</span>], &amp;x[<span class="number">6</span>]);</span><br><span class="line">    s20_quarterround(&amp;x[<span class="number">15</span>], &amp;x[<span class="number">3</span>], &amp;x[<span class="number">7</span>], &amp;x[<span class="number">11</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_doubleround</span><span class="params">(<span class="type">uint32_t</span> x[<span class="number">16</span>])</span>  <span class="comment">//行列加密，这次就是一轮加密</span></span><br><span class="line">&#123;</span><br><span class="line">    s20_columnround(x);</span><br><span class="line">    s20_rowround(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates a little-endian word from 4 bytes pointed to by b</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">s20_littleendian</span><span class="params">(<span class="type">uint8_t</span>* b)</span>  <span class="comment">//端序转化，字节数据转小端序4字节</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> b[<span class="number">0</span>] +</span><br><span class="line">        ((<span class="type">uint_fast16_t</span>)b[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) +</span><br><span class="line">        ((<span class="type">uint_fast32_t</span>)b[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) +</span><br><span class="line">        ((<span class="type">uint_fast32_t</span>)b[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Moves the little-endian word into the 4 bytes pointed to by b</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_rev_littleendian</span><span class="params">(<span class="type">uint8_t</span>* b, <span class="type">uint32_t</span> w)</span>  <span class="comment">//4字节按小端序转字节数据</span></span><br><span class="line">&#123;</span><br><span class="line">    b[<span class="number">0</span>] = w;</span><br><span class="line">    b[<span class="number">1</span>] = w &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    b[<span class="number">2</span>] = w &gt;&gt; <span class="number">16</span>;</span><br><span class="line">    b[<span class="number">3</span>] = w &gt;&gt; <span class="number">24</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The core function of Salsa20</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_hash</span><span class="params">(<span class="type">uint8_t</span> seq[<span class="number">64</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> x[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint32_t</span> z[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i)</span><br><span class="line">        x[i] = z[i] = s20_littleendian(seq + (<span class="number">4</span> * i)); <span class="comment">//转成4字节分组加密</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)  <span class="comment">//轮加密</span></span><br><span class="line">        s20_doubleround(z);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        z[i] += x[i];</span><br><span class="line">        s20_rev_littleendian(seq + (<span class="number">4</span> * i), z[i]);  <span class="comment">//转成单字节生成盒</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The 16-byte (128-bit) key expansion function</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_expand16</span><span class="params">(<span class="type">uint8_t</span>* k,  <span class="comment">//密钥拓展</span></span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> n[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> keystream[<span class="number">64</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="comment">// The constants specified by the Salsa20 specification, &#x27;tau&#x27;</span></span><br><span class="line">    <span class="comment">// &quot;expand 16-byte k&quot;</span></span><br><span class="line">    <span class="type">uint8_t</span> t[<span class="number">4</span>][<span class="number">4</span>] = &#123;</span><br><span class="line">      &#123; <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;a&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;1&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;y&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;k&#x27;</span> &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy all of &#x27;tau&#x27; into the correct spots in our keystream block</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i += <span class="number">20</span>)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">            keystream[i + j] = t[i / <span class="number">20</span>][j];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy the key and the nonce into the keystream block</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        keystream[<span class="number">4</span> + i] = k[i];</span><br><span class="line">        keystream[<span class="number">44</span> + i] = k[i];</span><br><span class="line">        keystream[<span class="number">24</span> + i] = n[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s20_hash(keystream);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The 32-byte (256-bit) key expansion function</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s20_expand32</span><span class="params">(<span class="type">uint8_t</span>* k,</span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> n[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> keystream[<span class="number">64</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="comment">// The constants specified by the Salsa20 specification, &#x27;sigma&#x27;</span></span><br><span class="line">    <span class="comment">// &quot;expand 32-byte k&quot;</span></span><br><span class="line">    <span class="type">uint8_t</span> o[<span class="number">4</span>][<span class="number">4</span>] = &#123;</span><br><span class="line">      &#123; <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;a&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;3&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;y&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;k&#x27;</span> &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy all of &#x27;sigma&#x27; into the correct spots in our keystream block</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i += <span class="number">20</span>)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)</span><br><span class="line">            keystream[i + j] = o[i / <span class="number">20</span>][j];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy the key and the nonce into the keystream block</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        keystream[<span class="number">4</span> + i] = k[i];</span><br><span class="line">        keystream[<span class="number">44</span> + i] = k[i + <span class="number">16</span>];</span><br><span class="line">        keystream[<span class="number">24</span> + i] = n[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s20_hash(keystream);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="type">s20_status_t</span> <span class="title function_">s20_crypt</span><span class="params">(  <span class="comment">//加解密函数</span></span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span>* key,    <span class="comment">//密钥</span></span></span><br><span class="line"><span class="params">    <span class="keyword">enum</span> <span class="type">s20_keylen_t</span> keylen,  <span class="comment">//密钥长度</span></span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>],   <span class="comment">//随机数</span></span></span><br><span class="line"><span class="params">    <span class="type">uint32_t</span> si,   <span class="comment">//密钥偏移量，决定从什么时候使用密钥</span></span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span>* buf,  <span class="comment">//要输入的数据</span></span></span><br><span class="line"><span class="params">    <span class="type">uint32_t</span> buflen)</span>  <span class="comment">//数去的长度</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> keystream[<span class="number">64</span>];  <span class="comment">//密钥流，盒</span></span><br><span class="line">    <span class="type">uint8_t</span> n[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;  <span class="comment">//随机数和计数器</span></span><br><span class="line">    <span class="type">uint32_t</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> (*expand)(<span class="type">uint8_t</span>*, <span class="type">uint8_t</span>*, <span class="type">uint8_t</span>*) = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (keylen == S20_KEYLEN_256)</span><br><span class="line">        expand = s20_expand32;</span><br><span class="line">    <span class="keyword">if</span> (keylen == S20_KEYLEN_128)</span><br><span class="line">        expand = s20_expand16;      </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (expand == <span class="literal">NULL</span> || key == <span class="literal">NULL</span> || nonce == <span class="literal">NULL</span> || buf == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> S20_FAILURE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">        n[i] = nonce[i];  <span class="comment">//生成随机数与计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (si % <span class="number">64</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        s20_rev_littleendian(n + <span class="number">8</span>, si / <span class="number">64</span>);</span><br><span class="line">        (*expand)(key, n, keystream); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; buflen; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((si + i) % <span class="number">64</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            s20_rev_littleendian(n + <span class="number">8</span>, ((si + i) / <span class="number">64</span>));</span><br><span class="line">            (*expand)(key, n, keystream);  <span class="comment">//密钥拓展，生成盒</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buf[i] ^= keystream[(si + i) % <span class="number">64</span>];  <span class="comment">//与原数据异或加密</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> S20_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> key[<span class="number">32</span>] = &#123; <span class="number">0x59</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x20</span>, <span class="number">0x53</span>, <span class="number">0x74</span>,<span class="number">0x72</span>,<span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x73</span>,<span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x4E</span>, <span class="number">0x61</span>,<span class="number">0x74</span>, <span class="number">0x69</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span> &#125;;</span><br><span class="line">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>] = &#123; <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">48</span>] = &#123;</span><br><span class="line">    <span class="number">0x5E</span>, <span class="number">0x13</span>, <span class="number">0xAA</span>, <span class="number">0xD3</span>, <span class="number">0x87</span>, <span class="number">0x75</span>, <span class="number">0x2B</span>, <span class="number">0x7A</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x04</span>, <span class="number">0xA3</span>, <span class="number">0x49</span>, <span class="number">0x7E</span>, <span class="number">0x1D</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0x6B</span>, <span class="number">0x5D</span>, <span class="number">0x58</span>, <span class="number">0x40</span>, <span class="number">0x5E</span>, <span class="number">0x44</span>, <span class="number">0x63</span>, <span class="number">0x59</span>, <span class="number">0x48</span>, <span class="number">0x51</span>, <span class="number">0x0D</span>, <span class="number">0x54</span>, <span class="number">0x5E</span>, <span class="number">0x58</span>, <span class="number">0x55</span>, <span class="number">0x58</span>,</span><br><span class="line">    <span class="number">0xAD</span>, <span class="number">0x82</span>, <span class="number">0xAF</span>, <span class="number">0xDC</span>, <span class="number">0xE7</span>, <span class="number">0xAB</span>, <span class="number">0x58</span>, <span class="number">0x5D</span>, <span class="number">0xCE</span>, <span class="number">0xC1</span>, <span class="number">0xFD</span>, <span class="number">0xF7</span>, <span class="number">0xFF</span>, <span class="number">0x7F</span>, <span class="number">0x0</span>, <span class="number">0x0</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,s20_crypt(key, S20_KEYLEN_256, nonce, <span class="number">0</span>, (<span class="type">uint8_t</span>*)data, <span class="number">48</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lordtianqiyi/articles/16822639.html">ChaCha20加密 与 Salsa20加密 - TLSN - 博客园</a></p>
<pre><code>[【动画密码学】Salsa20|流密码_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Bj411q7Kr?spm_id_from=333.788.recommend_more_video.-1&amp;vd_source=7b352c7cd2bdf055df2dc80c7bf5002c)

[alexwebr/salsa20: An implementation of the Salsa20 stream cipher in C99](https://github.com/alexwebr/salsa20)
</code></pre>
<hr>
<h2 id="ChaCha20"><a href="#ChaCha20" class="headerlink" title="ChaCha20"></a>ChaCha20</h2><p>需要的数据：一个计数器counter一般为0，8字节的随机数noce，128位或256位的密钥，不定长度明文&#x2F;密文，一个16字节密钥拓展常量”expand 32-byte k”，。</p>
<p>加密流程，密钥拓展-&gt;把拓展的密钥和随机数，计数器，常量排列成一个4x4的矩阵（顺序排列），每个元素4字节-&gt;列加密，斜对角加密，相比salsa20还多了一次异或-&gt;把矩阵拆分成单字节的盒-&gt;明文与盒异或.</p>
<h3 id="加解密脚本-1"><a href="#加解密脚本-1" class="headerlink" title="加解密脚本"></a>加解密脚本</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">u32t8le</span><span class="params">(<span class="type">uint32_t</span> v, <span class="type">uint8_t</span> p[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    p[<span class="number">0</span>] = v &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">1</span>] = (v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">2</span>] = (v &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">3</span>] = (v &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title function_">u8t32le</span><span class="params">(<span class="type">uint8_t</span> p[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> value = p[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">2</span>];</span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">1</span>];</span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title function_">rotl32</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// http://blog.regehr.org/archives/1063</span></span><br><span class="line">    <span class="keyword">return</span> x &lt;&lt; n | (x &gt;&gt; (-n &amp; <span class="number">31</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://tools.ietf.org/html/rfc7539#section-2.1</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_quarterround</span><span class="params">(<span class="type">uint32_t</span>* x, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d)</span> &#123;</span><br><span class="line">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a], <span class="number">16</span>);</span><br><span class="line">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c], <span class="number">12</span>);</span><br><span class="line">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a], <span class="number">8</span>);</span><br><span class="line">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c], <span class="number">7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_serialize</span><span class="params">(<span class="type">uint32_t</span> in[<span class="number">16</span>], <span class="type">uint8_t</span> output[<span class="number">64</span>])</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        u32t8le(in[i], output + (i &lt;&lt; <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_block</span><span class="params">(<span class="type">uint32_t</span> in[<span class="number">16</span>], <span class="type">uint8_t</span> out[<span class="number">64</span>], <span class="type">int</span> num_rounds)</span> &#123; <span class="comment">// num_rounds 一般为20 </span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> x[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(x, in, <span class="keyword">sizeof</span>(<span class="type">uint32_t</span>) * <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = num_rounds; i &gt; <span class="number">0</span>; i -= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">//odd round</span></span><br><span class="line">        chacha20_quarterround(x, <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">13</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">14</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>);</span><br><span class="line">        <span class="comment">//even round </span></span><br><span class="line">        chacha20_quarterround(x, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">1</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">2</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">13</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">14</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        x[i] += in[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chacha20_serialize(x, out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://tools.ietf.org/html/rfc7539#section-2.3</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_init_state</span><span class="params">(<span class="type">uint32_t</span> s[<span class="number">16</span>], <span class="type">uint8_t</span> key[<span class="number">32</span>], <span class="type">uint32_t</span> counter, <span class="type">uint8_t</span> nonce[<span class="number">12</span>])</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// refer: https://dxr.mozilla.org/mozilla-beta/source/security/nss/lib/freebl/chacha20.c</span></span><br><span class="line">    <span class="comment">// convert magic number to string: &quot;expand 32-byte k&quot;</span></span><br><span class="line">    s[<span class="number">0</span>] = <span class="number">0x61707865</span>;</span><br><span class="line">    s[<span class="number">1</span>] = <span class="number">0x3320646e</span>;</span><br><span class="line">    s[<span class="number">2</span>] = <span class="number">0x79622d32</span>;</span><br><span class="line">    s[<span class="number">3</span>] = <span class="number">0x6b206574</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        s[<span class="number">4</span> + i] = u8t32le(key + i * <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s[<span class="number">12</span>] = counter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        s[<span class="number">13</span> + i] = u8t32le(nonce + i * <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ChaCha20XOR</span><span class="params">(<span class="type">uint8_t</span> key[<span class="number">32</span>], <span class="type">uint32_t</span> counter, <span class="type">uint8_t</span> nonce[<span class="number">12</span>], <span class="type">uint8_t</span>* in, <span class="type">uint8_t</span>* out, <span class="type">int</span> inlen)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> s[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> block[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">    chacha20_init_state(s, key, counter, nonce);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; inlen; i += <span class="number">64</span>) &#123;</span><br><span class="line">        chacha20_block(s, block, <span class="number">20</span>);</span><br><span class="line">        s[<span class="number">12</span>]++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j = i; j &lt; i + <span class="number">64</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= inlen) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            out[j] = in[j] ^ block[j - i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>] = &#123; <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">48</span>] = &#123;</span><br><span class="line">    <span class="number">0x5E</span>, <span class="number">0x13</span>, <span class="number">0xAA</span>, <span class="number">0xD3</span>, <span class="number">0x87</span>, <span class="number">0x75</span>, <span class="number">0x2B</span>, <span class="number">0x7A</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x04</span>, <span class="number">0xA3</span>, <span class="number">0x49</span>, <span class="number">0x7E</span>, <span class="number">0x1D</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0x6B</span>, <span class="number">0x5D</span>, <span class="number">0x58</span>, <span class="number">0x40</span>, <span class="number">0x5E</span>, <span class="number">0x44</span>, <span class="number">0x63</span>, <span class="number">0x59</span>, <span class="number">0x48</span>, <span class="number">0x51</span>, <span class="number">0x0D</span>, <span class="number">0x54</span>, <span class="number">0x5E</span>, <span class="number">0x58</span>, <span class="number">0x55</span>, <span class="number">0x58</span>,</span><br><span class="line">    <span class="number">0xAD</span>, <span class="number">0x82</span>, <span class="number">0xAF</span>, <span class="number">0xDC</span>, <span class="number">0xE7</span>, <span class="number">0xAB</span>, <span class="number">0x58</span>, <span class="number">0x5D</span>, <span class="number">0xCE</span>, <span class="number">0xC1</span>, <span class="number">0xFD</span>, <span class="number">0xF7</span>, <span class="number">0xFF</span>, <span class="number">0x7F</span>, <span class="number">0x0</span>, <span class="number">0x0</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> key[<span class="number">32</span>] = &#123; <span class="number">0x59</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x20</span>, <span class="number">0x53</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>,</span><br><span class="line">    <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x4E</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x69</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span> ,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> encrypt[<span class="number">114</span>];</span><br><span class="line"></span><br><span class="line">    ChaCha20XOR(key, <span class="number">0</span>, nonce, data, encrypt, <span class="number">48</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, encrypt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chacha20_context</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">uint32_t</span> keystream32[<span class="number">16</span>];</span><br><span class="line">	<span class="type">size_t</span> position;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> key[<span class="number">32</span>];</span><br><span class="line">	<span class="type">uint8_t</span> nonce[<span class="number">12</span>];</span><br><span class="line">	<span class="type">uint64_t</span> counter;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint32_t</span> state[<span class="number">16</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">chacha20_init_context</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint8_t</span> key[], <span class="type">uint8_t</span> nounc[], <span class="type">uint64_t</span> counter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">chacha20_xor</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint8_t</span>* bytes, <span class="type">size_t</span> n_bytes)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">rotl32</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">pack4</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* a)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> res = <span class="number">0</span>;</span><br><span class="line">	res |= (<span class="type">uint32_t</span>)a[<span class="number">0</span>] &lt;&lt; <span class="number">0</span> * <span class="number">8</span>;</span><br><span class="line">	res |= (<span class="type">uint32_t</span>)a[<span class="number">1</span>] &lt;&lt; <span class="number">1</span> * <span class="number">8</span>;</span><br><span class="line">	res |= (<span class="type">uint32_t</span>)a[<span class="number">2</span>] &lt;&lt; <span class="number">2</span> * <span class="number">8</span>;</span><br><span class="line">	res |= (<span class="type">uint32_t</span>)a[<span class="number">3</span>] &lt;&lt; <span class="number">3</span> * <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">unpack4</span><span class="params">(<span class="type">uint32_t</span> src, <span class="type">uint8_t</span>* dst)</span> &#123;</span><br><span class="line">	dst[<span class="number">0</span>] = (src &gt;&gt; <span class="number">0</span> * <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">	dst[<span class="number">1</span>] = (src &gt;&gt; <span class="number">1</span> * <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">	dst[<span class="number">2</span>] = (src &gt;&gt; <span class="number">2</span> * <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">	dst[<span class="number">3</span>] = (src &gt;&gt; <span class="number">3</span> * <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_init_block</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint8_t</span> key[], <span class="type">uint8_t</span> nonce[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">memcpy</span>(ctx-&gt;key, key, <span class="keyword">sizeof</span>(ctx-&gt;key));</span><br><span class="line">	<span class="built_in">memcpy</span>(ctx-&gt;nonce, nonce, <span class="keyword">sizeof</span>(ctx-&gt;nonce));</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">uint8_t</span>* magic_constant = (<span class="type">uint8_t</span>*)<span class="string">&quot;expand 32-byte k&quot;</span>;</span><br><span class="line">	ctx-&gt;state[<span class="number">0</span>] = pack4(magic_constant + <span class="number">0</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">1</span>] = pack4(magic_constant + <span class="number">1</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">2</span>] = pack4(magic_constant + <span class="number">2</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">3</span>] = pack4(magic_constant + <span class="number">3</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">4</span>] = pack4(key + <span class="number">0</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">5</span>] = pack4(key + <span class="number">1</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">6</span>] = pack4(key + <span class="number">2</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">7</span>] = pack4(key + <span class="number">3</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">8</span>] = pack4(key + <span class="number">4</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">9</span>] = pack4(key + <span class="number">5</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">10</span>] = pack4(key + <span class="number">6</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">11</span>] = pack4(key + <span class="number">7</span> * <span class="number">4</span>);</span><br><span class="line">	<span class="comment">// 64 bit counter initialized to zero by default.</span></span><br><span class="line">	ctx-&gt;state[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">	ctx-&gt;state[<span class="number">13</span>] = pack4(nonce + <span class="number">0</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">14</span>] = pack4(nonce + <span class="number">1</span> * <span class="number">4</span>);</span><br><span class="line">	ctx-&gt;state[<span class="number">15</span>] = pack4(nonce + <span class="number">2</span> * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(ctx-&gt;nonce, nonce, <span class="keyword">sizeof</span>(ctx-&gt;nonce));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_block_set_counter</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint64_t</span> counter)</span></span><br><span class="line">&#123;</span><br><span class="line">	ctx-&gt;state[<span class="number">12</span>] = (<span class="type">uint32_t</span>)counter;</span><br><span class="line">	ctx-&gt;state[<span class="number">13</span>] = pack4(ctx-&gt;nonce + <span class="number">0</span> * <span class="number">4</span>) + (<span class="type">uint32_t</span>)(counter &gt;&gt; <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_block_next</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx)</span> &#123;</span><br><span class="line">	<span class="comment">// This is where the crazy voodoo magic happens.</span></span><br><span class="line">	<span class="comment">// Mix the bytes a lot and hope that nobody finds out how to undo it.</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) ctx-&gt;keystream32[i] = ctx-&gt;state[i];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHACHA20_QUARTERROUND(x, a, b, c, d) \</span></span><br><span class="line"><span class="meta">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a], 16); \</span></span><br><span class="line"><span class="meta">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c], 12); \</span></span><br><span class="line"><span class="meta">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a], 8); \</span></span><br><span class="line"><span class="meta">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c], 7);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">13</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">14</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">1</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">2</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">13</span>)</span><br><span class="line">			CHACHA20_QUARTERROUND(ctx-&gt;keystream32, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">14</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) ctx-&gt;keystream32[i] += ctx-&gt;state[i];</span><br><span class="line"></span><br><span class="line">	<span class="type">uint32_t</span>* counter = ctx-&gt;state + <span class="number">12</span>;</span><br><span class="line">	<span class="comment">// increment counter</span></span><br><span class="line">	counter[<span class="number">0</span>]++;</span><br><span class="line">	<span class="keyword">if</span> (<span class="number">0</span> == counter[<span class="number">0</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// wrap around occured, increment higher 32 bits of counter</span></span><br><span class="line">		counter[<span class="number">1</span>]++;</span><br><span class="line">		<span class="comment">// Limited to 2^64 blocks of 64 bytes each.</span></span><br><span class="line">		<span class="comment">// If you want to process more than 1180591620717411303424 bytes</span></span><br><span class="line">		<span class="comment">// you have other problems.</span></span><br><span class="line">		<span class="comment">// We could keep counting with counter[2] and counter[3] (nonce),</span></span><br><span class="line">		<span class="comment">// but then we risk reusing the nonce which is very bad.</span></span><br><span class="line">		assert(<span class="number">0</span> != counter[<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">chacha20_init_context</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint8_t</span> key[], <span class="type">uint8_t</span> nonce[], <span class="type">uint64_t</span> counter)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">memset</span>(ctx, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> chacha20_context));</span><br><span class="line"></span><br><span class="line">	chacha20_init_block(ctx, key, nonce);</span><br><span class="line">	chacha20_block_set_counter(ctx, counter);</span><br><span class="line"></span><br><span class="line">	ctx-&gt;counter = counter;</span><br><span class="line">	ctx-&gt;position = <span class="number">64</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">chacha20_xor</span><span class="params">(<span class="keyword">struct</span> chacha20_context* ctx, <span class="type">uint8_t</span>* bytes, <span class="type">size_t</span> n_bytes)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span>* keystream8 = (<span class="type">uint8_t</span>*)ctx-&gt;keystream32;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n_bytes; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (ctx-&gt;position &gt;= <span class="number">64</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			chacha20_block_next(ctx);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%.2x,&quot;</span>, keystream8[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			ctx-&gt;position = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		bytes[i] ^= keystream8[ctx-&gt;position];</span><br><span class="line">		ctx-&gt;position++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>] = &#123; <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">48</span>] = &#123;</span><br><span class="line">    <span class="number">0x5E</span>, <span class="number">0x13</span>, <span class="number">0xAA</span>, <span class="number">0xD3</span>, <span class="number">0x87</span>, <span class="number">0x75</span>, <span class="number">0x2B</span>, <span class="number">0x7A</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x04</span>, <span class="number">0xA3</span>, <span class="number">0x49</span>, <span class="number">0x7E</span>, <span class="number">0x1D</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0x6B</span>, <span class="number">0x5D</span>, <span class="number">0x58</span>, <span class="number">0x40</span>, <span class="number">0x5E</span>, <span class="number">0x44</span>, <span class="number">0x63</span>, <span class="number">0x59</span>, <span class="number">0x48</span>, <span class="number">0x51</span>, <span class="number">0x0D</span>, <span class="number">0x54</span>, <span class="number">0x5E</span>, <span class="number">0x58</span>, <span class="number">0x55</span>, <span class="number">0x58</span>,</span><br><span class="line">    <span class="number">0xAD</span>, <span class="number">0x82</span>, <span class="number">0xAF</span>, <span class="number">0xDC</span>, <span class="number">0xE7</span>, <span class="number">0xAB</span>, <span class="number">0x58</span>, <span class="number">0x5D</span>, <span class="number">0xCE</span>, <span class="number">0xC1</span>, <span class="number">0xFD</span>, <span class="number">0xF7</span>, <span class="number">0xFF</span>, <span class="number">0x7F</span>, <span class="number">0x0</span>, <span class="number">0x0</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> key[<span class="number">32</span>] = &#123; <span class="number">0x59</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x20</span>, <span class="number">0x53</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>,</span><br><span class="line">	<span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x4E</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x69</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span> ,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">chacha20_context</span> <span class="title">ctx</span>;</span></span><br><span class="line"></span><br><span class="line">	chacha20_init_context(&amp;ctx, key, nonce, <span class="number">0</span>);</span><br><span class="line">	chacha20_xor(&amp;ctx,(<span class="type">uint8_t</span>*) data,<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/Ginurx/chacha20-c">Ginurx&#x2F;chacha20-c: ChaCha20 stream cipher implemented in C</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lordtianqiyi/articles/16822639.html">ChaCha20加密 与 Salsa20加密 - TLSN - 博客园</a></p>
<hr>
<h2 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h2><p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__1bai/article/details/123357156">https://blog.csdn.net/xiao__1bai/article/details/123357156</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1z94y1C79p/?share_source=copy_web&vd_source=3c5a9c55a0916c3bbdeb89727b25cf20">演示动画</a></p>
<p>对称加密算法，可以用写内存解决。</p>
<p>单字节加密。</p>
<p>大概流程：初始化盒S，用密钥初始化盒子T，用S和T的值做为索引组合交换盒S中的内容打乱S盒，遍历要加密的数据，再次用S盒中的数据作为下标和S盒内的数据进行交换打乱，把S盒中的数据相加作为索引在S盒中寻找数据与原数据进行异或。</p>
<p>代码解读</p>
<p>来自上面的链接</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">程序实现时，需要注意的是，状态向量数组S和临时向量数组T</span></span><br><span class="line"><span class="comment">的类型应设为unsigned char，而不是char。因为在一些机器</span></span><br><span class="line"><span class="comment">下，将char默认做为signed char看待，在算法中计算下标i，j的</span></span><br><span class="line"><span class="comment">时候，会涉及char转int，如果是signed的char，那么将char的8</span></span><br><span class="line"><span class="comment">位拷贝到int的低8位后，还会根据char的符号为，在int的高位补</span></span><br><span class="line"><span class="comment">0或1。由于密钥是随机产生的，如果遇到密钥的某个字节的高</span></span><br><span class="line"><span class="comment">位为1的话，那么计算得到的数组下标为负数，就会越界。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">RC4INFO</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> s_box[<span class="number">256</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> t_box[<span class="number">256</span>];</span><br><span class="line">&#125;RC4_INFO,*PRC4_INFO;			<span class="comment">//定义 RC4 中要用到的 S-Box 和临时向量 T，封装在结构体中并给正常别名和指针别名。 </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">初始化函数 需要传入key 以及 keylen</span></span><br><span class="line"><span class="comment">主要有几个步骤</span></span><br><span class="line"><span class="comment">1.初始化Sbox</span></span><br><span class="line"><span class="comment">2.将key填充到Tbox中</span></span><br><span class="line"><span class="comment">3.组合sbox[i] 与 tbox[i] 然后进行交换</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(PRC4_INFO prc4,<span class="type">unsigned</span> <span class="type">char</span> key[],<span class="type">unsigned</span> <span class="type">int</span> keylen)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> tmp;</span><br><span class="line">	<span class="keyword">if</span>(prc4==<span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	初始化存储0-255字节的Sbox(其实就是一个数组)</span></span><br><span class="line"><span class="comment">	填充key到256个字节数组中称为Tbox(你输入的key不满256个字节则初始化到256个字节)</span></span><br><span class="line"><span class="comment">	*/</span> </span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		prc4-&gt;s_box[i] = i;</span><br><span class="line">		prc4-&gt;t_box[i] = key[i % keylen];	<span class="comment">//如果密钥的长度是256字节，就直接把密钥的值赋给k，否则，轮转地将密钥的每个字节赋给k </span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//交换s[i]与s[j]   i 从0开始一直到255下标结束. j是 s[i]与T[i]组合得出的下标</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		j=(j+prc4-&gt;s_box[i]+prc4-&gt;t_box[i])%<span class="number">256</span>;</span><br><span class="line">		<span class="comment">//开始交换</span></span><br><span class="line">		tmp=prc4-&gt;s_box[i];</span><br><span class="line">		prc4-&gt;s_box[i]=prc4-&gt;s_box[j];</span><br><span class="line">		prc4-&gt;s_box[j]=tmp;</span><br><span class="line">	&#125;</span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">RC4加密其实就是遍历数据,将数据与sbox进行异或加密,而在此之前还需要交换一次sbox的数据</span></span><br><span class="line"><span class="comment">交换完之后 再把s[i] + s[j]的组合当做下标再去异或. </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> data[],<span class="type">unsigned</span> <span class="type">int</span> datalen,<span class="type">unsigned</span> <span class="type">char</span> key[],<span class="type">unsigned</span> <span class="type">int</span> keylen)</span>	<span class="comment">//参数分别是要加密的数据、要加密的数据长度、加密数据所用的Key、加密数据所用的key长度</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> dn=<span class="number">0</span>;	<span class="comment">//data[n]的意思</span></span><br><span class="line">	<span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> j=<span class="number">0</span>;	<span class="comment">//i j分别用于交换sbox[i] 和 sbox[j]</span></span><br><span class="line">	<span class="type">int</span> t=<span class="number">0</span>;	<span class="comment">//t = s[i] +s[j]</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> tmp;</span><br><span class="line">	</span><br><span class="line">	RC4_INFO rc4;		<span class="comment">//这里定义前面的结构题 </span></span><br><span class="line">	rc4_init(&amp;rc4,key,keylen);		<span class="comment">//在加密函数中调用初始化函数，就省去了其它代码中出现的要保存初始化 sBox 的现象了.</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(dn=<span class="number">0</span>;dn&lt;datalen;dn++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//i确保S-box的每个元素都得到处理，j保证S-box的搅乱是随机的。</span></span><br><span class="line">		i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">		j=(j+rc4.s_box[i])%<span class="number">256</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//交换 s_box[i] 和 s_box[j]</span></span><br><span class="line">		tmp=rc4.s_box[i];</span><br><span class="line">		rc4.s_box[i] = rc4.s_box[j];</span><br><span class="line">		rc4.s_box[j] = tmp;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//交换完之后 再把s[i] + s[j]的组合当做下标再去异或.</span></span><br><span class="line">		t = (rc4.s_box[i] + rc4.s_box[j]) % <span class="number">256</span>;</span><br><span class="line">		data[dn] ^= rc4.s_box[t];</span><br><span class="line">	 &#125; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">EntryBuffer</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> data[],<span class="type">unsigned</span> <span class="type">int</span> datalen)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[]=<span class="string">&quot;pjrHeldsadf&quot;</span>;</span><br><span class="line">	rc4_crypt(data,datalen,key,<span class="keyword">sizeof</span>(key)/<span class="keyword">sizeof</span>(key[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> Hell[] = <span class="string">&quot;黄河远上白云间&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;加密前：pData=%s\n\n&quot;</span>, Hell);</span><br><span class="line">    EntryBuffer((<span class="type">unsigned</span> <span class="type">char</span>*)Hell,<span class="keyword">sizeof</span>(Hell)/<span class="keyword">sizeof</span>(Hell[<span class="number">0</span>])); <span class="comment">//加第一次调用就是加密 </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;加密后：pData=%s\n\n&quot;</span>, Hell);</span><br><span class="line">    EntryBuffer((<span class="type">unsigned</span> <span class="type">char</span>*)Hell,<span class="keyword">sizeof</span>(Hell)/<span class="keyword">sizeof</span>(Hell[<span class="number">0</span>])); <span class="comment">//由于异或运算的对合性，RC4加密解密使用同一套算法。</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;解密后：pData=%s\n\n&quot;</span>, Hell);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="一般形式（特征）-1"><a href="#一般形式（特征）-1" class="headerlink" title="一般形式（特征）"></a>一般形式（特征）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//s 表的长度取 256</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> size 256</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> sbox[<span class="number">257</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 s 表</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_sbox</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* key)</span> &#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i, j, k;</span><br><span class="line">	<span class="type">int</span> tmp;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">		sbox[i] = i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	j =k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">		tmp = sbox[i];</span><br><span class="line">		j = (j + tmp + key[i % <span class="built_in">strlen</span>((<span class="type">char</span>*)key)]) % size;  <span class="comment">//注意此处的长度，自己计算一下密钥和数据的长度多次尝试</span></span><br><span class="line">        <span class="comment">//这里就不创建T盒了，直接对密钥进行遍历</span></span><br><span class="line">		sbox[i] = sbox[j];</span><br><span class="line">		sbox[j] = tmp;</span><br><span class="line">		<span class="comment">/*if (++k &gt;= 12)</span></span><br><span class="line"><span class="comment">			k = 0;*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">enc_dec</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* key, <span class="type">unsigned</span> <span class="type">char</span>* data)</span> &#123;</span><br><span class="line">	<span class="type">int</span> i, j, k, R, tmp;</span><br><span class="line"></span><br><span class="line">	init_sbox(key);</span><br><span class="line"></span><br><span class="line">	j = k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>((<span class="type">char</span>*)data); i++) &#123;</span><br><span class="line">		j = (j + <span class="number">1</span>) % size;</span><br><span class="line">		k = (k + sbox[j]) % size;</span><br><span class="line"></span><br><span class="line">		tmp = sbox[j];</span><br><span class="line">		sbox[j] = sbox[k];</span><br><span class="line">		sbox[k] = tmp;</span><br><span class="line"></span><br><span class="line">		R = sbox[(sbox[j] + sbox[k]) % size];</span><br><span class="line"></span><br><span class="line">		data[i] ^= R;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">100</span>] = &#123; <span class="number">0x52</span>, <span class="number">0x69</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x72</span>, <span class="number">0x64</span>, <span class="number">0x6F</span>, <span class="number">0x5F</span>, <span class="number">0x4D</span>, <span class="number">0x5F</span>, <span class="number">0x6C</span> &#125;;<span class="comment">//, 0x75 &#125;;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">100</span>] = &#123; <span class="number">0xC2</span>, <span class="number">0xB0</span>, <span class="number">0x0E</span>, <span class="number">0xBE</span>, <span class="number">0xDB</span>, <span class="number">0xDF</span>, <span class="number">0x95</span>, <span class="number">0x2D</span>, <span class="number">0xCF</span>, <span class="number">0x4B</span>, <span class="number">0x74</span>, <span class="number">0x41</span>, <span class="number">0xF3</span>, <span class="number">0xC9</span>, <span class="number">0x43</span>, <span class="number">0xA7</span>,</span><br><span class="line">	<span class="number">0x3C</span>, <span class="number">0x70</span>, <span class="number">0xC2</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x8D</span>, <span class="number">0x65</span>, <span class="number">0x2C</span>, <span class="number">0x5C</span> &#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;key:%d,data:%d&quot;</span>, <span class="built_in">strlen</span>((<span class="type">char</span>*)key), <span class="built_in">strlen</span>((<span class="type">char</span>*)data));  <span class="comment">//查看一下key的长度是否异常,如果有异常请手动输入</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="comment">/*printf(&quot;输入你要加密的字符：&quot;);</span></span><br><span class="line"><span class="comment">	scanf(&quot;%100s&quot;, data);</span></span><br><span class="line"><span class="comment">	printf(&quot;输入密钥：&quot;);</span></span><br><span class="line"><span class="comment">	scanf(&quot;%40s&quot;, key);</span></span><br><span class="line"><span class="comment">	enc_dec(key, data);</span></span><br><span class="line"><span class="comment">	printf(&quot;enc: %s\n&quot;, data);*/</span></span><br><span class="line">	enc_dec(key, data);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;dec: %s\n&quot;</span>, data);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h2><p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__1bai/article/details/123307059">https://blog.csdn.net/xiao__1bai/article/details/123307059</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Nu411E7wX/?share_source=copy_web&vd_source=3c5a9c55a0916c3bbdeb89727b25cf20">动画演示</a></p>
<p>位移与运算的关系</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A &gt;&gt; n == A / <span class="built_in">pow</span>(<span class="number">2</span>,n)</span><br><span class="line">A &lt;&lt; n == A * <span class="built_in">pow</span>(<span class="number">2</span>,n)</span><br></pre></td></tr></table></figure>

<p>加密流程：需要两个4字节的明文和四个4字节的密钥，以及一个delta值（通常为黄金分割数(5√-2)&#x2F;2 与 232 的乘积0x9e3779b9即2654435769），把明文分组进行多轮与相加加密。且为分组加密，组与组间相互影响。</p>
<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><p>（来自上面文章）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k )</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0</span>,i;</span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;  <span class="comment">//2654435769</span></span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v0+=((v1 &lt;&lt; <span class="number">4</span>) + k0)^(v1 + sum)^((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">		v1+=((v0 &lt;&lt; <span class="number">4</span>) + k2)^(v0 + sum)^((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span> *v,<span class="type">uint32_t</span> *k)</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0xC6EF3720</span>,i;	<span class="comment">//这里的sum是0x9e3779b9*32后截取32位的结果，截取很重要。//这里的数据类型可能会有符号，可以尝试改为int</span></span><br><span class="line">	<span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k0=k[<span class="number">0</span>],k1=k[<span class="number">1</span>],k2=k[<span class="number">2</span>],k3=k[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">		v1-=((v0 &lt;&lt; <span class="number">4</span>) + k2)^(v0 + sum)^((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">		v0-=((v1 &lt;&lt; <span class="number">4</span>) + k0)^(v1 + sum)^((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;  <span class="comment">//若有多组数据，可以每两个进行加密。</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前的数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);	<span class="comment">//%u 以十进制形式输出无符号整数 </span></span><br><span class="line">	encrypt(v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	decrypt(v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="分组加密的分类"><a href="#分组加密的分类" class="headerlink" title="分组加密的分类"></a>分组加密的分类</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_54977781/article/details/130560096">密码学：分组密码.（块密码：是一种对称密码算法）_分组加密-CSDN博客</a></p>
<p>CEB：明文的每个块都独立地加密成密文的每个块。</p>
<p>CBC：个明文块先与前一个密文块进行异或(XOR)后再进行加密。第1个块中需要使用初始化向量(第一组密文与初始向量异或)。</p>
<p>OFB：将之前一次的加密结果使用密钥再次进行加密(第1次对IV进行加密)，产生的块作为密钥流，然后将其与明文块进行异或，得到密文。</p>
<p>CFB：类似OFB，只不过将上一组的密文作为下一组的输入来加密进行反馈。</p>
<hr>
<h2 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__1bai/article/details/123307059">解析 TEA 加密算法(C语言、python)：_tea加密-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dw411w7WH/?spm_id_from=333.1387.upload.video_card.click&vd_source=7b352c7cd2bdf055df2dc80c7bf5002c">演示动画</a></p>
<p>XTEA是TEA的升级版，增加了更多的密钥表，移位和异或操作</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],sum=<span class="number">0</span>,delta=<span class="number">0x9E3779B9</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;num_rounds;i++)&#123;</span><br><span class="line">		v0+=(((v1 &lt;&lt; <span class="number">4</span>)^(v1 &gt;&gt; <span class="number">5</span>)) + v1)^(sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">		sum+=delta;</span><br><span class="line">		v1+=((( v0 &lt;&lt; <span class="number">4</span>)^(v0 &gt;&gt; <span class="number">5</span>)) + v0)^(sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds,<span class="type">uint32_t</span> v[<span class="number">2</span>],<span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">	<span class="type">uint32_t</span> v0=v[<span class="number">0</span>],v1=v[<span class="number">1</span>],delta=<span class="number">0x9E3779B9</span>,sum=delta*num_rounds;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;num_rounds;i++)&#123;</span><br><span class="line">	v1-=(((v0 &lt;&lt; <span class="number">4</span>)^(v0 &gt;&gt; <span class="number">5</span>)) + v0)^(sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">	sum-=delta;</span><br><span class="line">	v0-=(((v1 &lt;&lt; <span class="number">4</span>)^(v1 &gt;&gt; <span class="number">5</span>)) + v1)^(sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">	&#125; </span><br><span class="line">	v[<span class="number">0</span>]=v0;v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> r=<span class="number">32</span>;				<span class="comment">//这里是加密轮数，自己设置 </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	encipher(r,v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	decipher(r,v,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__1bai/article/details/123307059">解析 TEA 加密算法(C语言、python)：_tea加密-CSDN博客</a></p>
<p>XXTEA在可变长度块上运行，这些块是32位大小的任意倍数（最小64位），使用128位密钥（16字节）。</p>
<p>加密流程:最开始是以v[n-1]和v[1]得出v[0]，后面是用v[0]和v[2]得出v[1]，以此类推三组作为一次加密，每次加密遍历一遍，一共加密6+52&#x2F;n次。</p>
<h4 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h4><p>（来自上面的文章）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x933779b9</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v,<span class="type">int</span> n,<span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> y,z,sum,delta;</span><br><span class="line">	<span class="type">unsigned</span> p,rounds,e;</span><br><span class="line">    delta = <span class="number">0x933779b9</span>;</span><br><span class="line">	rounds=<span class="number">6</span>+<span class="number">52</span>/n;	<span class="comment">//这里可以说是预定义值，n=2是rounds=32</span></span><br><span class="line">	sum=<span class="number">0</span>;</span><br><span class="line">	z=v[n<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		sum+=delta;</span><br><span class="line">		e=(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>;</span><br><span class="line">		<span class="keyword">for</span>(p=<span class="number">0</span>;p&lt;n<span class="number">-1</span>;p++)        <span class="comment">//注意这里的p是从0~n-1</span></span><br><span class="line">		&#123;</span><br><span class="line">			y=v[p+<span class="number">1</span>];</span><br><span class="line">			z=v[p]+=(((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>)+(y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>))^((sum ^ y)+(key[(p &amp; <span class="number">3</span>) ^ e] ^ z)));</span><br><span class="line">		&#125;</span><br><span class="line">		y=v[<span class="number">0</span>];</span><br><span class="line">		z=v[n<span class="number">-1</span>]+=(((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>)+(y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>))^((sum ^ y)+(key[(p &amp; <span class="number">3</span>) ^ e] ^ z)));        <span class="comment">//这里的MX中传入的p=n-1</span></span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">while</span>(--rounds);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">dec_btea</span><span class="params">(<span class="type">uint32_t</span> *v,<span class="type">int</span> n,<span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y,z,sum,delta;</span><br><span class="line">	<span class="type">unsigned</span> p,rounds,e;</span><br><span class="line">    delta = <span class="number">0x933779b9</span>;</span><br><span class="line">	rounds=<span class="number">6</span>+<span class="number">52</span>/n;</span><br><span class="line">	sum=rounds*delta;</span><br><span class="line">	y=v[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		e=(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>;</span><br><span class="line">		<span class="keyword">for</span>(p=n<span class="number">-1</span>;p&gt;<span class="number">0</span>;p--)    <span class="comment">//注意这里的p是从n-1~0,和上面是反过来的</span></span><br><span class="line">		&#123;</span><br><span class="line">			z=v[p<span class="number">-1</span>];</span><br><span class="line">			y=v[p]-=(((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>)+(y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>))^((sum ^ y)+(key[(p &amp; <span class="number">3</span>) ^ e] ^ z)));</span><br><span class="line">		&#125;</span><br><span class="line">		z=v[n<span class="number">-1</span>];</span><br><span class="line">		y=v[<span class="number">0</span>]-=(((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>)+(y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>))^((sum ^ y)+(key[(p &amp; <span class="number">3</span>) ^ e] ^ z)));   <span class="comment">//这里的MX中传入的 p=0</span></span><br><span class="line">		sum-=delta;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(--rounds);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">	<span class="type">int</span> n=<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	btea(v,n,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;加密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	btea(v,-n,k);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;解密后数据：%u %u\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TEA系列的特征"><a href="#TEA系列的特征" class="headerlink" title="TEA系列的特征"></a>TEA系列的特征</h3><p>TEA系列最明显的特征就是DELTA&#x3D;0x933779b9，有时值不一样，但是delta是一定有的。还有就是那一串异或相加加密的代码。</p>
<p>在TEA和XTEA中每次加密只会涉及到两个密文，而XXTEA有三个密文。在XTEA和XXTEA中有&amp;3，而TEA中没有。在XXTEA中的轮数是6+52&#x2F;n。</p>
<h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dingxingaq/article/details/144160367">AES加密算法原理详解-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1kK4y1F7TJ/?share_source=copy_web&vd_source=3c5a9c55a0916c3bbdeb89727b25cf20">演示动画</a></p>
<p>AES 是一种对称密钥加密方法，依赖于分组密码，将数据分成块，对每个块进行加密以确保一致的安全性。AES 加密提供三种密钥长度——128 位、192 位和 256 位。包括4个操作：字节代换、行位移、列混合和轮密钥加。最后一轮迭代不执行列混合。AES的字节代换其实就是一个简单的查表操作。AES定义了一个S盒和一个逆S盒。</p>
<p>AES加密比较复杂，我们不深入研究，只掌握一些特征用于分析，具体解密方式可以用赛博厨师和Python脚本</p>
<ul>
<li><p>加密过程：密钥扩展–&gt;轮密钥生成–&gt;字节替换、行移位–&gt;列替换和轮密钥加</p>
</li>
<li><p>密钥长度和轮数的对应</p>
<ul>
<li>128bits–&gt;10rounds</li>
<li>192bits–&gt;12rounds</li>
<li>256bits–&gt;14rounds</li>
</ul>
<p>S盒常量</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>] = &#123;</span><br><span class="line">        <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">        <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">        <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">        <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">        <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">        <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">        <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">        <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">        <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">        <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">        <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">        <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">        <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">        <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>代码实现(来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/shaosunrise/article/details/80219950">AES算法描述及C语言实现_c语言实现aes算法-CSDN博客</a>)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> eK[<span class="number">44</span>], dK[<span class="number">44</span>];    <span class="comment">// encKey, decKey</span></span><br><span class="line">    <span class="type">int</span> Nr; <span class="comment">// 10 rounds</span></span><br><span class="line">&#125;AesKey;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLOCKSIZE 16  <span class="comment">//AES-128分组长度为16字节</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint8_t y[4] -&gt; uint32_t x</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD32H(x, y) \</span></span><br><span class="line"><span class="meta">  do &#123; (x) = ((uint32_t)((y)[0] &amp; 0xff)&lt;&lt;24) | ((uint32_t)((y)[1] &amp; 0xff)&lt;&lt;16) | \</span></span><br><span class="line"><span class="meta">             ((uint32_t)((y)[2] &amp; 0xff)&lt;&lt;8)  | ((uint32_t)((y)[3] &amp; 0xff));&#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint32_t x -&gt; uint8_t y[4]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STORE32H(x, y) \</span></span><br><span class="line"><span class="meta">  do &#123; (y)[0] = (uint8_t)(((x)&gt;&gt;24) &amp; 0xff); (y)[1] = (uint8_t)(((x)&gt;&gt;16) &amp; 0xff);   \</span></span><br><span class="line"><span class="meta">       (y)[2] = (uint8_t)(((x)&gt;&gt;8) &amp; 0xff); (y)[3] = (uint8_t)((x) &amp; 0xff); &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从uint32_t x中提取从低位开始的第n个字节</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BYTE(x, n) (((x) &gt;&gt; (8 * (n))) &amp; 0xff)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* used for keyExpansion */</span></span><br><span class="line"><span class="comment">// 字节替换然后循环左移1位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIX(x) (((S[BYTE(x, 2)] &lt;&lt; 24) &amp; 0xff000000) ^ ((S[BYTE(x, 1)] &lt;&lt; 16) &amp; 0xff0000) ^ \</span></span><br><span class="line"><span class="meta">                ((S[BYTE(x, 0)] &lt;&lt; 8) &amp; 0xff00) ^ (S[BYTE(x, 3)] &amp; 0xff))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint32_t x循环左移n位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROF32(x, n)  (((x) <span class="string">&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32-(n))))</span></span><br><span class="line"><span class="comment">// uint32_t x循环右移n位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROR32(x, n)  (((x) &gt;&gt; (n)) | ((x) &lt;&lt; (32-(n))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* for 128-bit blocks, Rijndael never uses more than 10 rcon values */</span></span><br><span class="line"><span class="comment">// AES-128轮常量</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> rcon[<span class="number">10</span>] = &#123;</span><br><span class="line">        <span class="number">0x01000000U</span>L, <span class="number">0x02000000U</span>L, <span class="number">0x04000000U</span>L, <span class="number">0x08000000U</span>L, <span class="number">0x10000000U</span>L,</span><br><span class="line">        <span class="number">0x20000000U</span>L, <span class="number">0x40000000U</span>L, <span class="number">0x80000000U</span>L, <span class="number">0x1B000000U</span>L, <span class="number">0x36000000U</span>L</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// S盒</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>] = &#123;</span><br><span class="line">        <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">        <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">        <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">        <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">        <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">        <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">        <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">        <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">        <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">        <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">        <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">        <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">        <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">        <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆S盒</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> inv_S[<span class="number">256</span>] = &#123;</span><br><span class="line">        <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>,</span><br><span class="line">        <span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>,</span><br><span class="line">        <span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>,</span><br><span class="line">        <span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>,</span><br><span class="line">        <span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>,</span><br><span class="line">        <span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">        <span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>,</span><br><span class="line">        <span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>,</span><br><span class="line">        <span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>,</span><br><span class="line">        <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>,</span><br><span class="line">        <span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>,</span><br><span class="line">        <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>,</span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>,</span><br><span class="line">        <span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">        <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* copy in[16] to state[4][4] */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">loadStateArray</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">const</span> <span class="type">uint8_t</span> *in)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[j][i] = *in++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* copy state[4][4] to out[16] */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">storeStateArray</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">uint8_t</span> *out)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            *out++ = state[j][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//秘钥扩展</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">keyExpansion</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, AesKey *aesKey)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == aesKey)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyExpansion param is NULL\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen != <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyExpansion keyLen = %d, Not support.\n&quot;</span>, keyLen);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> *w = aesKey-&gt;eK;  <span class="comment">//加密秘钥</span></span><br><span class="line">    <span class="type">uint32_t</span> *v = aesKey-&gt;dK;  <span class="comment">//解密秘钥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* keyLen is 16 Bytes, generate uint32_t W[44]. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* W[0-3] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        LOAD32H(w[i], key + <span class="number">4</span>*i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* W[4-43] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        w[<span class="number">4</span>] = w[<span class="number">0</span>] ^ MIX(w[<span class="number">3</span>]) ^ rcon[i];</span><br><span class="line">        w[<span class="number">5</span>] = w[<span class="number">1</span>] ^ w[<span class="number">4</span>];</span><br><span class="line">        w[<span class="number">6</span>] = w[<span class="number">2</span>] ^ w[<span class="number">5</span>];</span><br><span class="line">        w[<span class="number">7</span>] = w[<span class="number">3</span>] ^ w[<span class="number">6</span>];</span><br><span class="line">        w += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w = aesKey-&gt;eK+<span class="number">44</span> - <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//解密秘钥矩阵为加密秘钥矩阵的倒序，方便使用，把ek的11个矩阵倒序排列分配给dk作为解密秘钥</span></span><br><span class="line">    <span class="comment">//即dk[0-3]=ek[41-44], dk[4-7]=ek[37-40]... dk[41-44]=ek[0-3]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">11</span>; ++j) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">            v[i] = w[i];</span><br><span class="line">        &#125;</span><br><span class="line">        w -= <span class="number">4</span>;</span><br><span class="line">        v += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮秘钥加</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addRoundKey</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">const</span> <span class="type">uint32_t</span> *key)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> k[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            k[i][j] = (<span class="type">uint8_t</span>) BYTE(key[j], <span class="number">3</span> - i);  <span class="comment">/* 把 uint32 key[4] 先转换为矩阵 uint8 k[4][4] */</span></span><br><span class="line">            state[i][j] ^= k[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//字节替换</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">subBytes</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = S[state[i][j]]; <span class="comment">//直接使用原始字节作为S盒数据下标</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆字节替换</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invSubBytes</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = inv_S[state[i][j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//行移位</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">shiftRows</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> block[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    <span class="comment">//便于行循环移位，先把一行4字节拼成uint_32结构，移位后再转成独立的4个字节uint8_t</span></span><br><span class="line">        LOAD32H(block[i], state[i]);</span><br><span class="line">        block[i] = ROF32(block[i], <span class="number">8</span>*i);</span><br><span class="line">        STORE32H(block[i], state[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆行移位</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invShiftRows</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> block[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        LOAD32H(block[i], state[i]);</span><br><span class="line">        block[i] = ROR32(block[i], <span class="number">8</span>*i);</span><br><span class="line">        STORE32H(block[i], state[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Galois Field (256) Multiplication of two Bytes */</span></span><br><span class="line"><span class="comment">// 两字节的伽罗华域乘法运算</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">GMul</span><span class="params">(<span class="type">uint8_t</span> u, <span class="type">uint8_t</span> v)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (u &amp; <span class="number">0x01</span>) &#123;    <span class="comment">//</span></span><br><span class="line">            p ^= v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> flag = (v &amp; <span class="number">0x80</span>);</span><br><span class="line">        v &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            v ^= <span class="number">0x1B</span>; <span class="comment">/* x^8 + x^4 + x^3 + x + 1 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        u &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列混合</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mixColumns</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span> M[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* copy state[4][4] to tmp[4][4] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)&#123;</span><br><span class="line">            tmp[i][j] = state[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;  <span class="comment">//伽罗华域加法和乘法</span></span><br><span class="line">            state[i][j] = GMul(M[i][<span class="number">0</span>], tmp[<span class="number">0</span>][j]) ^ GMul(M[i][<span class="number">1</span>], tmp[<span class="number">1</span>][j])</span><br><span class="line">                        ^ GMul(M[i][<span class="number">2</span>], tmp[<span class="number">2</span>][j]) ^ GMul(M[i][<span class="number">3</span>], tmp[<span class="number">3</span>][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逆列混合</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invMixColumns</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span> M[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x09</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x0D</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x0B</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x0E</span>&#125;&#125;;  <span class="comment">//使用列混合矩阵的逆矩阵</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* copy state[4][4] to tmp[4][4] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)&#123;</span><br><span class="line">            tmp[i][j] = state[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = GMul(M[i][<span class="number">0</span>], tmp[<span class="number">0</span>][j]) ^ GMul(M[i][<span class="number">1</span>], tmp[<span class="number">1</span>][j])</span><br><span class="line">                          ^ GMul(M[i][<span class="number">2</span>], tmp[<span class="number">2</span>][j]) ^ GMul(M[i][<span class="number">3</span>], tmp[<span class="number">3</span>][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES-128加密接口，输入key应为16字节长度，输入长度应该是16字节整倍数，</span></span><br><span class="line"><span class="comment">// 这样输出长度与输入长度相同，函数调用外部为输出数据分配内存</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aesEncrypt</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, <span class="type">const</span> <span class="type">uint8_t</span> *pt, <span class="type">uint8_t</span> *ct, <span class="type">uint32_t</span> len)</span> &#123;</span><br><span class="line"></span><br><span class="line">    AesKey aesKey;</span><br><span class="line">    <span class="type">uint8_t</span> *pos = ct;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> *rk = aesKey.eK;  <span class="comment">//解密秘钥指针</span></span><br><span class="line">    <span class="type">uint8_t</span> out[BLOCKSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> actualKey[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> state[<span class="number">4</span>][<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == pt || <span class="literal">NULL</span> == ct)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;param err.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen &gt; <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyLen must be 16.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len % BLOCKSIZE)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inLen is invalid.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(actualKey, key, keyLen);</span><br><span class="line">    keyExpansion(actualKey, <span class="number">16</span>, &amp;aesKey);  <span class="comment">// 秘钥扩展</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用ECB模式循环加密多个分组长度的数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += BLOCKSIZE) &#123;</span><br><span class="line">		<span class="comment">// 把16字节的明文转换为4x4状态矩阵来进行处理</span></span><br><span class="line">        loadStateArray(state, pt);</span><br><span class="line">        <span class="comment">// 轮秘钥加</span></span><br><span class="line">        addRoundKey(state, rk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">10</span>; ++j) &#123;</span><br><span class="line">            rk += <span class="number">4</span>;</span><br><span class="line">            subBytes(state);   <span class="comment">// 字节替换</span></span><br><span class="line">            shiftRows(state);  <span class="comment">// 行移位</span></span><br><span class="line">            mixColumns(state); <span class="comment">// 列混合</span></span><br><span class="line">            addRoundKey(state, rk); <span class="comment">// 轮秘钥加</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        subBytes(state);    <span class="comment">// 字节替换</span></span><br><span class="line">        shiftRows(state);  <span class="comment">// 行移位</span></span><br><span class="line">        <span class="comment">// 此处不进行列混合</span></span><br><span class="line">        addRoundKey(state, rk+<span class="number">4</span>); <span class="comment">// 轮秘钥加</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 把4x4状态矩阵转换为uint8_t一维数组输出保存</span></span><br><span class="line">        storeStateArray(state, pos);</span><br><span class="line"></span><br><span class="line">        pos += BLOCKSIZE;  <span class="comment">// 加密数据内存指针移动到下一个分组</span></span><br><span class="line">        pt += BLOCKSIZE;   <span class="comment">// 明文数据指针移动到下一个分组</span></span><br><span class="line">        rk = aesKey.eK;    <span class="comment">// 恢复rk指针到秘钥初始位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES128解密， 参数要求同加密</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aesDecrypt</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, <span class="type">const</span> <span class="type">uint8_t</span> *ct, <span class="type">uint8_t</span> *pt, <span class="type">uint32_t</span> len)</span> &#123;</span><br><span class="line">    AesKey aesKey;</span><br><span class="line">    <span class="type">uint8_t</span> *pos = pt;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> *rk = aesKey.dK;  <span class="comment">//解密秘钥指针</span></span><br><span class="line">    <span class="type">uint8_t</span> out[BLOCKSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> actualKey[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> state[<span class="number">4</span>][<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == ct || <span class="literal">NULL</span> == pt)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;param err.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen &gt; <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyLen must be 16.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len % BLOCKSIZE)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inLen is invalid.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(actualKey, key, keyLen);</span><br><span class="line">    keyExpansion(actualKey, <span class="number">16</span>, &amp;aesKey);  <span class="comment">//秘钥扩展，同加密</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += BLOCKSIZE) &#123;</span><br><span class="line">        <span class="comment">// 把16字节的密文转换为4x4状态矩阵来进行处理</span></span><br><span class="line">        loadStateArray(state, ct);</span><br><span class="line">        <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line">        addRoundKey(state, rk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">10</span>; ++j) &#123;</span><br><span class="line">            rk += <span class="number">4</span>;</span><br><span class="line">            invShiftRows(state);    <span class="comment">// 逆行移位</span></span><br><span class="line">            invSubBytes(state);     <span class="comment">// 逆字节替换，这两步顺序可以颠倒</span></span><br><span class="line">            addRoundKey(state, rk); <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line">            invMixColumns(state);   <span class="comment">// 逆列混合</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        invSubBytes(state);   <span class="comment">// 逆字节替换</span></span><br><span class="line">        invShiftRows(state);  <span class="comment">// 逆行移位</span></span><br><span class="line">        <span class="comment">// 此处没有逆列混合</span></span><br><span class="line">        addRoundKey(state, rk+<span class="number">4</span>);  <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line"></span><br><span class="line">        storeStateArray(state, pos);  <span class="comment">// 保存明文数据</span></span><br><span class="line">        pos += BLOCKSIZE;  <span class="comment">// 输出数据内存指针移位分组长度</span></span><br><span class="line">        ct += BLOCKSIZE;   <span class="comment">// 输入数据内存指针移位分组长度</span></span><br><span class="line">        rk = aesKey.dK;    <span class="comment">// 恢复rk指针到秘钥初始位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方便输出16进制数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHex</span><span class="params">(<span class="type">uint8_t</span> *ptr, <span class="type">int</span> len, <span class="type">char</span> *tag)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\ndata[%d]: &quot;</span>, tag, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2X &quot;</span>, *ptr++);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="加解密脚本-2"><a href="#加解密脚本-2" class="headerlink" title="加解密脚本"></a>加解密脚本</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> S[<span class="number">16</span>][<span class="number">16</span>] = &#123; <span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆S盒</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> S2[<span class="number">16</span>][<span class="number">16</span>] = &#123; <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取整形数据的低8位的左4个位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getLeft4Bit</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">	<span class="type">int</span> left = num &amp; <span class="number">0x000000f0</span>;</span><br><span class="line">	<span class="keyword">return</span> left &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取整形数据的低8位的右4个位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getRight4Bit</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> num &amp; <span class="number">0x0000000f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引，从S盒中获得元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getNumFromSBox</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">	<span class="type">int</span> row = getLeft4Bit(index);</span><br><span class="line">	<span class="type">int</span> col = getRight4Bit(index);</span><br><span class="line">	<span class="keyword">return</span> S[row][col];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把一个字符转变成整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getIntFromChar</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">	<span class="type">int</span> result = (<span class="type">int</span>)c;</span><br><span class="line">	<span class="keyword">return</span> result &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把16个字符转变成4X4的数组，</span></span><br><span class="line"><span class="comment"> * 该矩阵中字节的排列顺序为从上到下，</span></span><br><span class="line"><span class="comment"> * 从左到右依次排列。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">convertToIntArray</span><span class="params">(<span class="type">char</span>* str, <span class="type">int</span> pa[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			pa[j][i] = getIntFromChar(str[k]);</span><br><span class="line">			k++;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印4X4的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">printArray</span><span class="params">(<span class="type">int</span> a[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;a[%d][%d] = 0x%x &quot;</span>, i, j, a[i][j]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印字符串的ASSCI，</span></span><br><span class="line"><span class="comment"> * 以十六进制显示。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">printASSCI</span><span class="params">(<span class="type">char</span>* str, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%x &quot;</span>, getIntFromChar(str[i]));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把连续的4个字符合并成一个4字节的整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getWordFromStr</span><span class="params">(<span class="type">char</span>* str)</span> &#123;</span><br><span class="line">	<span class="type">int</span> one = getIntFromChar(str[<span class="number">0</span>]);</span><br><span class="line">	one = one &lt;&lt; <span class="number">24</span>;</span><br><span class="line">	<span class="type">int</span> two = getIntFromChar(str[<span class="number">1</span>]);</span><br><span class="line">	two = two &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	<span class="type">int</span> three = getIntFromChar(str[<span class="number">2</span>]);</span><br><span class="line">	three = three &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	<span class="type">int</span> four = getIntFromChar(str[<span class="number">3</span>]);</span><br><span class="line">	<span class="keyword">return</span> one | two | three | four;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把一个4字节的数的第一、二、三、四个字节取出，</span></span><br><span class="line"><span class="comment"> * 入进一个4个元素的整型数组里面。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">splitIntToArray</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> one = num &gt;&gt; <span class="number">24</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">0</span>] = one &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	<span class="type">int</span> two = num &gt;&gt; <span class="number">16</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">1</span>] = two &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	<span class="type">int</span> three = num &gt;&gt; <span class="number">8</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">2</span>] = three &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">3</span>] = num &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数组中的元素循环左移step位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">leftLoop4int</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>], <span class="type">int</span> step)</span> &#123;</span><br><span class="line">	<span class="type">int</span> temp[<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		temp[i] = <span class="built_in">array</span>[i];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> index = step % <span class="number">4</span> == <span class="number">0</span> ? <span class="number">0</span> : step % <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">array</span>[i] = temp[index];</span><br><span class="line">		index++;</span><br><span class="line">		index = index % <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把数组中的第一、二、三和四元素分别作为</span></span><br><span class="line"><span class="comment"> * 4字节整型的第一、二、三和四字节，合并成一个4字节整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">mergeArrayToInt</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> one = <span class="built_in">array</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>;</span><br><span class="line">	<span class="type">int</span> two = <span class="built_in">array</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	<span class="type">int</span> three = <span class="built_in">array</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	<span class="type">int</span> four = <span class="built_in">array</span>[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">return</span> one | two | three | four;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常量轮值表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> Rcon[<span class="number">10</span>] = &#123; <span class="number">0x01000000</span>, <span class="number">0x02000000</span>,</span><br><span class="line">	<span class="number">0x04000000</span>, <span class="number">0x08000000</span>,</span><br><span class="line">	<span class="number">0x10000000</span>, <span class="number">0x20000000</span>,</span><br><span class="line">	<span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span> &#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 密钥扩展中的T函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">T</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> round)</span> &#123;</span><br><span class="line">	<span class="type">int</span> numArray[<span class="number">4</span>];</span><br><span class="line">	splitIntToArray(num, numArray);</span><br><span class="line">	leftLoop4int(numArray, <span class="number">1</span>);<span class="comment">//字循环</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//字节代换</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		numArray[i] = getNumFromSBox(numArray[i]);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> result = mergeArrayToInt(numArray);</span><br><span class="line">	<span class="keyword">return</span> result ^ Rcon[round];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密钥对应的扩展数组</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> w[<span class="number">44</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展密钥，结果是把w[44]中的每个元素初始化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">extendKey</span><span class="params">(<span class="type">char</span>* key)</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		w[i] = getWordFromStr(key + i * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">4</span>, j = <span class="number">0</span>; i &lt; <span class="number">44</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (i % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">			w[i] = w[i - <span class="number">4</span>] ^ T(w[i - <span class="number">1</span>], j);</span><br><span class="line">			j++;<span class="comment">//下一轮</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			w[i] = w[i - <span class="number">4</span>] ^ w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 轮密钥加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">addRoundKey</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>], <span class="type">int</span> round)</span> &#123;</span><br><span class="line">	<span class="type">int</span> warray[<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">		splitIntToArray(w[round * <span class="number">4</span> + i], warray);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			<span class="built_in">array</span>[j][i] = <span class="built_in">array</span>[j][i] ^ warray[j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字节代换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">subBytes</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			<span class="built_in">array</span>[i][j] = getNumFromSBox(<span class="built_in">array</span>[i][j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 行移位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">shiftRows</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> rowTwo[<span class="number">4</span>], rowThree[<span class="number">4</span>], rowFour[<span class="number">4</span>];</span><br><span class="line">	<span class="comment">//复制状态矩阵的第2,3,4行</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		rowTwo[i] = <span class="built_in">array</span>[<span class="number">1</span>][i];</span><br><span class="line">		rowThree[i] = <span class="built_in">array</span>[<span class="number">2</span>][i];</span><br><span class="line">		rowFour[i] = <span class="built_in">array</span>[<span class="number">3</span>][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//循环左移相应的位数</span></span><br><span class="line">	leftLoop4int(rowTwo, <span class="number">1</span>);</span><br><span class="line">	leftLoop4int(rowThree, <span class="number">2</span>);</span><br><span class="line">	leftLoop4int(rowFour, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//把左移后的行复制回状态矩阵中</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">1</span>][i] = rowTwo[i];</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">2</span>][i] = rowThree[i];</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">3</span>][i] = rowFour[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列混合要用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> colM[<span class="number">4</span>][<span class="number">4</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">	<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">	<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">	<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul2</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="type">int</span> result = s &lt;&lt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> a7 = result &amp; <span class="number">0x00000100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (a7 != <span class="number">0</span>) &#123;</span><br><span class="line">		result = result &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">		result = result ^ <span class="number">0x1b</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul3</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul4</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(GFMul2(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul8</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(GFMul4(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul9</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul8(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul11</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul9(s) ^ GFMul2(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul12</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul8(s) ^ GFMul4(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul13</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul12(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul14</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul12(s) ^ GFMul2(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GF上的二元运算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="type">int</span> result;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">		result = s;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">2</span>)</span><br><span class="line">		result = GFMul2(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">3</span>)</span><br><span class="line">		result = GFMul3(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">0x9</span>)</span><br><span class="line">		result = GFMul9(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">0xb</span>)<span class="comment">//11</span></span><br><span class="line">		result = GFMul11(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">0xd</span>)<span class="comment">//13</span></span><br><span class="line">		result = GFMul13(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">0xe</span>)<span class="comment">//14</span></span><br><span class="line">		result = GFMul14(s);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">mixColumns</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = <span class="built_in">array</span>[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			<span class="built_in">array</span>[i][j] = GFMul(colM[i][<span class="number">0</span>], tempArray[<span class="number">0</span>][j]) ^ GFMul(colM[i][<span class="number">1</span>], tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ GFMul(colM[i][<span class="number">2</span>], tempArray[<span class="number">2</span>][j]) ^ GFMul(colM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把4X4数组转回字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">convertArrayToStr</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>], <span class="type">char</span>* str)</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			*str++ = (<span class="type">char</span>)<span class="built_in">array</span>[j][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查密钥长度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">checkKeyLen</span><span class="params">(<span class="type">int</span> len)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (len == <span class="number">16</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数 p: 明文的字符串数组。</span></span><br><span class="line"><span class="comment"> * 参数 plen: 明文的长度。</span></span><br><span class="line"><span class="comment"> * 参数 key: 密钥的字符串数组。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes</span><span class="params">(<span class="type">char</span>* p, <span class="type">int</span> plen, <span class="type">char</span>* key)</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> keylen = <span class="built_in">strlen</span>(key);</span><br><span class="line">	<span class="keyword">if</span> (plen == <span class="number">0</span> || plen % <span class="number">16</span> != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!checkKeyLen(keylen)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	extendKey(key);<span class="comment">//扩展密钥</span></span><br><span class="line">	<span class="type">int</span> pArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; plen; k += <span class="number">16</span>) &#123;</span><br><span class="line">		convertToIntArray(p + k, pArray);</span><br><span class="line"></span><br><span class="line">		addRoundKey(pArray, <span class="number">0</span>);<span class="comment">//一开始的轮密钥加</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i++) &#123;<span class="comment">//前9轮</span></span><br><span class="line"></span><br><span class="line">			subBytes(pArray);<span class="comment">//字节代换</span></span><br><span class="line"></span><br><span class="line">			shiftRows(pArray);<span class="comment">//行移位</span></span><br><span class="line"></span><br><span class="line">			mixColumns(pArray);<span class="comment">//列混合</span></span><br><span class="line"></span><br><span class="line">			addRoundKey(pArray, i);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//第10轮</span></span><br><span class="line">		subBytes(pArray);<span class="comment">//字节代换</span></span><br><span class="line"></span><br><span class="line">		shiftRows(pArray);<span class="comment">//行移位</span></span><br><span class="line"></span><br><span class="line">		addRoundKey(pArray, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		convertArrayToStr(pArray, p + k);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引从逆S盒中获取值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">getNumFromS1Box</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">	<span class="type">int</span> row = getLeft4Bit(index);</span><br><span class="line">	<span class="type">int</span> col = getRight4Bit(index);</span><br><span class="line">	<span class="keyword">return</span> S2[row][col];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆字节变换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">deSubBytes</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			<span class="built_in">array</span>[i][j] = getNumFromS1Box(<span class="built_in">array</span>[i][j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把4个元素的数组循环右移step位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">rightLoop4int</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>], <span class="type">int</span> step)</span> &#123;</span><br><span class="line">	<span class="type">int</span> temp[<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		temp[i] = <span class="built_in">array</span>[i];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> index = step % <span class="number">4</span> == <span class="number">0</span> ? <span class="number">0</span> : step % <span class="number">4</span>;</span><br><span class="line">	index = <span class="number">3</span> - index;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		<span class="built_in">array</span>[i] = temp[index];</span><br><span class="line">		index--;</span><br><span class="line">		index = index == <span class="number">-1</span> ? <span class="number">3</span> : index;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆行移位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">deShiftRows</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> rowTwo[<span class="number">4</span>], rowThree[<span class="number">4</span>], rowFour[<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		rowTwo[i] = <span class="built_in">array</span>[<span class="number">1</span>][i];</span><br><span class="line">		rowThree[i] = <span class="built_in">array</span>[<span class="number">2</span>][i];</span><br><span class="line">		rowFour[i] = <span class="built_in">array</span>[<span class="number">3</span>][i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rightLoop4int(rowTwo, <span class="number">1</span>);</span><br><span class="line">	rightLoop4int(rowThree, <span class="number">2</span>);</span><br><span class="line">	rightLoop4int(rowFour, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">1</span>][i] = rowTwo[i];</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">2</span>][i] = rowThree[i];</span><br><span class="line">		<span class="built_in">array</span>[<span class="number">3</span>][i] = rowFour[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> deColM[<span class="number">4</span>][<span class="number">4</span>] = &#123; <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>,</span><br><span class="line">	<span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>,</span><br><span class="line">	<span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>,</span><br><span class="line">	<span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">deMixColumns</span><span class="params">(<span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = <span class="built_in">array</span>[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			<span class="built_in">array</span>[i][j] = GFMul(deColM[i][<span class="number">0</span>], tempArray[<span class="number">0</span>][j]) ^ GFMul(deColM[i][<span class="number">1</span>], tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ GFMul(deColM[i][<span class="number">2</span>], tempArray[<span class="number">2</span>][j]) ^ GFMul(deColM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把两个4X4数组进行异或</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">addRoundTowArray</span><span class="params">(<span class="type">int</span> aArray[<span class="number">4</span>][<span class="number">4</span>], <span class="type">int</span> bArray[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			aArray[i][j] = aArray[i][j] ^ bArray[i][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从4个32位的密钥字中获得4X4数组，</span></span><br><span class="line"><span class="comment"> * 用于进行逆列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">getArrayFrom4W</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">int</span> index = i * <span class="number">4</span>;</span><br><span class="line">	<span class="type">int</span> colOne[<span class="number">4</span>], colTwo[<span class="number">4</span>], colThree[<span class="number">4</span>], colFour[<span class="number">4</span>];</span><br><span class="line">	splitIntToArray(w[index], colOne);</span><br><span class="line">	splitIntToArray(w[index + <span class="number">1</span>], colTwo);</span><br><span class="line">	splitIntToArray(w[index + <span class="number">2</span>], colThree);</span><br><span class="line">	splitIntToArray(w[index + <span class="number">3</span>], colFour);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">array</span>[i][<span class="number">0</span>] = colOne[i];</span><br><span class="line">		<span class="built_in">array</span>[i][<span class="number">1</span>] = colTwo[i];</span><br><span class="line">		<span class="built_in">array</span>[i][<span class="number">2</span>] = colThree[i];</span><br><span class="line">		<span class="built_in">array</span>[i][<span class="number">3</span>] = colFour[i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数 c: 密文的字符串数组。</span></span><br><span class="line"><span class="comment"> * 参数 clen: 密文的长度。</span></span><br><span class="line"><span class="comment"> * 参数 key: 密钥的字符串数组。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deAes</span><span class="params">(<span class="type">char</span>* c, <span class="type">int</span> clen, <span class="type">char</span>* key)</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> keylen = <span class="built_in">strlen</span>(key);</span><br><span class="line">	<span class="keyword">if</span> (clen == <span class="number">0</span> || clen % <span class="number">16</span> != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!checkKeyLen(keylen)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	extendKey(key);<span class="comment">//扩展密钥</span></span><br><span class="line">	<span class="type">int</span> cArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; clen; k += <span class="number">16</span>) &#123;</span><br><span class="line">		convertToIntArray(c + k, cArray);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		addRoundKey(cArray, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> wArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">9</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">			deSubBytes(cArray);</span><br><span class="line"></span><br><span class="line">			deShiftRows(cArray);</span><br><span class="line"></span><br><span class="line">			deMixColumns(cArray);</span><br><span class="line">			getArrayFrom4W(i, wArray);</span><br><span class="line">			deMixColumns(wArray);</span><br><span class="line"></span><br><span class="line">			addRoundTowArray(cArray, wArray);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		deSubBytes(cArray);</span><br><span class="line"></span><br><span class="line">		deShiftRows(cArray);</span><br><span class="line"></span><br><span class="line">		addRoundKey(cArray, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		convertArrayToStr(cArray, c + k);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">password = <span class="string">b&#x27;1234567812345678&#x27;</span> <span class="comment">#秘钥，b就是表示为bytes类型</span></span><br><span class="line">iv = <span class="string">b&#x27;1234567812345678&#x27;</span> <span class="comment"># iv偏移量，bytes类型</span></span><br><span class="line">text = <span class="string">b&#x27;abcdefghijklmnhi&#x27;</span> <span class="comment">#需要加密的内容，bytes类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aes = AES.new(password,AES.MODE_CBC,iv) <span class="comment">#创建一个aes对象</span></span><br><span class="line"><span class="comment"># AES.MODE_CBC 表示模式是CBC模式</span></span><br><span class="line">en_text = aes.encrypt(text)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;密文：&quot;</span>,en_text) <span class="comment">#加密明文，bytes类型</span></span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;&#x27;</span>   <span class="comment">#要解密的base64代码</span></span><br><span class="line">debase64 = base64.decodebytes(m)</span><br><span class="line"></span><br><span class="line">aes = AES.new(password,AES.MODE_CBC,iv) <span class="comment">#CBC模式下解密需要重新创建一个aes对象</span></span><br><span class="line">den_text = aes.decrypt(debase64)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;明文：&quot;</span>,den_text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> encode</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">password = <span class="string">b&#x27;1234567812345678&#x27;</span> <span class="comment">#秘钥，b就是表示为bytes类型</span></span><br><span class="line"></span><br><span class="line">text = <span class="string">b&#x27;abcdefghijklmnhi&#x27;</span> <span class="comment">#需要加密的内容，bytes类型</span></span><br><span class="line">aes = AES.new(password,AES.MODE_ECB) <span class="comment">#创建一个aes对象</span></span><br><span class="line"><span class="comment"># AES.MODE_ECB 表示模式是ECB模式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;Pd04a4bt7Bcf97KEfgLGQw==&#x27;</span>   <span class="comment">#要解密的base64值</span></span><br><span class="line">en_text = base64.decodebytes(m)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># en_text = aes.encrypt(text) #加密明文</span></span><br><span class="line"><span class="comment"># print(&quot;密文：&quot;,en_text) #加密明文，bytes类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">den_text = aes.decrypt(en_text) <span class="comment"># 解密密文</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;明文：&quot;</span>,den_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(den_text.decode(&#x27;gbk&#x27;))   #中文输出</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解密AES需要逆s盒，逆s盒脚本为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">new_s_box = [</span><br><span class="line">    <span class="number">0x63</span>,<span class="number">0x7c</span>,<span class="number">0x77</span>,<span class="number">0x7b</span>,<span class="number">0xf2</span>,<span class="number">0x6b</span>,<span class="number">0x6f</span>,<span class="number">0xc5</span>,<span class="number">0x30</span>,<span class="number">0x01</span>,<span class="number">0x67</span>,<span class="number">0x2b</span>,<span class="number">0xfe</span>,<span class="number">0xd7</span>,<span class="number">0xab</span>,<span class="number">0x76</span>,<span class="number">0xca</span>,<span class="number">0x82</span>,<span class="number">0xc9</span>,<span class="number">0x7d</span>,<span class="number">0xfa</span>,<span class="number">0x59</span>,<span class="number">0x47</span>,<span class="number">0xf0</span>,<span class="number">0xad</span>,<span class="number">0xd4</span>,<span class="number">0xa2</span>,<span class="number">0xaf</span>,<span class="number">0x9c</span>,<span class="number">0xa4</span>,<span class="number">0x72</span>,<span class="number">0xc0</span>,<span class="number">0xb7</span>,<span class="number">0xfd</span>,<span class="number">0x93</span>,<span class="number">0x26</span>,<span class="number">0x36</span>,<span class="number">0x3f</span>,<span class="number">0xf7</span>,<span class="number">0xcc</span>,<span class="number">0x34</span>,<span class="number">0xa5</span>,<span class="number">0xe5</span>,<span class="number">0xf1</span>,<span class="number">0x71</span>,<span class="number">0xd8</span>,<span class="number">0x31</span>,<span class="number">0x15</span>,<span class="number">0x04</span>,<span class="number">0xc7</span>,<span class="number">0x23</span>,<span class="number">0xc3</span>,<span class="number">0x18</span>,<span class="number">0x96</span>,<span class="number">0x05</span>,<span class="number">0x9a</span>,<span class="number">0x07</span>,<span class="number">0x12</span>,<span class="number">0x80</span>,<span class="number">0xe2</span>,<span class="number">0xeb</span>,<span class="number">0x27</span>,<span class="number">0xb2</span>,<span class="number">0x75</span>,<span class="number">0x09</span>,<span class="number">0x83</span>,<span class="number">0x2c</span>,<span class="number">0x1a</span>,<span class="number">0x1b</span>,<span class="number">0x6e</span>,<span class="number">0x5a</span>,<span class="number">0xa0</span>,<span class="number">0x52</span>,<span class="number">0x3b</span>,<span class="number">0xd6</span>,<span class="number">0xb3</span>,<span class="number">0x29</span>,<span class="number">0xe3</span>,<span class="number">0x2f</span>,<span class="number">0x84</span>,<span class="number">0x53</span>,<span class="number">0xd1</span>,<span class="number">0x00</span>,<span class="number">0xed</span>,<span class="number">0x20</span>,<span class="number">0xfc</span>,<span class="number">0xb1</span>,<span class="number">0x5b</span>,<span class="number">0x6a</span>,<span class="number">0xcb</span>,<span class="number">0xbe</span>,<span class="number">0x39</span>,<span class="number">0x4a</span>,<span class="number">0x4c</span>,<span class="number">0x58</span>,<span class="number">0xcf</span>,<span class="number">0xd0</span>,<span class="number">0xef</span>,<span class="number">0xaa</span>,<span class="number">0xfb</span>,<span class="number">0x43</span>,<span class="number">0x4d</span>,<span class="number">0x33</span>,<span class="number">0x85</span>,<span class="number">0x45</span>,<span class="number">0xf9</span>,<span class="number">0x02</span>,<span class="number">0x7f</span>,<span class="number">0x50</span>,<span class="number">0x3c</span>,<span class="number">0x9f</span>,<span class="number">0xa8</span>,<span class="number">0x51</span>,<span class="number">0xa3</span>,<span class="number">0x40</span>,<span class="number">0x8f</span>,<span class="number">0x92</span>,<span class="number">0x9d</span>,<span class="number">0x38</span>,<span class="number">0xf5</span>,<span class="number">0xbc</span>,<span class="number">0xb6</span>,<span class="number">0xda</span>,<span class="number">0x21</span>,<span class="number">0x10</span>,<span class="number">0xff</span>,<span class="number">0xf3</span>,<span class="number">0xd2</span>,<span class="number">0xcd</span>,<span class="number">0x0c</span>,<span class="number">0x13</span>,<span class="number">0xec</span>,<span class="number">0x5f</span>,<span class="number">0x97</span>,<span class="number">0x44</span>,<span class="number">0x17</span>,<span class="number">0xc4</span>,<span class="number">0xa7</span>,<span class="number">0x7e</span>,<span class="number">0x3d</span>,<span class="number">0x64</span>,<span class="number">0x5d</span>,<span class="number">0x19</span>,<span class="number">0x73</span>,<span class="number">0x60</span>,<span class="number">0x81</span>,<span class="number">0x4f</span>,<span class="number">0xdc</span>,<span class="number">0x22</span>,<span class="number">0x2a</span>,<span class="number">0x90</span>,<span class="number">0x88</span>,<span class="number">0x46</span>,<span class="number">0xee</span>,<span class="number">0xb8</span>,<span class="number">0x14</span>,<span class="number">0xde</span>,<span class="number">0x5e</span>,<span class="number">0x0b</span>,<span class="number">0xdb</span>,<span class="number">0xe0</span>,<span class="number">0x32</span>,<span class="number">0x3a</span>,<span class="number">0x0a</span>,<span class="number">0x49</span>,<span class="number">0x06</span>,<span class="number">0x24</span>,<span class="number">0x5c</span>,<span class="number">0xc2</span>,<span class="number">0xd3</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,<span class="number">0x91</span>,<span class="number">0x95</span>,<span class="number">0xe4</span>,<span class="number">0x79</span>,<span class="number">0xe7</span>,<span class="number">0xc8</span>,<span class="number">0x37</span>,<span class="number">0x6d</span>,<span class="number">0x8d</span>,<span class="number">0xd5</span>,<span class="number">0x4e</span>,<span class="number">0xa9</span>,<span class="number">0x6c</span>,<span class="number">0x56</span>,<span class="number">0xf4</span>,<span class="number">0xea</span>,<span class="number">0x65</span>,<span class="number">0x7a</span>,<span class="number">0xae</span>,<span class="number">0x08</span>,<span class="number">0xba</span>,<span class="number">0x78</span>,<span class="number">0x25</span>,<span class="number">0x2e</span>,<span class="number">0x1c</span>,<span class="number">0xa6</span>,<span class="number">0xb4</span>,<span class="number">0xc6</span>,<span class="number">0xe8</span>,<span class="number">0xdd</span>,<span class="number">0x74</span>,<span class="number">0x1f</span>,<span class="number">0x4b</span>,<span class="number">0xbd</span>,<span class="number">0x8b</span>,<span class="number">0x8a</span>,<span class="number">0x70</span>,<span class="number">0x3e</span>,<span class="number">0xb5</span>,<span class="number">0x66</span>,<span class="number">0x48</span>,<span class="number">0x03</span>,<span class="number">0xf6</span>,<span class="number">0x0e</span>,<span class="number">0x61</span>,<span class="number">0x35</span>,<span class="number">0x57</span>,<span class="number">0xb9</span>,<span class="number">0x86</span>,<span class="number">0xc1</span>,<span class="number">0x1d</span>,<span class="number">0x9e</span>,<span class="number">0xe1</span>,<span class="number">0xf8</span>,<span class="number">0x98</span>,<span class="number">0x11</span>,<span class="number">0x69</span>,<span class="number">0xd9</span>,<span class="number">0x8e</span>,<span class="number">0x94</span>,<span class="number">0x9b</span>,<span class="number">0x1e</span>,<span class="number">0x87</span>,<span class="number">0xe9</span>,<span class="number">0xce</span>,<span class="number">0x55</span>,<span class="number">0x28</span>,<span class="number">0xdf</span>,<span class="number">0x8c</span>,<span class="number">0xa1</span>,<span class="number">0x89</span>,<span class="number">0x0d</span>,<span class="number">0xbf</span>,<span class="number">0xe6</span>,<span class="number">0x42</span>,<span class="number">0x68</span>,<span class="number">0x41</span>,<span class="number">0x99</span>,<span class="number">0x2d</span>,<span class="number">0x0f</span>,<span class="number">0xb0</span>,<span class="number">0x54</span>,<span class="number">0xbb</span>,<span class="number">0x16</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">new_contrary_sbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(new_s_box))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    line = (new_s_box[i]&amp;<span class="number">0xf0</span>)&gt;&gt;<span class="number">4</span></span><br><span class="line">    rol = new_s_box[i]&amp;<span class="number">0xf</span></span><br><span class="line">    new_contrary_sbox[(line*<span class="number">16</span>)+rol] = i</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(new_contrary_sbox))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> new_contrary_sbox:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">hex</span>(i)&#125;</span>,&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h2><p>SM4 的加密过程将数据块分成 128 位（16 字节）的分组进行加密，使用 32 轮加密操作，基于复杂的置换和替代（P-box 和 S-box）。由于其固定的 128 位分组长度，处理非 128 位整数倍的明文数据时，通常需要进行填充。主要包含异或、移位以及盒变换操作。它分为密钥拓展和加&#x2F;解密两个模块，这两个模块的流程大同小异。其中，移位变换是指循环左移；盒变换是一个将8bit输入映射到8bit输出的变换，是一个固定的变换。</p>
<p>代码分析（来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42568323/article/details/141687655">Python实现SM4加解密算法_sm4 python-CSDN博客</a>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># S盒，用于字节替换</span></span><br><span class="line">S_BOX = [</span><br><span class="line">    <span class="number">0xd6</span>, <span class="number">0x90</span>, <span class="number">0xe9</span>, <span class="number">0xfe</span>, <span class="number">0xcc</span>, <span class="number">0xe1</span>, <span class="number">0x3d</span>, <span class="number">0xb7</span>, <span class="number">0x16</span>, <span class="number">0xb6</span>, <span class="number">0x14</span>, <span class="number">0xc2</span>, <span class="number">0x28</span>, <span class="number">0xfb</span>, <span class="number">0x2c</span>, <span class="number">0x05</span>,</span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x76</span>, <span class="number">0x2a</span>, <span class="number">0xbe</span>, <span class="number">0x04</span>, <span class="number">0xc3</span>, <span class="number">0xaa</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x99</span>,</span><br><span class="line">    <span class="number">0x9c</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xf4</span>, <span class="number">0x91</span>, <span class="number">0xef</span>, <span class="number">0x98</span>, <span class="number">0x7a</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0b</span>, <span class="number">0x43</span>, <span class="number">0xed</span>, <span class="number">0xcf</span>, <span class="number">0xac</span>, <span class="number">0x62</span>,</span><br><span class="line">    <span class="number">0xe4</span>, <span class="number">0xb3</span>, <span class="number">0x1c</span>, <span class="number">0xa9</span>, <span class="number">0xc9</span>, <span class="number">0x08</span>, <span class="number">0xe8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xdf</span>, <span class="number">0x94</span>, <span class="number">0xfa</span>, <span class="number">0x75</span>, <span class="number">0x8f</span>, <span class="number">0x3f</span>, <span class="number">0xa6</span>,</span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xa7</span>, <span class="number">0xfc</span>, <span class="number">0xf3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xba</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3c</span>, <span class="number">0x19</span>, <span class="number">0xe6</span>, <span class="number">0x85</span>, <span class="number">0x4f</span>, <span class="number">0xa8</span>,</span><br><span class="line">    <span class="number">0x68</span>, <span class="number">0x6b</span>, <span class="number">0x81</span>, <span class="number">0xb2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xda</span>, <span class="number">0x8b</span>, <span class="number">0xf8</span>, <span class="number">0xeb</span>, <span class="number">0x0f</span>, <span class="number">0x4b</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9d</span>, <span class="number">0x35</span>,</span><br><span class="line">    <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0x0e</span>, <span class="number">0x5e</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xd1</span>, <span class="number">0xa2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7c</span>, <span class="number">0x3b</span>, <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0xd4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9f</span>, <span class="number">0xd3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4c</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xe7</span>, <span class="number">0xa0</span>, <span class="number">0xc4</span>, <span class="number">0xc8</span>, <span class="number">0x9e</span>,</span><br><span class="line">    <span class="number">0xea</span>, <span class="number">0xbf</span>, <span class="number">0x8a</span>, <span class="number">0xd2</span>, <span class="number">0x40</span>, <span class="number">0xc7</span>, <span class="number">0x38</span>, <span class="number">0xb5</span>, <span class="number">0xa3</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0xce</span>, <span class="number">0xf9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xa1</span>,</span><br><span class="line">    <span class="number">0xe0</span>, <span class="number">0xae</span>, <span class="number">0x5d</span>, <span class="number">0xa4</span>, <span class="number">0x9b</span>, <span class="number">0x34</span>, <span class="number">0x1a</span>, <span class="number">0x55</span>, <span class="number">0xad</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xf5</span>, <span class="number">0x8c</span>, <span class="number">0xb1</span>, <span class="number">0xe3</span>,</span><br><span class="line">    <span class="number">0x1d</span>, <span class="number">0xf6</span>, <span class="number">0xe2</span>, <span class="number">0x2e</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xca</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xab</span>, <span class="number">0x0d</span>, <span class="number">0x53</span>, <span class="number">0x4e</span>, <span class="number">0x6f</span>,</span><br><span class="line">    <span class="number">0xd5</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xde</span>, <span class="number">0xfd</span>, <span class="number">0x8e</span>, <span class="number">0x2f</span>, <span class="number">0x03</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x72</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x8d</span>, <span class="number">0x1b</span>, <span class="number">0xaf</span>, <span class="number">0x92</span>, <span class="number">0xbb</span>, <span class="number">0xdd</span>, <span class="number">0xbc</span>, <span class="number">0x7f</span>, <span class="number">0x11</span>, <span class="number">0xd9</span>, <span class="number">0x5c</span>, <span class="number">0x41</span>, <span class="number">0x1f</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd8</span>,</span><br><span class="line">    <span class="number">0x0a</span>, <span class="number">0xc1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xa5</span>, <span class="number">0xcd</span>, <span class="number">0x7b</span>, <span class="number">0xbd</span>, <span class="number">0x2d</span>, <span class="number">0x74</span>, <span class="number">0xd0</span>, <span class="number">0x12</span>, <span class="number">0xb8</span>, <span class="number">0xe5</span>, <span class="number">0xb4</span>, <span class="number">0xb0</span>,</span><br><span class="line">    <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4a</span>, <span class="number">0x0c</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7e</span>, <span class="number">0x65</span>, <span class="number">0xb9</span>, <span class="number">0xf1</span>, <span class="number">0x09</span>, <span class="number">0xc5</span>, <span class="number">0x6e</span>, <span class="number">0xc6</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x18</span>, <span class="number">0xf0</span>, <span class="number">0x7d</span>, <span class="number">0xec</span>, <span class="number">0x3a</span>, <span class="number">0xdc</span>, <span class="number">0x4d</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xee</span>, <span class="number">0x5f</span>, <span class="number">0x3e</span>, <span class="number">0xd7</span>, <span class="number">0xcb</span>, <span class="number">0x39</span>, <span class="number">0x48</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 轮常数，用于密钥扩展</span></span><br><span class="line">FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 固定参数，用于轮密钥生成</span></span><br><span class="line">CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>,</span><br><span class="line">    <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>,</span><br><span class="line">    <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>,</span><br><span class="line">    <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>,</span><br><span class="line">    <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">byte_sub</span>(<span class="params">byte</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;S盒字节替换&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> S_BOX[byte]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l_transformation</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;线性变换&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> b ^ (b &lt;&lt; <span class="number">2</span>) ^ (b &lt;&lt; <span class="number">10</span>) ^ (b &lt;&lt; <span class="number">18</span>) ^ (b &lt;&lt; <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t_function</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;T函数，包括S盒替换和线性变换&quot;&quot;&quot;</span></span><br><span class="line">    b = byte_sub((x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span> | \</span><br><span class="line">        byte_sub((x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span> | \</span><br><span class="line">        byte_sub((x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">8</span> | \</span><br><span class="line">        byte_sub(x &amp; <span class="number">0xFF</span>)</span><br><span class="line">    <span class="keyword">return</span> l_transformation(b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_expansion</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;密钥扩展生成32轮密钥&quot;&quot;&quot;</span></span><br><span class="line">    K = [key[i] ^ FK[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    rk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = K[i] ^ t_function(K[i + <span class="number">1</span>] ^ K[i + <span class="number">2</span>] ^ K[i + <span class="number">3</span>] ^ CK[i])</span><br><span class="line">        rk.append(temp)</span><br><span class="line">        K.append(temp)</span><br><span class="line">    <span class="keyword">return</span> rk</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt_block</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;SM4单块加密&quot;&quot;&quot;</span></span><br><span class="line">    rk = key_expansion(key)</span><br><span class="line">    X = plaintext.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = X[i] ^ t_function(X[i + <span class="number">1</span>] ^ X[i + <span class="number">2</span>] ^ X[i + <span class="number">3</span>] ^ rk[i])</span><br><span class="line">        X.append(temp)</span><br><span class="line">    <span class="keyword">return</span> X[<span class="number">35</span>:<span class="number">31</span>:-<span class="number">1</span>]  <span class="comment"># 反序输出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_decrypt_block</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;SM4单块解密&quot;&quot;&quot;</span></span><br><span class="line">    rk = key_expansion(key)[::-<span class="number">1</span>]  <span class="comment"># 轮密钥反序</span></span><br><span class="line">    X = ciphertext.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = X[i] ^ t_function(X[i + <span class="number">1</span>] ^ X[i + <span class="number">2</span>] ^ X[i + <span class="number">3</span>] ^ rk[i])</span><br><span class="line">        X.append(temp)</span><br><span class="line">    <span class="keyword">return</span> X[<span class="number">35</span>:<span class="number">31</span>:-<span class="number">1</span>]  <span class="comment"># 反序输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例使用</span></span><br><span class="line">plaintext = [<span class="number">0x01234567</span>, <span class="number">0x89abcdef</span>, <span class="number">0xfedcba98</span>, <span class="number">0x76543210</span>]</span><br><span class="line">key = [<span class="number">0x01234567</span>, <span class="number">0x89abcdef</span>, <span class="number">0xfedcba98</span>, <span class="number">0x76543210</span>]</span><br><span class="line"></span><br><span class="line">ciphertext = sm4_encrypt_block(plaintext, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;加密后的密文: <span class="subst">&#123;ciphertext&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">decrypted_text = sm4_decrypt_block(ciphertext, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密后的明文: <span class="subst">&#123;decrypted_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="常用解密脚本"><a href="#常用解密脚本" class="headerlink" title="常用解密脚本"></a>常用解密脚本</h4><p>来自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/stx0529/articles/17358663.html">sm4 加解密 ( python版本) - 宁青楼 - 博客园</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author: 沈天巡</span></span><br><span class="line"><span class="string">date:2023/4/27-10:33</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">说明：</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM4</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    国产加密 sm4加解密</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.crypt_sm4 = sm4.CryptSM4()  <span class="comment"># 实例化</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">str_to_hexStr</span>(<span class="params">self , hex_str</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        字符串转hex</span></span><br><span class="line"><span class="string">        :param hex_str: 字符串</span></span><br><span class="line"><span class="string">        :return: hex</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        hex_data = hex_str.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        str_bin = binascii.unhexlify(hex_data)</span><br><span class="line">        <span class="keyword">return</span> str_bin.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encryptSM4</span>(<span class="params">self , encrypt_key , value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        国密sm4加密</span></span><br><span class="line"><span class="string">        :param encrypt_key: sm4加密key</span></span><br><span class="line"><span class="string">        :param value: 待加密的字符串</span></span><br><span class="line"><span class="string">        :return: sm4加密后的十六进制值</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        crypt_sm4 = <span class="variable language_">self</span>.crypt_sm4</span><br><span class="line">        crypt_sm4.set_key(encrypt_key.encode() , sm4.SM4_ENCRYPT)  <span class="comment"># 设置密钥</span></span><br><span class="line">        date_str = <span class="built_in">str</span>(value)</span><br><span class="line">        encrypt_value = crypt_sm4.crypt_ecb(date_str.encode())  <span class="comment"># 开始加密。bytes类型</span></span><br><span class="line">        <span class="keyword">return</span> encrypt_value.<span class="built_in">hex</span>()  <span class="comment"># 返回十六进制值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decryptSM4</span>(<span class="params">self , decrypt_key , encrypt_value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        国密sm4解密</span></span><br><span class="line"><span class="string">        :param decrypt_key:sm4加密key</span></span><br><span class="line"><span class="string">        :param encrypt_value: 待解密的十六进制值</span></span><br><span class="line"><span class="string">        :return: 原字符串</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        crypt_sm4 = <span class="variable language_">self</span>.crypt_sm4</span><br><span class="line">        crypt_sm4.set_key(decrypt_key.encode() , sm4.SM4_DECRYPT)  <span class="comment"># 设置密钥</span></span><br><span class="line">        decrypt_value = crypt_sm4.crypt_ecb(<span class="built_in">bytes</span>.fromhex(encrypt_value))  <span class="comment"># 开始解密。十六进制类型</span></span><br><span class="line">        <span class="keyword">return</span> decrypt_value.decode()</span><br><span class="line">        <span class="comment"># return self.str_to_hexStr(decrypt_value.hex())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    key = <span class="string">&quot;love_is_the_soul&quot;</span></span><br><span class="line">    strData = <span class="string">&quot;jntm&quot;</span></span><br><span class="line">    SM4 = SM4()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原字符：&quot;</span> , strData)</span><br><span class="line">    encData = SM4.encryptSM4(key , strData)  <span class="comment"># 加密后的数据，返回bytes类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sm4加密结果：&quot;</span> , encData)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># decData = SM4.decryptSM4(key , encData)</span></span><br><span class="line">    <span class="comment"># print(&quot;sm4解密结果：&quot; , decData)  # 解密后的数据</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="blowfish"><a href="#blowfish" class="headerlink" title="blowfish"></a>blowfish</h2><p>BlowFish是一个<strong>对称区块</strong>加密算法。每次加密数据为 <strong>64位</strong> （2个int)类型数据大小。八个字节。密钥采用32-448位。进行多轮加密在加密或者初始化的过程中会使用两个盒来进行加密分别是<strong>PBOX</strong> 以及<strong>SBOX</strong>，这两个盒都是预计产生的，可以看成常数。</p>
<p>大概流程：对盒中PBOX的进行轮询与key进行加密。再用一遍加密函数加密0来改变PBOX和SBOX中的值。最后用明文去查找表数据进行运算替换。</p>
<p>常量特征</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line">p_box = [</span><br><span class="line">    <span class="number">0x243F6A88</span>, <span class="number">0x85A308D3</span>, <span class="number">0x13198A2E</span>, <span class="number">0x03707344</span>,</span><br><span class="line">    <span class="number">0xA4093822</span>, <span class="number">0x299F31D0</span>, <span class="number">0x082EFA98</span>, <span class="number">0xEC4E6C89</span>,</span><br><span class="line">    <span class="number">0x452821E6</span>, <span class="number">0x38D01377</span>, <span class="number">0xBE5466CF</span>, <span class="number">0x34E90C6C</span>,</span><br><span class="line">    <span class="number">0xC0AC29B7</span>, <span class="number">0xC97C50DD</span>, <span class="number">0x3F84D5B5</span>, <span class="number">0xB5470917</span>,</span><br><span class="line">    <span class="number">0x9216D5D9</span>, <span class="number">0x8979FB1B</span>]</span><br><span class="line"></span><br><span class="line">s_box = [</span><br><span class="line">    [<span class="number">0xD1310BA6</span>, <span class="number">0x98DFB5AC</span>, <span class="number">0x2FFD72DB</span>, <span class="number">0xD01ADFB7</span>,</span><br><span class="line">     <span class="number">0xB8E1AFED</span>, <span class="number">0x6A267E96</span>, <span class="number">0xBA7C9045</span>, <span class="number">0xF12C7F99</span>,</span><br><span class="line">     <span class="number">0x24A19947</span>, <span class="number">0xB3916CF7</span>, <span class="number">0x0801F2E2</span>, <span class="number">0x858EFC16</span>,</span><br><span class="line">     <span class="number">0x636920D8</span>, <span class="number">0x71574E69</span>, <span class="number">0xA458FEA3</span>, <span class="number">0xF4933D7E</span>,</span><br><span class="line">     <span class="number">0x0D95748F</span>, <span class="number">0x728EB658</span>, <span class="number">0x718BCD58</span>, <span class="number">0x82154AEE</span>,</span><br><span class="line">     <span class="number">0x7B54A41D</span>, <span class="number">0xC25A59B5</span>, <span class="number">0x9C30D539</span>, <span class="number">0x2AF26013</span>,</span><br><span class="line">     <span class="number">0xC5D1B023</span>, <span class="number">0x286085F0</span>, <span class="number">0xCA417918</span>, <span class="number">0xB8DB38EF</span>,</span><br><span class="line">     <span class="number">0x8E79DCB0</span>, <span class="number">0x603A180E</span>, <span class="number">0x6C9E0E8B</span>, <span class="number">0xB01E8A3E</span>,</span><br><span class="line">     <span class="number">0xD71577C1</span>, <span class="number">0xBD314B27</span>, <span class="number">0x78AF2FDA</span>, <span class="number">0x55605C60</span>,</span><br><span class="line">     <span class="number">0xE65525F3</span>, <span class="number">0xAA55AB94</span>, <span class="number">0x57489862</span>, <span class="number">0x63E81440</span>,</span><br><span class="line">     <span class="number">0x55CA396A</span>, <span class="number">0x2AAB10B6</span>, <span class="number">0xB4CC5C34</span>, <span class="number">0x1141E8CE</span>,</span><br><span class="line">     <span class="number">0xA15486AF</span>, <span class="number">0x7C72E993</span>, <span class="number">0xB3EE1411</span>, <span class="number">0x636FBC2A</span>,</span><br><span class="line">     <span class="number">0x2BA9C55D</span>, <span class="number">0x741831F6</span>, <span class="number">0xCE5C3E16</span>, <span class="number">0x9B87931E</span>,</span><br><span class="line">     <span class="number">0xAFD6BA33</span>, <span class="number">0x6C24CF5C</span>, <span class="number">0x7A325381</span>, <span class="number">0x28958677</span>,</span><br><span class="line">     <span class="number">0x3B8F4898</span>, <span class="number">0x6B4BB9AF</span>, <span class="number">0xC4BFE81B</span>, <span class="number">0x66282193</span>,</span><br><span class="line">     <span class="number">0x61D809CC</span>, <span class="number">0xFB21A991</span>, <span class="number">0x487CAC60</span>, <span class="number">0x5DEC8032</span>,</span><br><span class="line">     <span class="number">0xEF845D5D</span>, <span class="number">0xE98575B1</span>, <span class="number">0xDC262302</span>, <span class="number">0xEB651B88</span>,</span><br><span class="line">     <span class="number">0x23893E81</span>, <span class="number">0xD396ACC5</span>, <span class="number">0x0F6D6FF3</span>, <span class="number">0x83F44239</span>,</span><br><span class="line">     <span class="number">0x2E0B4482</span>, <span class="number">0xA4842004</span>, <span class="number">0x69C8F04A</span>, <span class="number">0x9E1F9B5E</span>,</span><br><span class="line">     <span class="number">0x21C66842</span>, <span class="number">0xF6E96C9A</span>, <span class="number">0x670C9C61</span>, <span class="number">0xABD388F0</span>,</span><br><span class="line">     <span class="number">0x6A51A0D2</span>, <span class="number">0xD8542F68</span>, <span class="number">0x960FA728</span>, <span class="number">0xAB5133A3</span>,</span><br><span class="line">     <span class="number">0x6EEF0B6C</span>, <span class="number">0x137A3BE4</span>, <span class="number">0xBA3BF050</span>, <span class="number">0x7EFB2A98</span>,</span><br><span class="line">     <span class="number">0xA1F1651D</span>, <span class="number">0x39AF0176</span>, <span class="number">0x66CA593E</span>, <span class="number">0x82430E88</span>,</span><br><span class="line">     <span class="number">0x8CEE8619</span>, <span class="number">0x456F9FB4</span>, <span class="number">0x7D84A5C3</span>, <span class="number">0x3B8B5EBE</span>,</span><br><span class="line">     <span class="number">0xE06F75D8</span>, <span class="number">0x85C12073</span>, <span class="number">0x401A449F</span>, <span class="number">0x56C16AA6</span>,</span><br><span class="line">     <span class="number">0x4ED3AA62</span>, <span class="number">0x363F7706</span>, <span class="number">0x1BFEDF72</span>, <span class="number">0x429B023D</span>,</span><br><span class="line">     <span class="number">0x37D0D724</span>, <span class="number">0xD00A1248</span>, <span class="number">0xDB0FEAD3</span>, <span class="number">0x49F1C09B</span>,</span><br><span class="line">     <span class="number">0x075372C9</span>, <span class="number">0x80991B7B</span>, <span class="number">0x25D479D8</span>, <span class="number">0xF6E8DEF7</span>,</span><br><span class="line">     <span class="number">0xE3FE501A</span>, <span class="number">0xB6794C3B</span>, <span class="number">0x976CE0BD</span>, <span class="number">0x04C006BA</span>,</span><br><span class="line">     <span class="number">0xC1A94FB6</span>, <span class="number">0x409F60C4</span>, <span class="number">0x5E5C9EC2</span>, <span class="number">0x196A2463</span>,</span><br><span class="line">     <span class="number">0x68FB6FAF</span>, <span class="number">0x3E6C53B5</span>, <span class="number">0x1339B2EB</span>, <span class="number">0x3B52EC6F</span>,</span><br><span class="line">     <span class="number">0x6DFC511F</span>, <span class="number">0x9B30952C</span>, <span class="number">0xCC814544</span>, <span class="number">0xAF5EBD09</span>,</span><br><span class="line">     <span class="number">0xBEE3D004</span>, <span class="number">0xDE334AFD</span>, <span class="number">0x660F2807</span>, <span class="number">0x192E4BB3</span>,</span><br><span class="line">     <span class="number">0xC0CBA857</span>, <span class="number">0x45C8740F</span>, <span class="number">0xD20B5F39</span>, <span class="number">0xB9D3FBDB</span>,</span><br><span class="line">     <span class="number">0x5579C0BD</span>, <span class="number">0x1A60320A</span>, <span class="number">0xD6A100C6</span>, <span class="number">0x402C7279</span>,</span><br><span class="line">     <span class="number">0x679F25FE</span>, <span class="number">0xFB1FA3CC</span>, <span class="number">0x8EA5E9F8</span>, <span class="number">0xDB3222F8</span>,</span><br><span class="line">     <span class="number">0x3C7516DF</span>, <span class="number">0xFD616B15</span>, <span class="number">0x2F501EC8</span>, <span class="number">0xAD0552AB</span>,</span><br><span class="line">     <span class="number">0x323DB5FA</span>, <span class="number">0xFD238760</span>, <span class="number">0x53317B48</span>, <span class="number">0x3E00DF82</span>,</span><br><span class="line">     <span class="number">0x9E5C57BB</span>, <span class="number">0xCA6F8CA0</span>, <span class="number">0x1A87562E</span>, <span class="number">0xDF1769DB</span>,</span><br><span class="line">     <span class="number">0xD542A8F6</span>, <span class="number">0x287EFFC3</span>, <span class="number">0xAC6732C6</span>, <span class="number">0x8C4F5573</span>,</span><br><span class="line">     <span class="number">0x695B27B0</span>, <span class="number">0xBBCA58C8</span>, <span class="number">0xE1FFA35D</span>, <span class="number">0xB8F011A0</span>,</span><br><span class="line">     <span class="number">0x10FA3D98</span>, <span class="number">0xFD2183B8</span>, <span class="number">0x4AFCB56C</span>, <span class="number">0x2DD1D35B</span>,</span><br><span class="line">     <span class="number">0x9A53E479</span>, <span class="number">0xB6F84565</span>, <span class="number">0xD28E49BC</span>, <span class="number">0x4BFB9790</span>,</span><br><span class="line">     <span class="number">0xE1DDF2DA</span>, <span class="number">0xA4CB7E33</span>, <span class="number">0x62FB1341</span>, <span class="number">0xCEE4C6E8</span>,</span><br><span class="line">     <span class="number">0xEF20CADA</span>, <span class="number">0x36774C01</span>, <span class="number">0xD07E9EFE</span>, <span class="number">0x2BF11FB4</span>,</span><br><span class="line">     <span class="number">0x95DBDA4D</span>, <span class="number">0xAE909198</span>, <span class="number">0xEAAD8E71</span>, <span class="number">0x6B93D5A0</span>,</span><br><span class="line">     <span class="number">0xD08ED1D0</span>, <span class="number">0xAFC725E0</span>, <span class="number">0x8E3C5B2F</span>, <span class="number">0x8E7594B7</span>,</span><br><span class="line">     <span class="number">0x8FF6E2FB</span>, <span class="number">0xF2122B64</span>, <span class="number">0x8888B812</span>, <span class="number">0x900DF01C</span>,</span><br><span class="line">     <span class="number">0x4FAD5EA0</span>, <span class="number">0x688FC31C</span>, <span class="number">0xD1CFF191</span>, <span class="number">0xB3A8C1AD</span>,</span><br><span class="line">     <span class="number">0x2F2F2218</span>, <span class="number">0xBE0E1777</span>, <span class="number">0xEA752DFE</span>, <span class="number">0x8B021FA1</span>,</span><br><span class="line">     <span class="number">0xE5A0CC0F</span>, <span class="number">0xB56F74E8</span>, <span class="number">0x18ACF3D6</span>, <span class="number">0xCE89E299</span>,</span><br><span class="line">     <span class="number">0xB4A84FE0</span>, <span class="number">0xFD13E0B7</span>, <span class="number">0x7CC43B81</span>, <span class="number">0xD2ADA8D9</span>,</span><br><span class="line">     <span class="number">0x165FA266</span>, <span class="number">0x80957705</span>, <span class="number">0x93CC7314</span>, <span class="number">0x211A1477</span>,</span><br><span class="line">     <span class="number">0xE6AD2065</span>, <span class="number">0x77B5FA86</span>, <span class="number">0xC75442F5</span>, <span class="number">0xFB9D35CF</span>,</span><br><span class="line">     <span class="number">0xEBCDAF0C</span>, <span class="number">0x7B3E89A0</span>, <span class="number">0xD6411BD3</span>, <span class="number">0xAE1E7E49</span>,</span><br><span class="line">     <span class="number">0x00250E2D</span>, <span class="number">0x2071B35E</span>, <span class="number">0x226800BB</span>, <span class="number">0x57B8E0AF</span>,</span><br><span class="line">     <span class="number">0x2464369B</span>, <span class="number">0xF009B91E</span>, <span class="number">0x5563911D</span>, <span class="number">0x59DFA6AA</span>,</span><br><span class="line">     <span class="number">0x78C14389</span>, <span class="number">0xD95A537F</span>, <span class="number">0x207D5BA2</span>, <span class="number">0x02E5B9C5</span>,</span><br><span class="line">     <span class="number">0x83260376</span>, <span class="number">0x6295CFA9</span>, <span class="number">0x11C81968</span>, <span class="number">0x4E734A41</span>,</span><br><span class="line">     <span class="number">0xB3472DCA</span>, <span class="number">0x7B14A94A</span>, <span class="number">0x1B510052</span>, <span class="number">0x9A532915</span>,</span><br><span class="line">     <span class="number">0xD60F573F</span>, <span class="number">0xBC9BC6E4</span>, <span class="number">0x2B60A476</span>, <span class="number">0x81E67400</span>,</span><br><span class="line">     <span class="number">0x08BA6FB5</span>, <span class="number">0x571BE91F</span>, <span class="number">0xF296EC6B</span>, <span class="number">0x2A0DD915</span>,</span><br><span class="line">     <span class="number">0xB6636521</span>, <span class="number">0xE7B9F9B6</span>, <span class="number">0xFF34052E</span>, <span class="number">0xC5855664</span>,</span><br><span class="line">     <span class="number">0x53B02D5D</span>, <span class="number">0xA99F8FA1</span>, <span class="number">0x08BA4799</span>, <span class="number">0x6E85076A</span>],</span><br><span class="line">    [<span class="number">0x4B7A70E9</span>, <span class="number">0xB5B32944</span>, <span class="number">0xDB75092E</span>, <span class="number">0xC4192623</span>,</span><br><span class="line">     <span class="number">0xAD6EA6B0</span>, <span class="number">0x49A7DF7D</span>, <span class="number">0x9CEE60B8</span>, <span class="number">0x8FEDB266</span>,</span><br><span class="line">     <span class="number">0xECAA8C71</span>, <span class="number">0x699A17FF</span>, <span class="number">0x5664526C</span>, <span class="number">0xC2B19EE1</span>,</span><br><span class="line">     <span class="number">0x193602A5</span>, <span class="number">0x75094C29</span>, <span class="number">0xA0591340</span>, <span class="number">0xE4183A3E</span>,</span><br><span class="line">     <span class="number">0x3F54989A</span>, <span class="number">0x5B429D65</span>, <span class="number">0x6B8FE4D6</span>, <span class="number">0x99F73FD6</span>,</span><br><span class="line">     <span class="number">0xA1D29C07</span>, <span class="number">0xEFE830F5</span>, <span class="number">0x4D2D38E6</span>, <span class="number">0xF0255DC1</span>,</span><br><span class="line">     <span class="number">0x4CDD2086</span>, <span class="number">0x8470EB26</span>, <span class="number">0x6382E9C6</span>, <span class="number">0x021ECC5E</span>,</span><br><span class="line">     <span class="number">0x09686B3F</span>, <span class="number">0x3EBAEFC9</span>, <span class="number">0x3C971814</span>, <span class="number">0x6B6A70A1</span>,</span><br><span class="line">     <span class="number">0x687F3584</span>, <span class="number">0x52A0E286</span>, <span class="number">0xB79C5305</span>, <span class="number">0xAA500737</span>,</span><br><span class="line">     <span class="number">0x3E07841C</span>, <span class="number">0x7FDEAE5C</span>, <span class="number">0x8E7D44EC</span>, <span class="number">0x5716F2B8</span>,</span><br><span class="line">     <span class="number">0xB03ADA37</span>, <span class="number">0xF0500C0D</span>, <span class="number">0xF01C1F04</span>, <span class="number">0x0200B3FF</span>,</span><br><span class="line">     <span class="number">0xAE0CF51A</span>, <span class="number">0x3CB574B2</span>, <span class="number">0x25837A58</span>, <span class="number">0xDC0921BD</span>,</span><br><span class="line">     <span class="number">0xD19113F9</span>, <span class="number">0x7CA92FF6</span>, <span class="number">0x94324773</span>, <span class="number">0x22F54701</span>,</span><br><span class="line">     <span class="number">0x3AE5E581</span>, <span class="number">0x37C2DADC</span>, <span class="number">0xC8B57634</span>, <span class="number">0x9AF3DDA7</span>,</span><br><span class="line">     <span class="number">0xA9446146</span>, <span class="number">0x0FD0030E</span>, <span class="number">0xECC8C73E</span>, <span class="number">0xA4751E41</span>,</span><br><span class="line">     <span class="number">0xE238CD99</span>, <span class="number">0x3BEA0E2F</span>, <span class="number">0x3280BBA1</span>, <span class="number">0x183EB331</span>,</span><br><span class="line">     <span class="number">0x4E548B38</span>, <span class="number">0x4F6DB908</span>, <span class="number">0x6F420D03</span>, <span class="number">0xF60A04BF</span>,</span><br><span class="line">     <span class="number">0x2CB81290</span>, <span class="number">0x24977C79</span>, <span class="number">0x5679B072</span>, <span class="number">0xBCAF89AF</span>,</span><br><span class="line">     <span class="number">0xDE9A771F</span>, <span class="number">0xD9930810</span>, <span class="number">0xB38BAE12</span>, <span class="number">0xDCCF3F2E</span>,</span><br><span class="line">     <span class="number">0x5512721F</span>, <span class="number">0x2E6B7124</span>, <span class="number">0x501ADDE6</span>, <span class="number">0x9F84CD87</span>,</span><br><span class="line">     <span class="number">0x7A584718</span>, <span class="number">0x7408DA17</span>, <span class="number">0xBC9F9ABC</span>, <span class="number">0xE94B7D8C</span>,</span><br><span class="line">     <span class="number">0xEC7AEC3A</span>, <span class="number">0xDB851DFA</span>, <span class="number">0x63094366</span>, <span class="number">0xC464C3D2</span>,</span><br><span class="line">     <span class="number">0xEF1C1847</span>, <span class="number">0x3215D908</span>, <span class="number">0xDD433B37</span>, <span class="number">0x24C2BA16</span>,</span><br><span class="line">     <span class="number">0x12A14D43</span>, <span class="number">0x2A65C451</span>, <span class="number">0x50940002</span>, <span class="number">0x133AE4DD</span>,</span><br><span class="line">     <span class="number">0x71DFF89E</span>, <span class="number">0x10314E55</span>, <span class="number">0x81AC77D6</span>, <span class="number">0x5F11199B</span>,</span><br><span class="line">     <span class="number">0x043556F1</span>, <span class="number">0xD7A3C76B</span>, <span class="number">0x3C11183B</span>, <span class="number">0x5924A509</span>,</span><br><span class="line">     <span class="number">0xF28FE6ED</span>, <span class="number">0x97F1FBFA</span>, <span class="number">0x9EBABF2C</span>, <span class="number">0x1E153C6E</span>,</span><br><span class="line">     <span class="number">0x86E34570</span>, <span class="number">0xEAE96FB1</span>, <span class="number">0x860E5E0A</span>, <span class="number">0x5A3E2AB3</span>,</span><br><span class="line">     <span class="number">0x771FE71C</span>, <span class="number">0x4E3D06FA</span>, <span class="number">0x2965DCB9</span>, <span class="number">0x99E71D0F</span>,</span><br><span class="line">     <span class="number">0x803E89D6</span>, <span class="number">0x5266C825</span>, <span class="number">0x2E4CC978</span>, <span class="number">0x9C10B36A</span>,</span><br><span class="line">     <span class="number">0xC6150EBA</span>, <span class="number">0x94E2EA78</span>, <span class="number">0xA5FC3C53</span>, <span class="number">0x1E0A2DF4</span>,</span><br><span class="line">     <span class="number">0xF2F74EA7</span>, <span class="number">0x361D2B3D</span>, <span class="number">0x1939260F</span>, <span class="number">0x19C27960</span>,</span><br><span class="line">     <span class="number">0x5223A708</span>, <span class="number">0xF71312B6</span>, <span class="number">0xEBADFE6E</span>, <span class="number">0xEAC31F66</span>,</span><br><span class="line">     <span class="number">0xE3BC4595</span>, <span class="number">0xA67BC883</span>, <span class="number">0xB17F37D1</span>, <span class="number">0x018CFF28</span>,</span><br><span class="line">     <span class="number">0xC332DDEF</span>, <span class="number">0xBE6C5AA5</span>, <span class="number">0x65582185</span>, <span class="number">0x68AB9802</span>,</span><br><span class="line">     <span class="number">0xEECEA50F</span>, <span class="number">0xDB2F953B</span>, <span class="number">0x2AEF7DAD</span>, <span class="number">0x5B6E2F84</span>,</span><br><span class="line">     <span class="number">0x1521B628</span>, <span class="number">0x29076170</span>, <span class="number">0xECDD4775</span>, <span class="number">0x619F1510</span>,</span><br><span class="line">     <span class="number">0x13CCA830</span>, <span class="number">0xEB61BD96</span>, <span class="number">0x0334FE1E</span>, <span class="number">0xAA0363CF</span>,</span><br><span class="line">     <span class="number">0xB5735C90</span>, <span class="number">0x4C70A239</span>, <span class="number">0xD59E9E0B</span>, <span class="number">0xCBAADE14</span>,</span><br><span class="line">     <span class="number">0xEECC86BC</span>, <span class="number">0x60622CA7</span>, <span class="number">0x9CAB5CAB</span>, <span class="number">0xB2F3846E</span>,</span><br><span class="line">     <span class="number">0x648B1EAF</span>, <span class="number">0x19BDF0CA</span>, <span class="number">0xA02369B9</span>, <span class="number">0x655ABB50</span>,</span><br><span class="line">     <span class="number">0x40685A32</span>, <span class="number">0x3C2AB4B3</span>, <span class="number">0x319EE9D5</span>, <span class="number">0xC021B8F7</span>,</span><br><span class="line">     <span class="number">0x9B540B19</span>, <span class="number">0x875FA099</span>, <span class="number">0x95F7997E</span>, <span class="number">0x623D7DA8</span>,</span><br><span class="line">     <span class="number">0xF837889A</span>, <span class="number">0x97E32D77</span>, <span class="number">0x11ED935F</span>, <span class="number">0x16681281</span>,</span><br><span class="line">     <span class="number">0x0E358829</span>, <span class="number">0xC7E61FD6</span>, <span class="number">0x96DEDFA1</span>, <span class="number">0x7858BA99</span>,</span><br><span class="line">     <span class="number">0x57F584A5</span>, <span class="number">0x1B227263</span>, <span class="number">0x9B83C3FF</span>, <span class="number">0x1AC24696</span>,</span><br><span class="line">     <span class="number">0xCDB30AEB</span>, <span class="number">0x532E3054</span>, <span class="number">0x8FD948E4</span>, <span class="number">0x6DBC3128</span>,</span><br><span class="line">     <span class="number">0x58EBF2EF</span>, <span class="number">0x34C6FFEA</span>, <span class="number">0xFE28ED61</span>, <span class="number">0xEE7C3C73</span>,</span><br><span class="line">     <span class="number">0x5D4A14D9</span>, <span class="number">0xE864B7E3</span>, <span class="number">0x42105D14</span>, <span class="number">0x203E13E0</span>,</span><br><span class="line">     <span class="number">0x45EEE2B6</span>, <span class="number">0xA3AAABEA</span>, <span class="number">0xDB6C4F15</span>, <span class="number">0xFACB4FD0</span>,</span><br><span class="line">     <span class="number">0xC742F442</span>, <span class="number">0xEF6ABBB5</span>, <span class="number">0x654F3B1D</span>, <span class="number">0x41CD2105</span>,</span><br><span class="line">     <span class="number">0xD81E799E</span>, <span class="number">0x86854DC7</span>, <span class="number">0xE44B476A</span>, <span class="number">0x3D816250</span>,</span><br><span class="line">     <span class="number">0xCF62A1F2</span>, <span class="number">0x5B8D2646</span>, <span class="number">0xFC8883A0</span>, <span class="number">0xC1C7B6A3</span>,</span><br><span class="line">     <span class="number">0x7F1524C3</span>, <span class="number">0x69CB7492</span>, <span class="number">0x47848A0B</span>, <span class="number">0x5692B285</span>,</span><br><span class="line">     <span class="number">0x095BBF00</span>, <span class="number">0xAD19489D</span>, <span class="number">0x1462B174</span>, <span class="number">0x23820E00</span>,</span><br><span class="line">     <span class="number">0x58428D2A</span>, <span class="number">0x0C55F5EA</span>, <span class="number">0x1DADF43E</span>, <span class="number">0x233F7061</span>,</span><br><span class="line">     <span class="number">0x3372F092</span>, <span class="number">0x8D937E41</span>, <span class="number">0xD65FECF1</span>, <span class="number">0x6C223BDB</span>,</span><br><span class="line">     <span class="number">0x7CDE3759</span>, <span class="number">0xCBEE7460</span>, <span class="number">0x4085F2A7</span>, <span class="number">0xCE77326E</span>,</span><br><span class="line">     <span class="number">0xA6078084</span>, <span class="number">0x19F8509E</span>, <span class="number">0xE8EFD855</span>, <span class="number">0x61D99735</span>,</span><br><span class="line">     <span class="number">0xA969A7AA</span>, <span class="number">0xC50C06C2</span>, <span class="number">0x5A04ABFC</span>, <span class="number">0x800BCADC</span>,</span><br><span class="line">     <span class="number">0x9E447A2E</span>, <span class="number">0xC3453484</span>, <span class="number">0xFDD56705</span>, <span class="number">0x0E1E9EC9</span>,</span><br><span class="line">     <span class="number">0xDB73DBD3</span>, <span class="number">0x105588CD</span>, <span class="number">0x675FDA79</span>, <span class="number">0xE3674340</span>,</span><br><span class="line">     <span class="number">0xC5C43465</span>, <span class="number">0x713E38D8</span>, <span class="number">0x3D28F89E</span>, <span class="number">0xF16DFF20</span>,</span><br><span class="line">     <span class="number">0x153E21E7</span>, <span class="number">0x8FB03D4A</span>, <span class="number">0xE6E39F2B</span>, <span class="number">0xDB83ADF7</span>],</span><br><span class="line">    [<span class="number">0xE93D5A68</span>, <span class="number">0x948140F7</span>, <span class="number">0xF64C261C</span>, <span class="number">0x94692934</span>,</span><br><span class="line">     <span class="number">0x411520F7</span>, <span class="number">0x7602D4F7</span>, <span class="number">0xBCF46B2E</span>, <span class="number">0xD4A20068</span>,</span><br><span class="line">     <span class="number">0xD4082471</span>, <span class="number">0x3320F46A</span>, <span class="number">0x43B7D4B7</span>, <span class="number">0x500061AF</span>,</span><br><span class="line">     <span class="number">0x1E39F62E</span>, <span class="number">0x97244546</span>, <span class="number">0x14214F74</span>, <span class="number">0xBF8B8840</span>,</span><br><span class="line">     <span class="number">0x4D95FC1D</span>, <span class="number">0x96B591AF</span>, <span class="number">0x70F4DDD3</span>, <span class="number">0x66A02F45</span>,</span><br><span class="line">     <span class="number">0xBFBC09EC</span>, <span class="number">0x03BD9785</span>, <span class="number">0x7FAC6DD0</span>, <span class="number">0x31CB8504</span>,</span><br><span class="line">     <span class="number">0x96EB27B3</span>, <span class="number">0x55FD3941</span>, <span class="number">0xDA2547E6</span>, <span class="number">0xABCA0A9A</span>,</span><br><span class="line">     <span class="number">0x28507825</span>, <span class="number">0x530429F4</span>, <span class="number">0x0A2C86DA</span>, <span class="number">0xE9B66DFB</span>,</span><br><span class="line">     <span class="number">0x68DC1462</span>, <span class="number">0xD7486900</span>, <span class="number">0x680EC0A4</span>, <span class="number">0x27A18DEE</span>,</span><br><span class="line">     <span class="number">0x4F3FFEA2</span>, <span class="number">0xE887AD8C</span>, <span class="number">0xB58CE006</span>, <span class="number">0x7AF4D6B6</span>,</span><br><span class="line">     <span class="number">0xAACE1E7C</span>, <span class="number">0xD3375FEC</span>, <span class="number">0xCE78A399</span>, <span class="number">0x406B2A42</span>,</span><br><span class="line">     <span class="number">0x20FE9E35</span>, <span class="number">0xD9F385B9</span>, <span class="number">0xEE39D7AB</span>, <span class="number">0x3B124E8B</span>,</span><br><span class="line">     <span class="number">0x1DC9FAF7</span>, <span class="number">0x4B6D1856</span>, <span class="number">0x26A36631</span>, <span class="number">0xEAE397B2</span>,</span><br><span class="line">     <span class="number">0x3A6EFA74</span>, <span class="number">0xDD5B4332</span>, <span class="number">0x6841E7F7</span>, <span class="number">0xCA7820FB</span>,</span><br><span class="line">     <span class="number">0xFB0AF54E</span>, <span class="number">0xD8FEB397</span>, <span class="number">0x454056AC</span>, <span class="number">0xBA489527</span>,</span><br><span class="line">     <span class="number">0x55533A3A</span>, <span class="number">0x20838D87</span>, <span class="number">0xFE6BA9B7</span>, <span class="number">0xD096954B</span>,</span><br><span class="line">     <span class="number">0x55A867BC</span>, <span class="number">0xA1159A58</span>, <span class="number">0xCCA92963</span>, <span class="number">0x99E1DB33</span>,</span><br><span class="line">     <span class="number">0xA62A4A56</span>, <span class="number">0x3F3125F9</span>, <span class="number">0x5EF47E1C</span>, <span class="number">0x9029317C</span>,</span><br><span class="line">     <span class="number">0xFDF8E802</span>, <span class="number">0x04272F70</span>, <span class="number">0x80BB155C</span>, <span class="number">0x05282CE3</span>,</span><br><span class="line">     <span class="number">0x95C11548</span>, <span class="number">0xE4C66D22</span>, <span class="number">0x48C1133F</span>, <span class="number">0xC70F86DC</span>,</span><br><span class="line">     <span class="number">0x07F9C9EE</span>, <span class="number">0x41041F0F</span>, <span class="number">0x404779A4</span>, <span class="number">0x5D886E17</span>,</span><br><span class="line">     <span class="number">0x325F51EB</span>, <span class="number">0xD59BC0D1</span>, <span class="number">0xF2BCC18F</span>, <span class="number">0x41113564</span>,</span><br><span class="line">     <span class="number">0x257B7834</span>, <span class="number">0x602A9C60</span>, <span class="number">0xDFF8E8A3</span>, <span class="number">0x1F636C1B</span>,</span><br><span class="line">     <span class="number">0x0E12B4C2</span>, <span class="number">0x02E1329E</span>, <span class="number">0xAF664FD1</span>, <span class="number">0xCAD18115</span>,</span><br><span class="line">     <span class="number">0x6B2395E0</span>, <span class="number">0x333E92E1</span>, <span class="number">0x3B240B62</span>, <span class="number">0xEEBEB922</span>,</span><br><span class="line">     <span class="number">0x85B2A20E</span>, <span class="number">0xE6BA0D99</span>, <span class="number">0xDE720C8C</span>, <span class="number">0x2DA2F728</span>,</span><br><span class="line">     <span class="number">0xD0127845</span>, <span class="number">0x95B794FD</span>, <span class="number">0x647D0862</span>, <span class="number">0xE7CCF5F0</span>,</span><br><span class="line">     <span class="number">0x5449A36F</span>, <span class="number">0x877D48FA</span>, <span class="number">0xC39DFD27</span>, <span class="number">0xF33E8D1E</span>,</span><br><span class="line">     <span class="number">0x0A476341</span>, <span class="number">0x992EFF74</span>, <span class="number">0x3A6F6EAB</span>, <span class="number">0xF4F8FD37</span>,</span><br><span class="line">     <span class="number">0xA812DC60</span>, <span class="number">0xA1EBDDF8</span>, <span class="number">0x991BE14C</span>, <span class="number">0xDB6E6B0D</span>,</span><br><span class="line">     <span class="number">0xC67B5510</span>, <span class="number">0x6D672C37</span>, <span class="number">0x2765D43B</span>, <span class="number">0xDCD0E804</span>,</span><br><span class="line">     <span class="number">0xF1290DC7</span>, <span class="number">0xCC00FFA3</span>, <span class="number">0xB5390F92</span>, <span class="number">0x690FED0B</span>,</span><br><span class="line">     <span class="number">0x667B9FFB</span>, <span class="number">0xCEDB7D9C</span>, <span class="number">0xA091CF0B</span>, <span class="number">0xD9155EA3</span>,</span><br><span class="line">     <span class="number">0xBB132F88</span>, <span class="number">0x515BAD24</span>, <span class="number">0x7B9479BF</span>, <span class="number">0x763BD6EB</span>,</span><br><span class="line">     <span class="number">0x37392EB3</span>, <span class="number">0xCC115979</span>, <span class="number">0x8026E297</span>, <span class="number">0xF42E312D</span>,</span><br><span class="line">     <span class="number">0x6842ADA7</span>, <span class="number">0xC66A2B3B</span>, <span class="number">0x12754CCC</span>, <span class="number">0x782EF11C</span>,</span><br><span class="line">     <span class="number">0x6A124237</span>, <span class="number">0xB79251E7</span>, <span class="number">0x06A1BBE6</span>, <span class="number">0x4BFB6350</span>,</span><br><span class="line">     <span class="number">0x1A6B1018</span>, <span class="number">0x11CAEDFA</span>, <span class="number">0x3D25BDD8</span>, <span class="number">0xE2E1C3C9</span>,</span><br><span class="line">     <span class="number">0x44421659</span>, <span class="number">0x0A121386</span>, <span class="number">0xD90CEC6E</span>, <span class="number">0xD5ABEA2A</span>,</span><br><span class="line">     <span class="number">0x64AF674E</span>, <span class="number">0xDA86A85F</span>, <span class="number">0xBEBFE988</span>, <span class="number">0x64E4C3FE</span>,</span><br><span class="line">     <span class="number">0x9DBC8057</span>, <span class="number">0xF0F7C086</span>, <span class="number">0x60787BF8</span>, <span class="number">0x6003604D</span>,</span><br><span class="line">     <span class="number">0xD1FD8346</span>, <span class="number">0xF6381FB0</span>, <span class="number">0x7745AE04</span>, <span class="number">0xD736FCCC</span>,</span><br><span class="line">     <span class="number">0x83426B33</span>, <span class="number">0xF01EAB71</span>, <span class="number">0xB0804187</span>, <span class="number">0x3C005E5F</span>,</span><br><span class="line">     <span class="number">0x77A057BE</span>, <span class="number">0xBDE8AE24</span>, <span class="number">0x55464299</span>, <span class="number">0xBF582E61</span>,</span><br><span class="line">     <span class="number">0x4E58F48F</span>, <span class="number">0xF2DDFDA2</span>, <span class="number">0xF474EF38</span>, <span class="number">0x8789BDC2</span>,</span><br><span class="line">     <span class="number">0x5366F9C3</span>, <span class="number">0xC8B38E74</span>, <span class="number">0xB475F255</span>, <span class="number">0x46FCD9B9</span>,</span><br><span class="line">     <span class="number">0x7AEB2661</span>, <span class="number">0x8B1DDF84</span>, <span class="number">0x846A0E79</span>, <span class="number">0x915F95E2</span>,</span><br><span class="line">     <span class="number">0x466E598E</span>, <span class="number">0x20B45770</span>, <span class="number">0x8CD55591</span>, <span class="number">0xC902DE4C</span>,</span><br><span class="line">     <span class="number">0xB90BACE1</span>, <span class="number">0xBB8205D0</span>, <span class="number">0x11A86248</span>, <span class="number">0x7574A99E</span>,</span><br><span class="line">     <span class="number">0xB77F19B6</span>, <span class="number">0xE0A9DC09</span>, <span class="number">0x662D09A1</span>, <span class="number">0xC4324633</span>,</span><br><span class="line">     <span class="number">0xE85A1F02</span>, <span class="number">0x09F0BE8C</span>, <span class="number">0x4A99A025</span>, <span class="number">0x1D6EFE10</span>,</span><br><span class="line">     <span class="number">0x1AB93D1D</span>, <span class="number">0x0BA5A4DF</span>, <span class="number">0xA186F20F</span>, <span class="number">0x2868F169</span>,</span><br><span class="line">     <span class="number">0xDCB7DA83</span>, <span class="number">0x573906FE</span>, <span class="number">0xA1E2CE9B</span>, <span class="number">0x4FCD7F52</span>,</span><br><span class="line">     <span class="number">0x50115E01</span>, <span class="number">0xA70683FA</span>, <span class="number">0xA002B5C4</span>, <span class="number">0x0DE6D027</span>,</span><br><span class="line">     <span class="number">0x9AF88C27</span>, <span class="number">0x773F8641</span>, <span class="number">0xC3604C06</span>, <span class="number">0x61A806B5</span>,</span><br><span class="line">     <span class="number">0xF0177A28</span>, <span class="number">0xC0F586E0</span>, <span class="number">0x006058AA</span>, <span class="number">0x30DC7D62</span>,</span><br><span class="line">     <span class="number">0x11E69ED7</span>, <span class="number">0x2338EA63</span>, <span class="number">0x53C2DD94</span>, <span class="number">0xC2C21634</span>,</span><br><span class="line">     <span class="number">0xBBCBEE56</span>, <span class="number">0x90BCB6DE</span>, <span class="number">0xEBFC7DA1</span>, <span class="number">0xCE591D76</span>,</span><br><span class="line">     <span class="number">0x6F05E409</span>, <span class="number">0x4B7C0188</span>, <span class="number">0x39720A3D</span>, <span class="number">0x7C927C24</span>,</span><br><span class="line">     <span class="number">0x86E3725F</span>, <span class="number">0x724D9DB9</span>, <span class="number">0x1AC15BB4</span>, <span class="number">0xD39EB8FC</span>,</span><br><span class="line">     <span class="number">0xED545578</span>, <span class="number">0x08FCA5B5</span>, <span class="number">0xD83D7CD3</span>, <span class="number">0x4DAD0FC4</span>,</span><br><span class="line">     <span class="number">0x1E50EF5E</span>, <span class="number">0xB161E6F8</span>, <span class="number">0xA28514D9</span>, <span class="number">0x6C51133C</span>,</span><br><span class="line">     <span class="number">0x6FD5C7E7</span>, <span class="number">0x56E14EC4</span>, <span class="number">0x362ABFCE</span>, <span class="number">0xDDC6C837</span>,</span><br><span class="line">     <span class="number">0xD79A3234</span>, <span class="number">0x92638212</span>, <span class="number">0x670EFA8E</span>, <span class="number">0x406000E0</span>],</span><br><span class="line">    [<span class="number">0x3A39CE37</span>, <span class="number">0xD3FAF5CF</span>, <span class="number">0xABC27737</span>, <span class="number">0x5AC52D1B</span>,</span><br><span class="line">     <span class="number">0x5CB0679E</span>, <span class="number">0x4FA33742</span>, <span class="number">0xD3822740</span>, <span class="number">0x99BC9BBE</span>,</span><br><span class="line">     <span class="number">0xD5118E9D</span>, <span class="number">0xBF0F7315</span>, <span class="number">0xD62D1C7E</span>, <span class="number">0xC700C47B</span>,</span><br><span class="line">     <span class="number">0xB78C1B6B</span>, <span class="number">0x21A19045</span>, <span class="number">0xB26EB1BE</span>, <span class="number">0x6A366EB4</span>,</span><br><span class="line">     <span class="number">0x5748AB2F</span>, <span class="number">0xBC946E79</span>, <span class="number">0xC6A376D2</span>, <span class="number">0x6549C2C8</span>,</span><br><span class="line">     <span class="number">0x530FF8EE</span>, <span class="number">0x468DDE7D</span>, <span class="number">0xD5730A1D</span>, <span class="number">0x4CD04DC6</span>,</span><br><span class="line">     <span class="number">0x2939BBDB</span>, <span class="number">0xA9BA4650</span>, <span class="number">0xAC9526E8</span>, <span class="number">0xBE5EE304</span>,</span><br><span class="line">     <span class="number">0xA1FAD5F0</span>, <span class="number">0x6A2D519A</span>, <span class="number">0x63EF8CE2</span>, <span class="number">0x9A86EE22</span>,</span><br><span class="line">     <span class="number">0xC089C2B8</span>, <span class="number">0x43242EF6</span>, <span class="number">0xA51E03AA</span>, <span class="number">0x9CF2D0A4</span>,</span><br><span class="line">     <span class="number">0x83C061BA</span>, <span class="number">0x9BE96A4D</span>, <span class="number">0x8FE51550</span>, <span class="number">0xBA645BD6</span>,</span><br><span class="line">     <span class="number">0x2826A2F9</span>, <span class="number">0xA73A3AE1</span>, <span class="number">0x4BA99586</span>, <span class="number">0xEF5562E9</span>,</span><br><span class="line">     <span class="number">0xC72FEFD3</span>, <span class="number">0xF752F7DA</span>, <span class="number">0x3F046F69</span>, <span class="number">0x77FA0A59</span>,</span><br><span class="line">     <span class="number">0x80E4A915</span>, <span class="number">0x87B08601</span>, <span class="number">0x9B09E6AD</span>, <span class="number">0x3B3EE593</span>,</span><br><span class="line">     <span class="number">0xE990FD5A</span>, <span class="number">0x9E34D797</span>, <span class="number">0x2CF0B7D9</span>, <span class="number">0x022B8B51</span>,</span><br><span class="line">     <span class="number">0x96D5AC3A</span>, <span class="number">0x017DA67D</span>, <span class="number">0xD1CF3ED6</span>, <span class="number">0x7C7D2D28</span>,</span><br><span class="line">     <span class="number">0x1F9F25CF</span>, <span class="number">0xADF2B89B</span>, <span class="number">0x5AD6B472</span>, <span class="number">0x5A88F54C</span>,</span><br><span class="line">     <span class="number">0xE029AC71</span>, <span class="number">0xE019A5E6</span>, <span class="number">0x47B0ACFD</span>, <span class="number">0xED93FA9B</span>,</span><br><span class="line">     <span class="number">0xE8D3C48D</span>, <span class="number">0x283B57CC</span>, <span class="number">0xF8D56629</span>, <span class="number">0x79132E28</span>,</span><br><span class="line">     <span class="number">0x785F0191</span>, <span class="number">0xED756055</span>, <span class="number">0xF7960E44</span>, <span class="number">0xE3D35E8C</span>,</span><br><span class="line">     <span class="number">0x15056DD4</span>, <span class="number">0x88F46DBA</span>, <span class="number">0x03A16125</span>, <span class="number">0x0564F0BD</span>,</span><br><span class="line">     <span class="number">0xC3EB9E15</span>, <span class="number">0x3C9057A2</span>, <span class="number">0x97271AEC</span>, <span class="number">0xA93A072A</span>,</span><br><span class="line">     <span class="number">0x1B3F6D9B</span>, <span class="number">0x1E6321F5</span>, <span class="number">0xF59C66FB</span>, <span class="number">0x26DCF319</span>,</span><br><span class="line">     <span class="number">0x7533D928</span>, <span class="number">0xB155FDF5</span>, <span class="number">0x03563482</span>, <span class="number">0x8ABA3CBB</span>,</span><br><span class="line">     <span class="number">0x28517711</span>, <span class="number">0xC20AD9F8</span>, <span class="number">0xABCC5167</span>, <span class="number">0xCCAD925F</span>,</span><br><span class="line">     <span class="number">0x4DE81751</span>, <span class="number">0x3830DC8E</span>, <span class="number">0x379D5862</span>, <span class="number">0x9320F991</span>,</span><br><span class="line">     <span class="number">0xEA7A90C2</span>, <span class="number">0xFB3E7BCE</span>, <span class="number">0x5121CE64</span>, <span class="number">0x774FBE32</span>,</span><br><span class="line">     <span class="number">0xA8B6E37E</span>, <span class="number">0xC3293D46</span>, <span class="number">0x48DE5369</span>, <span class="number">0x6413E680</span>,</span><br><span class="line">     <span class="number">0xA2AE0810</span>, <span class="number">0xDD6DB224</span>, <span class="number">0x69852DFD</span>, <span class="number">0x09072166</span>,</span><br><span class="line">     <span class="number">0xB39A460A</span>, <span class="number">0x6445C0DD</span>, <span class="number">0x586CDECF</span>, <span class="number">0x1C20C8AE</span>,</span><br><span class="line">     <span class="number">0x5BBEF7DD</span>, <span class="number">0x1B588D40</span>, <span class="number">0xCCD2017F</span>, <span class="number">0x6BB4E3BB</span>,</span><br><span class="line">     <span class="number">0xDDA26A7E</span>, <span class="number">0x3A59FF45</span>, <span class="number">0x3E350A44</span>, <span class="number">0xBCB4CDD5</span>,</span><br><span class="line">     <span class="number">0x72EACEA8</span>, <span class="number">0xFA6484BB</span>, <span class="number">0x8D6612AE</span>, <span class="number">0xBF3C6F47</span>,</span><br><span class="line">     <span class="number">0xD29BE463</span>, <span class="number">0x542F5D9E</span>, <span class="number">0xAEC2771B</span>, <span class="number">0xF64E6370</span>,</span><br><span class="line">     <span class="number">0x740E0D8D</span>, <span class="number">0xE75B1357</span>, <span class="number">0xF8721671</span>, <span class="number">0xAF537D5D</span>,</span><br><span class="line">     <span class="number">0x4040CB08</span>, <span class="number">0x4EB4E2CC</span>, <span class="number">0x34D2466A</span>, <span class="number">0x0115AF84</span>,</span><br><span class="line">     <span class="number">0xE1B00428</span>, <span class="number">0x95983A1D</span>, <span class="number">0x06B89FB4</span>, <span class="number">0xCE6EA048</span>,</span><br><span class="line">     <span class="number">0x6F3F3B82</span>, <span class="number">0x3520AB82</span>, <span class="number">0x011A1D4B</span>, <span class="number">0x277227F8</span>,</span><br><span class="line">     <span class="number">0x611560B1</span>, <span class="number">0xE7933FDC</span>, <span class="number">0xBB3A792B</span>, <span class="number">0x344525BD</span>,</span><br><span class="line">     <span class="number">0xA08839E1</span>, <span class="number">0x51CE794B</span>, <span class="number">0x2F32C9B7</span>, <span class="number">0xA01FBAC9</span>,</span><br><span class="line">     <span class="number">0xE01CC87E</span>, <span class="number">0xBCC7D1F6</span>, <span class="number">0xCF0111C3</span>, <span class="number">0xA1E8AAC7</span>,</span><br><span class="line">     <span class="number">0x1A908749</span>, <span class="number">0xD44FBD9A</span>, <span class="number">0xD0DADECB</span>, <span class="number">0xD50ADA38</span>,</span><br><span class="line">     <span class="number">0x0339C32A</span>, <span class="number">0xC6913667</span>, <span class="number">0x8DF9317C</span>, <span class="number">0xE0B12B4F</span>,</span><br><span class="line">     <span class="number">0xF79E59B7</span>, <span class="number">0x43F5BB3A</span>, <span class="number">0xF2D519FF</span>, <span class="number">0x27D9459C</span>,</span><br><span class="line">     <span class="number">0xBF97222C</span>, <span class="number">0x15E6FC2A</span>, <span class="number">0x0F91FC71</span>, <span class="number">0x9B941525</span>,</span><br><span class="line">     <span class="number">0xFAE59361</span>, <span class="number">0xCEB69CEB</span>, <span class="number">0xC2A86459</span>, <span class="number">0x12BAA8D1</span>,</span><br><span class="line">     <span class="number">0xB6C1075E</span>, <span class="number">0xE3056A0C</span>, <span class="number">0x10D25065</span>, <span class="number">0xCB03A442</span>,</span><br><span class="line">     <span class="number">0xE0EC6E0E</span>, <span class="number">0x1698DB3B</span>, <span class="number">0x4C98A0BE</span>, <span class="number">0x3278E964</span>,</span><br><span class="line">     <span class="number">0x9F1F9532</span>, <span class="number">0xE0D392DF</span>, <span class="number">0xD3A0342B</span>, <span class="number">0x8971F21E</span>,</span><br><span class="line">     <span class="number">0x1B0A7441</span>, <span class="number">0x4BA3348C</span>, <span class="number">0xC5BE7120</span>, <span class="number">0xC37632D8</span>,</span><br><span class="line">     <span class="number">0xDF359F8D</span>, <span class="number">0x9B992F2E</span>, <span class="number">0xE60B6F47</span>, <span class="number">0x0FE3F11D</span>,</span><br><span class="line">     <span class="number">0xE54CDA54</span>, <span class="number">0x1EDAD891</span>, <span class="number">0xCE6279CF</span>, <span class="number">0xCD3E7E6F</span>,</span><br><span class="line">     <span class="number">0x1618B166</span>, <span class="number">0xFD2C1D05</span>, <span class="number">0x848FD2C5</span>, <span class="number">0xF6FB2299</span>,</span><br><span class="line">     <span class="number">0xF523F357</span>, <span class="number">0xA6327623</span>, <span class="number">0x93A83531</span>, <span class="number">0x56CCCD02</span>,</span><br><span class="line">     <span class="number">0xACF08162</span>, <span class="number">0x5A75EBB5</span>, <span class="number">0x6E163697</span>, <span class="number">0x88D273CC</span>,</span><br><span class="line">     <span class="number">0xDE966292</span>, <span class="number">0x81B949D0</span>, <span class="number">0x4C50901B</span>, <span class="number">0x71C65614</span>,</span><br><span class="line">     <span class="number">0xE6C6C7BD</span>, <span class="number">0x327A140A</span>, <span class="number">0x45E1D006</span>, <span class="number">0xC3F27B9A</span>,</span><br><span class="line">     <span class="number">0xC9AA53FD</span>, <span class="number">0x62A80F00</span>, <span class="number">0xBB25BFE2</span>, <span class="number">0x35BDD2F6</span>,</span><br><span class="line">     <span class="number">0x71126905</span>, <span class="number">0xB2040222</span>, <span class="number">0xB6CBCF7C</span>, <span class="number">0xCD769C2B</span>,</span><br><span class="line">     <span class="number">0x53113EC0</span>, <span class="number">0x1640E3D3</span>, <span class="number">0x38ABBD60</span>, <span class="number">0x2547ADF0</span>,</span><br><span class="line">     <span class="number">0xBA38209C</span>, <span class="number">0xF746CE76</span>, <span class="number">0x77AFA1C5</span>, <span class="number">0x20756060</span>,</span><br><span class="line">     <span class="number">0x85CBFE4E</span>, <span class="number">0x8AE88DD8</span>, <span class="number">0x7AAAF9B0</span>, <span class="number">0x4CF9AA7E</span>,</span><br><span class="line">     <span class="number">0x1948C25C</span>, <span class="number">0x02FB8A8C</span>, <span class="number">0x01C36AE4</span>, <span class="number">0xD6EBE1F9</span>,</span><br><span class="line">     <span class="number">0x90D4F869</span>, <span class="number">0xA65CDEA0</span>, <span class="number">0x3F09252D</span>, <span class="number">0xC208E69F</span>,</span><br><span class="line">     <span class="number">0xB74E6132</span>, <span class="number">0xCE77E25B</span>, <span class="number">0x578FDFE3</span>, <span class="number">0x3AC372E6</span>]]</span><br></pre></td></tr></table></figure>



<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>来自<a target="_blank" rel="noopener" href="https://yring-me.com/2023/05/29/BlowFish/">BlowFish 加密算法 python实现 - yring</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.number</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">from</span> Blow_BOX <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key_pbox = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>)]</span><br><span class="line">Encrypt = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_key_pbox</span>(<span class="params">_key</span>):   <span class="comment">#密钥初始化盒</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            key_pbox[i] = <span class="built_in">ord</span>(_key[index]) | (key_pbox[i] &lt;&lt; <span class="number">8</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> index &gt;= <span class="built_in">len</span>(_key):</span><br><span class="line">                index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">        p_box[i] ^= key_pbox[i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Fn</span>(<span class="params">Left</span>):</span><br><span class="line">    a = (Left &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">    b = (Left &amp; <span class="number">0x00ff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">    c = (Left &amp; <span class="number">0x0000ff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">    d = Left &amp; <span class="number">0x000000ff</span></span><br><span class="line"></span><br><span class="line">    Sa = s_box[<span class="number">0</span>][a]</span><br><span class="line">    Sb = s_box[<span class="number">1</span>][b]</span><br><span class="line">    Sc = s_box[<span class="number">2</span>][c]</span><br><span class="line">    Sd = s_box[<span class="number">3</span>][d]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (((Sa + Sb) ^ Sc) + Sd) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Blow_Main_Encrypt</span>(<span class="params">Left, Right</span>):  <span class="comment">#主加密函数，查表异或替换</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        Left ^= p_box[i]</span><br><span class="line">        Right ^= Fn(Left)</span><br><span class="line">        Temp = Left</span><br><span class="line">        Left = Right</span><br><span class="line">        Right = Temp</span><br><span class="line"></span><br><span class="line">    Temp = Left</span><br><span class="line">    Left = Right ^ p_box[<span class="number">17</span>]</span><br><span class="line">    Right = Temp ^ p_box[<span class="number">16</span>]</span><br><span class="line">    <span class="keyword">return</span> Left, Right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Blow_Main_Decrypt</span>(<span class="params">Left, Right</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        Left ^= p_box[i]</span><br><span class="line">        Right ^= Fn(Left)</span><br><span class="line"></span><br><span class="line">        Temp = Left</span><br><span class="line">        Left = Right</span><br><span class="line">        Right = Temp</span><br><span class="line"></span><br><span class="line">    Temp = Left</span><br><span class="line">    Left = Right ^ p_box[<span class="number">0</span>]</span><br><span class="line">    Right = Temp ^ p_box[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> Left , Right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Change_Box</span>(): <span class="comment">#盒变化</span></span><br><span class="line">    Left = <span class="number">0</span></span><br><span class="line">    Right = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">18</span>, <span class="number">2</span>):</span><br><span class="line">        Left, Right = Blow_Main_Encrypt(Left, Right)</span><br><span class="line">        p_box[i] = Left</span><br><span class="line">        p_box[i + <span class="number">1</span>] = Right</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>, <span class="number">2</span>):</span><br><span class="line">            Left, Right = Blow_Main_Encrypt(Left, Right)</span><br><span class="line">            s_box[i][j] = Left</span><br><span class="line">            s_box[i][j + <span class="number">1</span>] = Right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">BlowFish_Encrypt</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(data) % <span class="number">8</span>:</span><br><span class="line">        data += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    cipher = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), <span class="number">8</span>):</span><br><span class="line">        Left = (<span class="built_in">ord</span>(data[i]) &lt;&lt; <span class="number">24</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">1</span>]) &lt;&lt; <span class="number">16</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">3</span>]))</span><br><span class="line">        Right = (<span class="built_in">ord</span>(data[i + <span class="number">4</span>]) &lt;&lt; <span class="number">24</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">5</span>]) &lt;&lt; <span class="number">16</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">6</span>]) &lt;&lt; <span class="number">8</span>) | (<span class="built_in">ord</span>(data[i + <span class="number">7</span>]))</span><br><span class="line">        Left, Right = Blow_Main_Encrypt(Left, Right)</span><br><span class="line">        cipher += <span class="built_in">hex</span>(Left)[<span class="number">2</span>:]</span><br><span class="line">        cipher += <span class="built_in">hex</span>(Right)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">global</span> Encrypt</span><br><span class="line">    Encrypt = []</span><br><span class="line">    <span class="built_in">print</span>(cipher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">BlowFish_Decrypt</span>(<span class="params">cipher</span>):</span><br><span class="line">    plain = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), <span class="number">16</span>):</span><br><span class="line">        Left = cipher[i:i + <span class="number">8</span>]</span><br><span class="line">        Right = cipher[i + <span class="number">8</span>:i + <span class="number">16</span>]</span><br><span class="line">        Left = <span class="built_in">int</span>(Left, base=<span class="number">16</span>)</span><br><span class="line">        Right = <span class="built_in">int</span>(Right, base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        Left, Right = Blow_Main_Decrypt(Left, Right)</span><br><span class="line">        plain += <span class="built_in">hex</span>(Left)[<span class="number">2</span>:]</span><br><span class="line">        plain += <span class="built_in">hex</span>(Right)[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    plain = <span class="built_in">int</span>(plain, base=<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(Crypto.Util.number.long_to_bytes(plain))</span><br><span class="line">    <span class="keyword">global</span> Encrypt</span><br><span class="line">    Encrypt = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    key = <span class="built_in">input</span>(<span class="string">&quot;PLZ input the key First\n&quot;</span>)</span><br><span class="line">    init_key_pbox(key)</span><br><span class="line">    Change_Box()</span><br><span class="line">    m = <span class="built_in">input</span>(<span class="string">&quot;PLZ choose a model: 1.Encrypt 2.Decrypt 3.exit\n&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> m == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            data = <span class="built_in">input</span>(<span class="string">&quot;PLZ input the data:\n&quot;</span>)</span><br><span class="line">            BlowFish_Encrypt(data)</span><br><span class="line">            m = <span class="built_in">input</span>(<span class="string">&quot;PLZ choose a model: 1.Encrypt 2.Decrypt 3.exit\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> m == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            cipher = <span class="built_in">input</span>(<span class="string">&quot;PLZ input the cipher:\n&quot;</span>)</span><br><span class="line">            BlowFish_Decrypt(cipher)</span><br><span class="line">            m = <span class="built_in">input</span>(<span class="string">&quot;PLZ choose a model: 1.Encrypt 2.Decrypt 3.exit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1eh4y1m75A/?share_source=copy_web&vd_source=3c5a9c55a0916c3bbdeb89727b25cf20">演示动画</a></p>
<p>分组对称加密算法，用64位明文被分为一组进行加密，使用64位密钥。若有多于64位的明文需要进行多组加密。</p>
<ul>
<li><p>64bit密钥经过PC-1盒的变换去除校验位并打乱为56bit密钥，平分成两个28bit密文C0，D0，通过移位次数表进行16次循环左移，得到C10,D0到C15,D15,共16组，把Cn，Dn，每两个拼接成一个值，再通过PC-2进行变换，得到16个48bit的密钥。</p>
</li>
<li><p>64bit的明文ip置换，把ip置换盒值指向的位，与ip盒值所在位置索引的位进行二进制交换</p>
</li>
<li><p>64bit明文平分分成两部分L0和R0。R0先经过轮函数F()的变换。先把R0分为8个4bit的数据，并把每一个组的最前端加上前面一组的最后一位，最后端加上后一组的第一位。以此类推，把每组4bit数据转为6bit，最终得到48bit的数据。</p>
</li>
<li><p>48bit数据与48bit的密钥异或。</p>
</li>
<li><p>异或结果分为8组6bit数据，以每组数据的中间4bit为列坐标，两端的1bit组为2bit数据作为行坐标。在s盒中按坐标寻找值并替换，把数据压缩为32bit。</p>
</li>
<li><p>再次进行一次p盒置换，与ip置换逻辑相同，并与L0异或得到R1。</p>
</li>
<li><p>把R0赋值给L1,继续对R1进行加密，进行16轮。最后互换左右数据拼接成64bit的密文。</p>
</li>
</ul>
<p>DES解密逻辑相同，但是子密钥的使用顺序相反，我们可以通过写内存的方式修改子密钥的顺序，并输入密文得到解密结果。</p>
<h4 id="加解密实现代码"><a href="#加解密实现代码" class="headerlink" title="加解密实现代码"></a>加解密实现代码</h4><p>来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62107003/article/details/142746369">python实现DES算法-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line"><span class="comment"># 一、子密钥生成</span></span><br><span class="line"><span class="comment"># (1) 初始置换 64-&gt;56</span></span><br><span class="line"><span class="comment"># 64位的种子密钥经过PC_1置换后，生成56位的密钥</span></span><br><span class="line"><span class="comment"># (2) 划分 56-&gt;(28,28)</span></span><br><span class="line"><span class="comment"># 经过初始置换后的56位密钥被均分成C0和D0两部分</span></span><br><span class="line"><span class="comment"># (3) 循环左移</span></span><br><span class="line"><span class="comment"># 第一轮，C0和D0根据移位次数表各自进行循环左移</span></span><br><span class="line"><span class="comment"># 得到C1和D1</span></span><br><span class="line"><span class="comment"># 每一轮的C和D值是由上一轮的C和D值循环左移得到的</span></span><br><span class="line"><span class="comment"># (4) 合并 (28,28)-&gt;56-&gt;48</span></span><br><span class="line"><span class="comment"># 左移后的两部分再次合并,通过一个选择压缩表(PC_2)</span></span><br><span class="line"><span class="comment"># 得到这一轮的子密钥</span></span><br><span class="line"><span class="comment"># (5)重复3、4操作,最终得到16个子密钥</span></span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 置换选择表1(PC_1) 64-&gt;56</span></span><br><span class="line">PC_1 = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">        <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择压缩表2(PC_2) 56-&gt;48</span></span><br><span class="line">PC_2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>,</span><br><span class="line">        <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移位次数表</span></span><br><span class="line">shift_num = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pc_1_change</span>(<span class="params">bin_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;初始置换</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    64位的种子密钥经过PC_1置换后，生成56位的密钥</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [bin_key[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> PC_1]  <span class="comment"># 列表形式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_left</span>(<span class="params">bin_key, num</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;实现C和D的循环左移&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bin_key[num:] + bin_key[:num]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pc_2_change</span>(<span class="params">bin_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;选择压缩</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    56位的密钥经过PC_2压缩，生成48位子密钥</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([bin_key[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> PC_2])  <span class="comment"># 列表转字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_subkey_list</span>(<span class="params">bin_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成16轮的加解子密钥&quot;&quot;&quot;</span></span><br><span class="line">    subkey_list = []  <span class="comment"># 存储16轮子密钥</span></span><br><span class="line">    <span class="comment"># 1. 初始置换 64-&gt;58</span></span><br><span class="line">    temp = pc_1_change(bin_key)</span><br><span class="line">    <span class="comment"># 2. 循环左移</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> shift_num:</span><br><span class="line">        temp[:<span class="number">28</span>] = shift_left(temp[:<span class="number">28</span>], i)  <span class="comment"># C部分循环左移</span></span><br><span class="line">        temp[<span class="number">28</span>:] = shift_left(temp[<span class="number">28</span>:], i)  <span class="comment"># D部分循环左移</span></span><br><span class="line">        subkey_list.append(pc_2_change(temp))  <span class="comment"># 生成子密钥</span></span><br><span class="line">    <span class="keyword">return</span> subkey_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line"><span class="comment"># 二、DES加解密实现</span></span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始置换表IP 64-&gt;64</span></span><br><span class="line">IP = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">      <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">      <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">      <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span></span><br><span class="line">      ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆置换表_IP 64-&gt;64</span></span><br><span class="line">_IP = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>,</span><br><span class="line">       <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>,</span><br><span class="line">       <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>,</span><br><span class="line">       <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>,</span><br><span class="line">       <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>,</span><br><span class="line">       <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>,</span><br><span class="line">       <span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span></span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展置换表E 32-&gt;48</span></span><br><span class="line">E = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">     <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>,</span><br><span class="line">     <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">     <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>,</span><br><span class="line">     <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># S盒 48-&gt;32</span></span><br><span class="line">S1 = [<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>,</span><br><span class="line">      <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">      <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span></span><br><span class="line">      ]</span><br><span class="line">S2 = [<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">      <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>,</span><br><span class="line">      <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>,</span><br><span class="line">      <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span></span><br><span class="line">      ]</span><br><span class="line">S3 = [<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>,</span><br><span class="line">      <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>,</span><br><span class="line">      <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span></span><br><span class="line">      ]</span><br><span class="line">S4 = [<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>,</span><br><span class="line">      <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">      <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>,</span><br><span class="line">      <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span></span><br><span class="line">      ]</span><br><span class="line">S5 = [<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">      <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>,</span><br><span class="line">      <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span></span><br><span class="line">      ]</span><br><span class="line">S6 = [<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>,</span><br><span class="line">      <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span></span><br><span class="line">      ]</span><br><span class="line">S7 = [<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>,</span><br><span class="line">      <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span></span><br><span class="line">      ]</span><br><span class="line">S8 = [<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>,</span><br><span class="line">      <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span></span><br><span class="line">      ]</span><br><span class="line">S = [S1, S2, S3, S4, S5, S6, S7, S8]</span><br><span class="line"></span><br><span class="line"><span class="comment"># P盒</span></span><br><span class="line">P = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">     <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>,</span><br><span class="line">     <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">25</span></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># encrypt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ip_change</span>(<span class="params">bin_text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;初始置换&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [bin_text[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> IP]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_box</span>(<span class="params">bin_result</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;S盒替换&quot;&quot;&quot;</span></span><br><span class="line">    int_result = []</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="comment"># 二进制行号</span></span><br><span class="line">        bin_row = bin_result[i][<span class="number">0</span>] + bin_result[i][<span class="number">5</span>]</span><br><span class="line">        <span class="comment"># 二进制列号</span></span><br><span class="line">        bin_col = <span class="string">&#x27;&#x27;</span>.join(bin_result[i][j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>))</span><br><span class="line">        <span class="comment"># 获取对应的十进制数</span></span><br><span class="line">        int_result.append(S[i][<span class="number">16</span> * <span class="built_in">int</span>(bin_row, base=<span class="number">2</span>) + <span class="built_in">int</span>(bin_col, base=<span class="number">2</span>)])</span><br><span class="line">        <span class="comment"># 十进制转成二进制</span></span><br><span class="line">        result += <span class="built_in">bin</span>(int_result[-<span class="number">1</span>])[<span class="number">2</span>:].zfill(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p_box</span>(<span class="params">result</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;P盒置换&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> P)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">R, bin_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;轮函数f()&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.将R由32位扩展成48位</span></span><br><span class="line">    R_ext = [R[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> E]</span><br><span class="line">    <span class="comment"># 2.与子密钥进行逐位异或</span></span><br><span class="line">    bin_temp = [<span class="built_in">str</span>(<span class="built_in">int</span>(r) ^ <span class="built_in">int</span>(k)) <span class="keyword">for</span> r, k <span class="keyword">in</span> <span class="built_in">zip</span>(R_ext, bin_key)]</span><br><span class="line">    <span class="comment"># 6个字符为一组，共8组</span></span><br><span class="line">    bin_result = [<span class="string">&#x27;&#x27;</span>.join(bin_temp[i:i + <span class="number">6</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bin_temp), <span class="number">6</span>)]</span><br><span class="line">    <span class="comment"># 3.S盒替换 48-&gt;32</span></span><br><span class="line">    result = s_box(bin_result)</span><br><span class="line">    <span class="comment"># 4.P盒置换 32-&gt;32</span></span><br><span class="line">    <span class="keyword">return</span> p_box(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_ip_change</span>(<span class="params">bin_text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;进行IP-1逆置换&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(bin_text[i - <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> _IP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_cipher</span>(<span class="params">bin_text, bin_key, reverse_keys=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;通用DES加密解密函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 初始置换IP</span></span><br><span class="line">    bin_text = ip_change(bin_text)</span><br><span class="line">    <span class="comment"># 2. 分成左右两部分L、R</span></span><br><span class="line">    L, R = bin_text[:<span class="number">32</span>], bin_text[<span class="number">32</span>:]</span><br><span class="line">    <span class="comment"># 3. 获得16轮子密钥</span></span><br><span class="line">    subkey_list = get_subkey_list(bin_key)</span><br><span class="line">    <span class="keyword">if</span> reverse_keys:</span><br><span class="line">        subkey_list = subkey_list[::-<span class="number">1</span>]  <span class="comment"># 解密时反转子密钥列表</span></span><br><span class="line">    <span class="comment"># 4. 进行16轮迭代</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> subkey_list:</span><br><span class="line">        R_temp = R</span><br><span class="line">        <span class="comment"># 轮函数f()结果和L进行异或</span></span><br><span class="line">        R = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(<span class="built_in">int</span>(r) ^ <span class="built_in">int</span>(l)) <span class="keyword">for</span> r, l <span class="keyword">in</span> <span class="built_in">zip</span>(f(R, i), L))</span><br><span class="line">        L = R_temp</span><br><span class="line">    <span class="comment"># 5. 进行IP-1逆置换 64-&gt;64</span></span><br><span class="line">    <span class="keyword">return</span> _ip_change(R + L)  <span class="comment"># 输出二进制字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2bin</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;字符串转二进制字符串&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">bin</span>(byte)[<span class="number">2</span>:].zfill(<span class="number">8</span>) <span class="keyword">for</span> byte <span class="keyword">in</span> text.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2str</span>(<span class="params">bin_text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;二进制字符串转字符串&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.将二进制字符串按8位分割，并转换为字节数组</span></span><br><span class="line">    byte_array = <span class="built_in">bytearray</span>(<span class="built_in">int</span>(i, <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> re.findall(<span class="string">r&#x27;.&#123;8&#125;&#x27;</span>, bin_text) <span class="keyword">if</span> <span class="built_in">int</span>(i, <span class="number">2</span>) != <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 2.将字节序列解码为字符串</span></span><br><span class="line">    <span class="keyword">return</span> byte_array.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_key</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查密钥是否有效 64bit&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(key.encode()) == <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;DES加密&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.明文转成二进制字符串, 0填充至64的倍数</span></span><br><span class="line">    bin_plaintext = str2bin(plaintext)</span><br><span class="line">    padding_len = (<span class="number">64</span> - (<span class="built_in">len</span>(bin_plaintext) % <span class="number">64</span>)) % <span class="number">64</span></span><br><span class="line">    bin_padding_plaintext = bin_plaintext + <span class="string">&#x27;0&#x27;</span> * padding_len</span><br><span class="line">    <span class="comment"># 2.进行64位分组加密</span></span><br><span class="line">    bin_group_64 = re.findall(<span class="string">r&#x27;.&#123;64&#125;&#x27;</span>, bin_padding_plaintext)</span><br><span class="line">    bin_ciphertext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> bin_group_64:</span><br><span class="line">        bin_ciphertext += des_cipher(g, str2bin(key))</span><br><span class="line">    <span class="comment"># 3.密文转为16进制输出</span></span><br><span class="line">    bin_group_4 = re.findall(<span class="string">r&#x27;.&#123;4&#125;&#x27;</span>, bin_ciphertext)</span><br><span class="line">    hex_ciphertext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> bin_group_4:</span><br><span class="line">        hex_ciphertext += <span class="built_in">format</span>(<span class="built_in">int</span>(g, <span class="number">2</span>), <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_decrypt</span>(<span class="params">hex_ciphertext, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;DES解密&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.16进制密文转为2进制字符串</span></span><br><span class="line">    bin_ciphertext = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">bin</span>(<span class="built_in">int</span>(h, <span class="number">16</span>))[<span class="number">2</span>:].zfill(<span class="number">4</span>) <span class="keyword">for</span> h <span class="keyword">in</span> hex_ciphertext)</span><br><span class="line">    <span class="comment"># 2.进行64位分组解密</span></span><br><span class="line">    bin_group_64 = re.findall(<span class="string">r&#x27;.&#123;64&#125;&#x27;</span>, bin_ciphertext)</span><br><span class="line">    bin_deciphertext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> bin_group_64:</span><br><span class="line">        bin_deciphertext += des_cipher(g, str2bin(key), reverse_keys=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 3.将解密密文转为字符串输出</span></span><br><span class="line">    <span class="keyword">return</span> bin2str(bin_deciphertext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_run</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;DES启动界面&quot;&quot;&quot;</span></span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">3</span>, <span class="string">&quot;DES加密解密&quot;</span>, <span class="string">&#x27;=&#x27;</span> * <span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[1]加密&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[2]解密&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[0]退出&#x27;</span>)</span><br><span class="line">        choice = <span class="built_in">input</span>(<span class="string">&#x27;请输入你的选择：&#x27;</span>)</span><br><span class="line">        <span class="keyword">match</span> choice:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                plaintext = <span class="built_in">input</span>(<span class="string">&#x27;请输入明文:&#x27;</span>)</span><br><span class="line">                key = <span class="built_in">input</span>(<span class="string">&#x27;请输入密钥(64bit):&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> is_valid_key(key):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;密钥长度错误&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                ciphertext = des_encrypt(plaintext, key)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;密文:<span class="subst">&#123;ciphertext&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">                ciphertext = <span class="built_in">input</span>(<span class="string">&#x27;请输入密文:&#x27;</span>)</span><br><span class="line">                key = <span class="built_in">input</span>(<span class="string">&#x27;请输入密钥(64bit):&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> is_valid_key(key):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;密钥长度错误&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;解密:<span class="subst">&#123;des_decrypt(ciphertext, key)&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">case</span> _:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;输入错误&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    des_run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="CRC64"><a href="#CRC64" class="headerlink" title="CRC64"></a>CRC64</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/256487370">CRC校验原理及实现 - 知乎</a></p>
<p>循环冗余校验（Cyclic Redundancy Check， CRC）是一种根据网络数据包或计算机文件等数据产生简短固定位数校验码的一种信道编码技术，主要用来检测或校验数据传输或者保存后可能出现的错误。</p>
<p>本质就是一种多项式除法，把原二进制与一个另一个二进制以多项式的形式相除，最后把余数添加到数据末尾用于检验。</p>
<p>我们可以用赛博厨师计算crc的值。</p>
<h4 id="解密脚本-特征"><a href="#解密脚本-特征" class="headerlink" title="解密脚本(特征)"></a>解密脚本(特征)</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shld</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a1 &lt;&lt; <span class="number">1</span>) | (a2 &gt;&gt; <span class="number">31</span>)) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shl</span>(<span class="params">a1</span>):</span><br><span class="line">    <span class="keyword">return</span> (a1 &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shr</span>(<span class="params">a1</span>):</span><br><span class="line">    <span class="keyword">return</span> (a1 &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>):</span><br><span class="line">        ta = buf[i]</span><br><span class="line">        tb = buf[i + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ta &amp; <span class="number">1</span>):</span><br><span class="line">                ta = (<span class="number">0x54AA4A9</span> ^ ta) &amp; <span class="number">0xffffffff</span></span><br><span class="line">                ta = shr(ta) | ((tb &amp; <span class="number">1</span>) &lt;&lt; <span class="number">31</span>)</span><br><span class="line"></span><br><span class="line">                tb = shr(tb) | (<span class="number">1</span> &lt;&lt; <span class="number">31</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ta = shr(ta) | ((tb &amp; <span class="number">1</span>) &lt;&lt; <span class="number">31</span>)</span><br><span class="line"></span><br><span class="line">                tb = shr(tb)</span><br><span class="line">        buf[i] = ta</span><br><span class="line">        buf[i + <span class="number">1</span>] = tb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = [<span class="number">0x149b24c1</span>, <span class="number">0xbc17996</span>, <span class="number">0x192ce051</span>, <span class="number">0x1666bae6</span>, <span class="number">0xf0f13109</span>, <span class="number">0x713168a1</span>, <span class="number">0xcc4fa796</span>, <span class="number">0x9d5344d9</span>, <span class="number">0x623329f6</span>, <span class="number">0x5e22b5da</span>]</span><br><span class="line">    de(flag)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]), end=<span class="string">&#x27;, &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    flag = <span class="string">b&#x27;&#x27;</span>.join(struct.pack(<span class="string">&quot;&lt;I&quot;</span>, i) <span class="keyword">for</span> i <span class="keyword">in</span> flag)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="crc32"><a href="#crc32" class="headerlink" title="crc32"></a>crc32</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>  </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CRC32_POLYNOMIAL 0xEDB88320  </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> crc32_table[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">generate_crc32_table</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> crc;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        crc = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crc &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                crc = (crc &gt;&gt; <span class="number">1</span>) ^ CRC32_POLYNOMIAL;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                crc &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        crc32_table[i] = crc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">crc32</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> length)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> crc = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        crc = (crc &gt;&gt; <span class="number">8</span>) ^ crc32_table[(crc ^ data[i]) &amp; <span class="number">0xFF</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> crc ^ <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> data[<span class="number">100</span>] = &#123;&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> result[<span class="number">10</span>];</span><br><span class="line">    result[<span class="number">0</span>] = crc32(data, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%2x&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><ul>
<li>数据摘要算法，可以理解为有损压缩</li>
<li>因此，hash不可逆，所以如果解题遇到hash基本以算法识别+撞库为主</li>
<li>md5、sha1、sha256、sha384、sha512等等</li>
<li>加密过程有大量移位操作且不可逆</li>
</ul>
<h4 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h4><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1am4y1n73T?spm_id_from=333.788.videopod.sections&vd_source=7b352c7cd2bdf055df2dc80c7bf5002c">演示动画</a></p>
<p>特征常量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">67452301</span>h</span><br><span class="line"><span class="number">0</span>EFCDAB89h</span><br><span class="line"><span class="number">98B</span>ADCFEh </span><br><span class="line"><span class="number">10325476</span>h</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>* POINTER; <span class="comment">//指针类型定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> state[<span class="number">4</span>];                                   <span class="comment">/* A,B,C,D四个常数 */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> count[<span class="number">2</span>];        <span class="comment">/* 数据的bit数计数器(对2^64取余) */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> buffer[<span class="number">64</span>];                         <span class="comment">/* 输入数据缓冲区 */</span></span><br><span class="line">&#125; MD5_CTX; <span class="comment">//存放MD5算法相关信息的结构体定义</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Init</span><span class="params">(MD5_CTX*)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Update</span><span class="params">(MD5_CTX*, <span class="type">unsigned</span> <span class="type">char</span>*, <span class="type">unsigned</span> <span class="type">int</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Final</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>[<span class="number">16</span>], MD5_CTX*)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Transform</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>[<span class="number">4</span>], <span class="type">unsigned</span> <span class="type">char</span>[<span class="number">64</span>])</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Encode</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>*, <span class="type">unsigned</span> <span class="type">int</span>*, <span class="type">unsigned</span> <span class="type">int</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Decode</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>*, <span class="type">unsigned</span> <span class="type">char</span>*, <span class="type">unsigned</span> <span class="type">int</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环左移的位数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S11 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S12 12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S13 17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S14 22</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S21 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S22 9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S23 14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S24 20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S31 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S32 11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S33 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S34 23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S41 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S42 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S43 15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> S44 21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//数据填充的内容</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> PADDING[<span class="number">64</span>] = &#123;</span><br><span class="line">  <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//F,G,H,I四个非线性变换函数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> F(x, y, z) (((x) &amp; (y)) | ((~x) &amp; (z)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> G(x, y, z) (((x) &amp; (z)) | ((y) &amp; (~z)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> H(x, y, z) ((x) ^ (y) ^ (z))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I(x, y, z) ((y) ^ ((x) | (~z)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//x循环左移n位的操作</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTATE_LEFT(x, n) (((x) <span class="string">&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32-(n))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//FF,GG,HH,II是四轮循环变换分别用到的变换函数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FF(a, b, c, d, x, s, ac) &#123; \</span></span><br><span class="line"><span class="meta"> (a) += F ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span></span><br><span class="line"><span class="meta"> (a) = ROTATE_LEFT ((a), (s)); \</span></span><br><span class="line"><span class="meta"> (a) += (b); \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GG(a, b, c, d, x, s, ac) &#123; \</span></span><br><span class="line"><span class="meta"> (a) += G ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span></span><br><span class="line"><span class="meta"> (a) = ROTATE_LEFT ((a), (s)); \</span></span><br><span class="line"><span class="meta"> (a) += (b); \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HH(a, b, c, d, x, s, ac) &#123; \</span></span><br><span class="line"><span class="meta"> (a) += H ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span></span><br><span class="line"><span class="meta"> (a) = ROTATE_LEFT ((a), (s)); \</span></span><br><span class="line"><span class="meta"> (a) += (b); \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> II(a, b, c, d, x, s, ac) &#123; \</span></span><br><span class="line"><span class="meta"> (a) += I ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span></span><br><span class="line"><span class="meta"> (a) = ROTATE_LEFT ((a), (s)); \</span></span><br><span class="line"><span class="meta"> (a) += (b); \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MD5算法初始化操作</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Init</span><span class="params">(MD5_CTX* context)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//bit计数器清零</span></span><br><span class="line">	context-&gt;count[<span class="number">0</span>] = context-&gt;count[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//A,B,C,D被初始化为四个特定的常数(Magic Number)</span></span><br><span class="line">	context-&gt;state[<span class="number">0</span>] = <span class="number">0x67452301</span>;</span><br><span class="line">	context-&gt;state[<span class="number">1</span>] = <span class="number">0xefcdab89</span>;</span><br><span class="line">	context-&gt;state[<span class="number">2</span>] = <span class="number">0x98badcfe</span>;</span><br><span class="line">	context-&gt;state[<span class="number">3</span>] = <span class="number">0x10325476</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用MD5算法对input的数据进行处理</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Update</span><span class="params">(MD5_CTX* context, <span class="type">unsigned</span> <span class="type">char</span>* input, <span class="type">unsigned</span> <span class="type">int</span> inputLen)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i, index, partLen;</span><br><span class="line">	<span class="comment">//计算[已处理数据长度(byte) mod 64]</span></span><br><span class="line">	index = (<span class="type">unsigned</span> <span class="type">int</span>)((context-&gt;count[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x3F</span>);</span><br><span class="line">	<span class="comment">//bit计数器累加</span></span><br><span class="line">	<span class="keyword">if</span> ((context-&gt;count[<span class="number">0</span>] += ((<span class="type">unsigned</span> <span class="type">int</span>)inputLen &lt;&lt; <span class="number">3</span>))</span><br><span class="line">		&lt; ((<span class="type">unsigned</span> <span class="type">int</span>)inputLen &lt;&lt; <span class="number">3</span>)) <span class="comment">//处理加法进位溢出的情况</span></span><br><span class="line">		context-&gt;count[<span class="number">1</span>]++;</span><br><span class="line">	context-&gt;count[<span class="number">1</span>] += ((<span class="type">unsigned</span> <span class="type">int</span>)inputLen &gt;&gt; <span class="number">29</span>);</span><br><span class="line">	<span class="comment">//计算缓冲区还有多少字节空间</span></span><br><span class="line">	partLen = <span class="number">64</span> - index;</span><br><span class="line">	<span class="comment">//以512位数据为一组进行处理</span></span><br><span class="line">	<span class="keyword">if</span> (inputLen &gt;= partLen) &#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;context-&gt;buffer[index], input, partLen);</span><br><span class="line">		MD5Transform(context-&gt;state, context-&gt;buffer);</span><br><span class="line">		<span class="keyword">for</span> (i = partLen; i + <span class="number">63</span> &lt; inputLen; i += <span class="number">64</span>)</span><br><span class="line">			MD5Transform(context-&gt;state, &amp;input[i]);</span><br><span class="line">		index = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//缓存未处理的输入</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;context-&gt;buffer[index], &amp;input[i], inputLen - i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取MD5码（由digest返回），顺便清除context数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Final</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> digest[<span class="number">16</span>], MD5_CTX* context)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> bits[<span class="number">8</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> index, padLen;</span><br><span class="line">	<span class="comment">//记录数据长度</span></span><br><span class="line">	Encode(bits, context-&gt;count, <span class="number">8</span>);</span><br><span class="line">	<span class="comment">//填充数据</span></span><br><span class="line">	index = (<span class="type">unsigned</span> <span class="type">int</span>)((context-&gt;count[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x3f</span>);</span><br><span class="line">	padLen = (index &lt; <span class="number">56</span>) ? (<span class="number">56</span> - index) : (<span class="number">120</span> - index);</span><br><span class="line">	MD5Update(context, PADDING, padLen);</span><br><span class="line">	<span class="comment">//追加数据长度信息</span></span><br><span class="line">	MD5Update(context, bits, <span class="number">8</span>);</span><br><span class="line">	<span class="comment">//获取MD5码。其实就是将ABCD四个32位整数以16进制方式级联</span></span><br><span class="line">	Encode(digest, context-&gt;state, <span class="number">16</span>);</span><br><span class="line">	<span class="comment">//清除数据</span></span><br><span class="line">	<span class="built_in">memset</span>(context, <span class="number">0</span>, <span class="keyword">sizeof</span>(*context));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MD5变换函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MD5Transform</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> state[<span class="number">4</span>], <span class="type">unsigned</span> <span class="type">char</span> block[<span class="number">64</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> a = state[<span class="number">0</span>], b = state[<span class="number">1</span>], c = state[<span class="number">2</span>], d = state[<span class="number">3</span>], x[<span class="number">16</span>];</span><br><span class="line">	<span class="comment">//将64字节的一组数据进一步划分为16个子分组</span></span><br><span class="line">	Decode(x, block, <span class="number">64</span>);</span><br><span class="line">	<span class="comment">//第1轮循环变换</span></span><br><span class="line">	FF(a, b, c, d, x[<span class="number">0</span>], S11, <span class="number">0xd76aa478</span>); <span class="comment">/* 1 */</span></span><br><span class="line">	FF(d, a, b, c, x[<span class="number">1</span>], S12, <span class="number">0xe8c7b756</span>); <span class="comment">/* 2 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">2</span>], S13, <span class="number">0x242070db</span>); <span class="comment">/* 3 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">3</span>], S14, <span class="number">0xc1bdceee</span>); <span class="comment">/* 4 */</span></span><br><span class="line">	FF(a, b, c, d, x[<span class="number">4</span>], S11, <span class="number">0xf57c0faf</span>); <span class="comment">/* 5 */</span></span><br><span class="line">	FF(d, a, b, c, x[<span class="number">5</span>], S12, <span class="number">0x4787c62a</span>); <span class="comment">/* 6 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">6</span>], S13, <span class="number">0xa8304613</span>); <span class="comment">/* 7 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">7</span>], S14, <span class="number">0xfd469501</span>); <span class="comment">/* 8 */</span></span><br><span class="line">	FF(a, b, c, d, x[<span class="number">8</span>], S11, <span class="number">0x698098d8</span>); <span class="comment">/* 9 */</span></span><br><span class="line">	FF(d, a, b, c, x[<span class="number">9</span>], S12, <span class="number">0x8b44f7af</span>); <span class="comment">/* 10 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">10</span>], S13, <span class="number">0xffff5bb1</span>); <span class="comment">/* 11 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">11</span>], S14, <span class="number">0x895cd7be</span>); <span class="comment">/* 12 */</span></span><br><span class="line">	FF(a, b, c, d, x[<span class="number">12</span>], S11, <span class="number">0x6b901122</span>); <span class="comment">/* 13 */</span></span><br><span class="line">	FF(d, a, b, c, x[<span class="number">13</span>], S12, <span class="number">0xfd987193</span>); <span class="comment">/* 14 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">14</span>], S13, <span class="number">0xa679438e</span>); <span class="comment">/* 15 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">15</span>], S14, <span class="number">0x49b40821</span>); <span class="comment">/* 16 */</span></span><br><span class="line">	<span class="comment">//第2轮循环变换</span></span><br><span class="line">	GG(a, b, c, d, x[<span class="number">1</span>], S21, <span class="number">0xf61e2562</span>); <span class="comment">/* 17 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">6</span>], S22, <span class="number">0xc040b340</span>); <span class="comment">/* 18 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">11</span>], S23, <span class="number">0x265e5a51</span>); <span class="comment">/* 19 */</span></span><br><span class="line">	GG(b, c, d, a, x[<span class="number">0</span>], S24, <span class="number">0xe9b6c7aa</span>); <span class="comment">/* 20 */</span></span><br><span class="line">	GG(a, b, c, d, x[<span class="number">5</span>], S21, <span class="number">0xd62f105d</span>); <span class="comment">/* 21 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">10</span>], S22, <span class="number">0x2441453</span>); <span class="comment">/* 22 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">15</span>], S23, <span class="number">0xd8a1e681</span>); <span class="comment">/* 23 */</span></span><br><span class="line">	GG(b, c, d, a, x[<span class="number">4</span>], S24, <span class="number">0xe7d3fbc8</span>); <span class="comment">/* 24 */</span></span><br><span class="line">	GG(a, b, c, d, x[<span class="number">9</span>], S21, <span class="number">0x21e1cde6</span>); <span class="comment">/* 25 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">14</span>], S22, <span class="number">0xc33707d6</span>); <span class="comment">/* 26 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">3</span>], S23, <span class="number">0xf4d50d87</span>); <span class="comment">/* 27 */</span></span><br><span class="line">	GG(b, c, d, a, x[<span class="number">8</span>], S24, <span class="number">0x455a14ed</span>); <span class="comment">/* 28 */</span></span><br><span class="line">	GG(a, b, c, d, x[<span class="number">13</span>], S21, <span class="number">0xa9e3e905</span>); <span class="comment">/* 29 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">2</span>], S22, <span class="number">0xfcefa3f8</span>); <span class="comment">/* 30 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">7</span>], S23, <span class="number">0x676f02d9</span>); <span class="comment">/* 31 */</span></span><br><span class="line">	GG(b, c, d, a, x[<span class="number">12</span>], S24, <span class="number">0x8d2a4c8a</span>); <span class="comment">/* 32 */</span></span><br><span class="line">	<span class="comment">//第3轮循环变换</span></span><br><span class="line">	HH(a, b, c, d, x[<span class="number">5</span>], S31, <span class="number">0xfffa3942</span>); <span class="comment">/* 33 */</span></span><br><span class="line">	HH(d, a, b, c, x[<span class="number">8</span>], S32, <span class="number">0x8771f681</span>); <span class="comment">/* 34 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">11</span>], S33, <span class="number">0x6d9d6122</span>); <span class="comment">/* 35 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">14</span>], S34, <span class="number">0xfde5380c</span>); <span class="comment">/* 36 */</span></span><br><span class="line">	HH(a, b, c, d, x[<span class="number">1</span>], S31, <span class="number">0xa4beea44</span>); <span class="comment">/* 37 */</span></span><br><span class="line">	HH(d, a, b, c, x[<span class="number">4</span>], S32, <span class="number">0x4bdecfa9</span>); <span class="comment">/* 38 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">7</span>], S33, <span class="number">0xf6bb4b60</span>); <span class="comment">/* 39 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">10</span>], S34, <span class="number">0xbebfbc70</span>); <span class="comment">/* 40 */</span></span><br><span class="line">	HH(a, b, c, d, x[<span class="number">13</span>], S31, <span class="number">0x289b7ec6</span>); <span class="comment">/* 41 */</span></span><br><span class="line">	HH(d, a, b, c, x[<span class="number">0</span>], S32, <span class="number">0xeaa127fa</span>); <span class="comment">/* 42 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">3</span>], S33, <span class="number">0xd4ef3085</span>); <span class="comment">/* 43 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">6</span>], S34, <span class="number">0x4881d05</span>); <span class="comment">/* 44 */</span></span><br><span class="line">	HH(a, b, c, d, x[<span class="number">9</span>], S31, <span class="number">0xd9d4d039</span>); <span class="comment">/* 45 */</span></span><br><span class="line">	HH(d, a, b, c, x[<span class="number">12</span>], S32, <span class="number">0xe6db99e5</span>); <span class="comment">/* 46 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">15</span>], S33, <span class="number">0x1fa27cf8</span>); <span class="comment">/* 47 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">2</span>], S34, <span class="number">0xc4ac5665</span>); <span class="comment">/* 48 */</span></span><br><span class="line">	<span class="comment">//第4轮循环变换</span></span><br><span class="line">	II(a, b, c, d, x[<span class="number">0</span>], S41, <span class="number">0xf4292244</span>); <span class="comment">/* 49 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">7</span>], S42, <span class="number">0x432aff97</span>); <span class="comment">/* 50 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">14</span>], S43, <span class="number">0xab9423a7</span>); <span class="comment">/* 51 */</span></span><br><span class="line">	II(b, c, d, a, x[<span class="number">5</span>], S44, <span class="number">0xfc93a039</span>); <span class="comment">/* 52 */</span></span><br><span class="line">	II(a, b, c, d, x[<span class="number">12</span>], S41, <span class="number">0x655b59c3</span>); <span class="comment">/* 53 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">3</span>], S42, <span class="number">0x8f0ccc92</span>); <span class="comment">/* 54 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">10</span>], S43, <span class="number">0xffeff47d</span>); <span class="comment">/* 55 */</span></span><br><span class="line">	II(b, c, d, a, x[<span class="number">1</span>], S44, <span class="number">0x85845dd1</span>); <span class="comment">/* 56 */</span></span><br><span class="line">	II(a, b, c, d, x[<span class="number">8</span>], S41, <span class="number">0x6fa87e4f</span>); <span class="comment">/* 57 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">15</span>], S42, <span class="number">0xfe2ce6e0</span>); <span class="comment">/* 58 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">6</span>], S43, <span class="number">0xa3014314</span>); <span class="comment">/* 59 */</span></span><br><span class="line">	II(b, c, d, a, x[<span class="number">13</span>], S44, <span class="number">0x4e0811a1</span>); <span class="comment">/* 60 */</span></span><br><span class="line">	II(a, b, c, d, x[<span class="number">4</span>], S41, <span class="number">0xf7537e82</span>); <span class="comment">/* 61 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">11</span>], S42, <span class="number">0xbd3af235</span>); <span class="comment">/* 62 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">2</span>], S43, <span class="number">0x2ad7d2bb</span>); <span class="comment">/* 63 */</span></span><br><span class="line">	II(b, c, d, a, x[<span class="number">9</span>], S44, <span class="number">0xeb86d391</span>); <span class="comment">/* 64 */</span></span><br><span class="line"></span><br><span class="line">	state[<span class="number">0</span>] += a;</span><br><span class="line">	state[<span class="number">1</span>] += b;</span><br><span class="line">	state[<span class="number">2</span>] += c;</span><br><span class="line">	state[<span class="number">3</span>] += d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将无符号整数转为字节类型数组</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Encode</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* output, <span class="type">unsigned</span> <span class="type">int</span>* input, <span class="type">unsigned</span> <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; j &lt; len; i++, j += <span class="number">4</span>) &#123;</span><br><span class="line">		output[j] = (<span class="type">unsigned</span> <span class="type">char</span>)(input[i] &amp; <span class="number">0xff</span>);</span><br><span class="line">		output[j + <span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)((input[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">		output[j + <span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)((input[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">		output[j + <span class="number">3</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)((input[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将字节类型数组转为无符号整数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Decode</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* output, <span class="type">unsigned</span> <span class="type">char</span>* input, <span class="type">unsigned</span> <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; j &lt; len; i++, j += <span class="number">4</span>)</span><br><span class="line">		output[i] = ((<span class="type">unsigned</span> <span class="type">int</span>)input[j]) | (((<span class="type">unsigned</span> <span class="type">int</span>)input[j + <span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		(((<span class="type">unsigned</span> <span class="type">int</span>)input[j + <span class="number">2</span>]) &lt;&lt; <span class="number">16</span>) | (((<span class="type">unsigned</span> <span class="type">int</span>)input[j + <span class="number">3</span>]) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	MD5_CTX md5_calc;</span><br><span class="line">	<span class="comment">//char c[] = &#123; 0,0,0,4,0,0,0,2,0,0,0,125&#125;;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> c[] = &#123; <span class="number">0x00000007</span>, <span class="number">0x00000002</span>, <span class="number">0x0000007D</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> md5[<span class="number">16</span>];</span><br><span class="line">	<span class="comment">//演示计算字符串abc的MD5码</span></span><br><span class="line">	MD5Init(&amp;md5_calc);</span><br><span class="line">	MD5Update(&amp;md5_calc, (<span class="type">unsigned</span> <span class="type">char</span>*)c, <span class="number">12</span>);</span><br><span class="line">	MD5Final(md5, &amp;md5_calc);</span><br><span class="line">	<span class="comment">//输出MD5码</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">		md5[i] ^= <span class="number">0x14</span>;</span><br><span class="line">		md5[i] ^= <span class="number">0x11</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;字符串abc的MD5码为：&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, md5[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="skip32"><a href="#skip32" class="headerlink" title="skip32"></a>skip32</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">FTABLE = (<span class="number">0xa3</span>, <span class="number">0xd7</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0xf8</span>, <span class="number">0x48</span>, <span class="number">0xf6</span>, <span class="number">0xf4</span>,</span><br><span class="line">          <span class="number">0xb3</span>, <span class="number">0x21</span>, <span class="number">0x15</span>, <span class="number">0x78</span>, <span class="number">0x99</span>, <span class="number">0xb1</span>, <span class="number">0xaf</span>, <span class="number">0xf9</span>,</span><br><span class="line">          <span class="number">0xe7</span>, <span class="number">0x2d</span>, <span class="number">0x4d</span>, <span class="number">0x8a</span>, <span class="number">0xce</span>, <span class="number">0x4c</span>, <span class="number">0xca</span>, <span class="number">0x2e</span>,</span><br><span class="line">          <span class="number">0x52</span>, <span class="number">0x95</span>, <span class="number">0xd9</span>, <span class="number">0x1e</span>, <span class="number">0x4e</span>, <span class="number">0x38</span>, <span class="number">0x44</span>, <span class="number">0x28</span>,</span><br><span class="line">          <span class="number">0x0a</span>, <span class="number">0xdf</span>, <span class="number">0x02</span>, <span class="number">0xa0</span>, <span class="number">0x17</span>, <span class="number">0xf1</span>, <span class="number">0x60</span>, <span class="number">0x68</span>,</span><br><span class="line">          <span class="number">0x12</span>, <span class="number">0xb7</span>, <span class="number">0x7a</span>, <span class="number">0xc3</span>, <span class="number">0xe9</span>, <span class="number">0xfa</span>, <span class="number">0x3d</span>, <span class="number">0x53</span>,</span><br><span class="line">          <span class="number">0x96</span>, <span class="number">0x84</span>, <span class="number">0x6b</span>, <span class="number">0xba</span>, <span class="number">0xf2</span>, <span class="number">0x63</span>, <span class="number">0x9a</span>, <span class="number">0x19</span>,</span><br><span class="line">          <span class="number">0x7c</span>, <span class="number">0xae</span>, <span class="number">0xe5</span>, <span class="number">0xf5</span>, <span class="number">0xf7</span>, <span class="number">0x16</span>, <span class="number">0x6a</span>, <span class="number">0xa2</span>,</span><br><span class="line">          <span class="number">0x39</span>, <span class="number">0xb6</span>, <span class="number">0x7b</span>, <span class="number">0x0f</span>, <span class="number">0xc1</span>, <span class="number">0x93</span>, <span class="number">0x81</span>, <span class="number">0x1b</span>,</span><br><span class="line">          <span class="number">0xee</span>, <span class="number">0xb4</span>, <span class="number">0x1a</span>, <span class="number">0xea</span>, <span class="number">0xd0</span>, <span class="number">0x91</span>, <span class="number">0x2f</span>, <span class="number">0xb8</span>,</span><br><span class="line">          <span class="number">0x55</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x85</span>, <span class="number">0x3f</span>, <span class="number">0x41</span>, <span class="number">0xbf</span>, <span class="number">0xe0</span>,</span><br><span class="line">          <span class="number">0x5a</span>, <span class="number">0x58</span>, <span class="number">0x80</span>, <span class="number">0x5f</span>, <span class="number">0x66</span>, <span class="number">0x0b</span>, <span class="number">0xd8</span>, <span class="number">0x90</span>,</span><br><span class="line">          <span class="number">0x35</span>, <span class="number">0xd5</span>, <span class="number">0xc0</span>, <span class="number">0xa7</span>, <span class="number">0x33</span>, <span class="number">0x06</span>, <span class="number">0x65</span>, <span class="number">0x69</span>,</span><br><span class="line">          <span class="number">0x45</span>, <span class="number">0x00</span>, <span class="number">0x94</span>, <span class="number">0x56</span>, <span class="number">0x6d</span>, <span class="number">0x98</span>, <span class="number">0x9b</span>, <span class="number">0x76</span>,</span><br><span class="line">          <span class="number">0x97</span>, <span class="number">0xfc</span>, <span class="number">0xb2</span>, <span class="number">0xc2</span>, <span class="number">0xb0</span>, <span class="number">0xfe</span>, <span class="number">0xdb</span>, <span class="number">0x20</span>,</span><br><span class="line">          <span class="number">0xe1</span>, <span class="number">0xeb</span>, <span class="number">0xd6</span>, <span class="number">0xe4</span>, <span class="number">0xdd</span>, <span class="number">0x47</span>, <span class="number">0x4a</span>, <span class="number">0x1d</span>,</span><br><span class="line">          <span class="number">0x42</span>, <span class="number">0xed</span>, <span class="number">0x9e</span>, <span class="number">0x6e</span>, <span class="number">0x49</span>, <span class="number">0x3c</span>, <span class="number">0xcd</span>, <span class="number">0x43</span>,</span><br><span class="line">          <span class="number">0x27</span>, <span class="number">0xd2</span>, <span class="number">0x07</span>, <span class="number">0xd4</span>, <span class="number">0xde</span>, <span class="number">0xc7</span>, <span class="number">0x67</span>, <span class="number">0x18</span>,</span><br><span class="line">          <span class="number">0x89</span>, <span class="number">0xcb</span>, <span class="number">0x30</span>, <span class="number">0x1f</span>, <span class="number">0x8d</span>, <span class="number">0xc6</span>, <span class="number">0x8f</span>, <span class="number">0xaa</span>,</span><br><span class="line">          <span class="number">0xc8</span>, <span class="number">0x74</span>, <span class="number">0xdc</span>, <span class="number">0xc9</span>, <span class="number">0x5d</span>, <span class="number">0x5c</span>, <span class="number">0x31</span>, <span class="number">0xa4</span>,</span><br><span class="line">          <span class="number">0x70</span>, <span class="number">0x88</span>, <span class="number">0x61</span>, <span class="number">0x2c</span>, <span class="number">0x9f</span>, <span class="number">0x0d</span>, <span class="number">0x2b</span>, <span class="number">0x87</span>,</span><br><span class="line">          <span class="number">0x50</span>, <span class="number">0x82</span>, <span class="number">0x54</span>, <span class="number">0x64</span>, <span class="number">0x26</span>, <span class="number">0x7d</span>, <span class="number">0x03</span>, <span class="number">0x40</span>,</span><br><span class="line">          <span class="number">0x34</span>, <span class="number">0x4b</span>, <span class="number">0x1c</span>, <span class="number">0x73</span>, <span class="number">0xd1</span>, <span class="number">0xc4</span>, <span class="number">0xfd</span>, <span class="number">0x3b</span>,</span><br><span class="line">          <span class="number">0xcc</span>, <span class="number">0xfb</span>, <span class="number">0x7f</span>, <span class="number">0xab</span>, <span class="number">0xe6</span>, <span class="number">0x3e</span>, <span class="number">0x5b</span>, <span class="number">0xa5</span>,</span><br><span class="line">          <span class="number">0xad</span>, <span class="number">0x04</span>, <span class="number">0x23</span>, <span class="number">0x9c</span>, <span class="number">0x14</span>, <span class="number">0x51</span>, <span class="number">0x22</span>, <span class="number">0xf0</span>,</span><br><span class="line">          <span class="number">0x29</span>, <span class="number">0x79</span>, <span class="number">0x71</span>, <span class="number">0x7e</span>, <span class="number">0xff</span>, <span class="number">0x8c</span>, <span class="number">0x0e</span>, <span class="number">0xe2</span>,</span><br><span class="line">          <span class="number">0x0c</span>, <span class="number">0xef</span>, <span class="number">0xbc</span>, <span class="number">0x72</span>, <span class="number">0x75</span>, <span class="number">0x6f</span>, <span class="number">0x37</span>, <span class="number">0xa1</span>,</span><br><span class="line">          <span class="number">0xec</span>, <span class="number">0xd3</span>, <span class="number">0x8e</span>, <span class="number">0x62</span>, <span class="number">0x8b</span>, <span class="number">0x86</span>, <span class="number">0x10</span>, <span class="number">0xe8</span>,</span><br><span class="line">          <span class="number">0x08</span>, <span class="number">0x77</span>, <span class="number">0x11</span>, <span class="number">0xbe</span>, <span class="number">0x92</span>, <span class="number">0x4f</span>, <span class="number">0x24</span>, <span class="number">0xc5</span>,</span><br><span class="line">          <span class="number">0x32</span>, <span class="number">0x36</span>, <span class="number">0x9d</span>, <span class="number">0xcf</span>, <span class="number">0xf3</span>, <span class="number">0xa6</span>, <span class="number">0xbb</span>, <span class="number">0xac</span>,</span><br><span class="line">          <span class="number">0x5e</span>, <span class="number">0x6c</span>, <span class="number">0xa9</span>, <span class="number">0x13</span>, <span class="number">0x57</span>, <span class="number">0x25</span>, <span class="number">0xb5</span>, <span class="number">0xe3</span>,</span><br><span class="line">          <span class="number">0xbd</span>, <span class="number">0xa8</span>, <span class="number">0x3a</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x59</span>, <span class="number">0x2a</span>, <span class="number">0x46</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">key, k, w</span>):</span><br><span class="line">    g1 = <span class="number">0xFF</span> &amp; (w &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    g2 = <span class="number">0xFF</span> &amp; w</span><br><span class="line"></span><br><span class="line">    g3 = FTABLE[g2 ^ key[(<span class="number">4</span> * k + <span class="number">0</span>) % <span class="number">10</span>]] ^ g1</span><br><span class="line">    g4 = FTABLE[g3 ^ key[(<span class="number">4</span> * k + <span class="number">1</span>) % <span class="number">10</span>]] ^ g2</span><br><span class="line">    g5 = FTABLE[g4 ^ key[(<span class="number">4</span> * k + <span class="number">2</span>) % <span class="number">10</span>]] ^ g3</span><br><span class="line">    g6 = FTABLE[g5 ^ key[(<span class="number">4</span> * k + <span class="number">3</span>) % <span class="number">10</span>]] ^ g4</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ((g5 &lt;&lt; <span class="number">8</span>) + g6)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">skip32</span>(<span class="params">key, buf, encrypt</span>):</span><br><span class="line">    <span class="comment"># sort out direction</span></span><br><span class="line">    <span class="keyword">if</span> encrypt:</span><br><span class="line">        k, step = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k, step = <span class="number">23</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># pack into words</span></span><br><span class="line">    wl = (buf[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">1</span>]</span><br><span class="line">    wr = (buf[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 24 feistel rounds, doubled up</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        wr ^= g(key, k, wl) ^ k</span><br><span class="line">        k += step</span><br><span class="line">        wl ^= g(key, k, wr) ^ k</span><br><span class="line">        k += step</span><br><span class="line"></span><br><span class="line">    <span class="comment"># implicitly swap halves while unpacking</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>((wr &gt;&gt; <span class="number">8</span>, wr &amp; <span class="number">0xFF</span>,</span><br><span class="line">                  wl &gt;&gt; <span class="number">8</span>, wl &amp; <span class="number">0xFF</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Skippy</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(key) &lt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;key must be at least 10 bytes in length&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._key = key</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, value</span>):</span><br><span class="line">        buf = struct.pack(<span class="string">&quot;=I&quot;</span>, value)</span><br><span class="line">        enc = skip32(<span class="variable language_">self</span>._key, buf, <span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> struct.unpack(<span class="string">&quot;=I&quot;</span>, enc)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, value</span>):</span><br><span class="line">        buf = struct.pack(<span class="string">&quot;=I&quot;</span>, value)</span><br><span class="line">        dec = skip32(<span class="variable language_">self</span>._key, buf, <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> struct.unpack(<span class="string">&quot;=I&quot;</span>, dec)[<span class="number">0</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, getPrime</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">p = <span class="number">61</span></span><br><span class="line">q = <span class="number">53</span></span><br><span class="line">n = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;d = <span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">m = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">m2 = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted m = <span class="subst">&#123;m2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gmpxx.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">mpz_class <span class="title">hex_to_mpz</span><span class="params">(<span class="type">const</span> std::string&amp; hex)</span> </span>&#123;</span><br><span class="line">    mpz_class res;</span><br><span class="line">    <span class="built_in">mpz_set_str</span>(res.<span class="built_in">get_mpz_t</span>(), hex.<span class="built_in">c_str</span>(), <span class="number">16</span>); <span class="comment">// base 16</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mpz_class <span class="title">generate_prime</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> bits, gmp_randclass&amp; rng, <span class="type">int</span> trials = <span class="number">25</span>)</span> </span>&#123;</span><br><span class="line">    mpz_class candidate;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        candidate = rng.<span class="built_in">get_z_bits</span>(bits);     <span class="comment">// 生成随机 bits 位数的大整数</span></span><br><span class="line">        <span class="built_in">mpz_setbit</span>(candidate.<span class="built_in">get_mpz_t</span>(), bits - <span class="number">1</span>); <span class="comment">// 确保是 bits 位</span></span><br><span class="line">        <span class="built_in">mpz_setbit</span>(candidate.<span class="built_in">get_mpz_t</span>(), <span class="number">0</span>);        <span class="comment">// 确保是奇数</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">mpz_probab_prime_p</span>(candidate.<span class="built_in">get_mpz_t</span>(), trials) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> candidate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">gmp_randclass <span class="title">rng</span><span class="params">(gmp_randinit_mt)</span></span>;</span><br><span class="line">    rng.<span class="built_in">seed</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    mpz_class p = <span class="built_in">generate_prime</span>(<span class="number">512</span>, rng);</span><br><span class="line">    mpz_class q = <span class="built_in">generate_prime</span>(<span class="number">512</span>, rng);</span><br><span class="line">    mpz_class n = p * q;                   <span class="comment">// n = p * q</span></span><br><span class="line">    mpz_class phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>);     <span class="comment">// phi = (p-1)*(q-1)</span></span><br><span class="line">    mpz_class e = <span class="number">65537</span>;                      <span class="comment">// 常用 e</span></span><br><span class="line">    mpz_class d;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 求模逆 d ≡ e^(-1) mod phi</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">mpz_invert</span>(d.<span class="built_in">get_mpz_t</span>(), e.<span class="built_in">get_mpz_t</span>(), phi.<span class="built_in">get_mpz_t</span>())) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Modular inverse does not exist!\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;n  = &quot;</span> &lt;&lt; n &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;e  = &quot;</span> &lt;&lt; e &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;d  = &quot;</span> &lt;&lt; d &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 明文 m</span></span><br><span class="line">    mpz_class m = <span class="built_in">hex_to_mpz</span>(<span class="string">&quot;1234567890abcdef&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密 c = m^e mod n</span></span><br><span class="line">    mpz_class c;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">mpz_powm</span>(c.<span class="built_in">get_mpz_t</span>(), m.<span class="built_in">get_mpz_t</span>(), e.<span class="built_in">get_mpz_t</span>(), n.<span class="built_in">get_mpz_t</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Encrypted c = &quot;</span> &lt;&lt; c &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密 m2 = c^d mod n</span></span><br><span class="line">    mpz_class m2;</span><br><span class="line">    <span class="built_in">mpz_powm</span>(m<span class="number">2.</span><span class="built_in">get_mpz_t</span>(), c.<span class="built_in">get_mpz_t</span>(), d.<span class="built_in">get_mpz_t</span>(), n.<span class="built_in">get_mpz_t</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Decrypted m = &quot;</span> &lt;&lt; m2 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> r[<span class="number">100</span>];</span><br><span class="line">    __gmpz_get_str(r, <span class="number">16</span>, m<span class="number">2.</span><span class="built_in">get_mpz_t</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Decrypted hex: &quot;</span> &lt;&lt; r &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="opensslEVP签名校验"><a href="#opensslEVP签名校验" class="headerlink" title="opensslEVP签名校验"></a>opensslEVP签名校验</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/evp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/pem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/rsa.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handle_openssl_error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">ERR_print_errors_fp</span>(stderr);</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用智能指针管理 OpenSSL 结构</span></span><br><span class="line"><span class="keyword">using</span> EVP_PKEY_ptr = std::unique_ptr&lt;EVP_PKEY, <span class="keyword">decltype</span>(&amp;EVP_PKEY_free)&gt;;</span><br><span class="line"><span class="keyword">using</span> EVP_MD_CTX_ptr = std::unique_ptr&lt;EVP_MD_CTX, <span class="keyword">decltype</span>(&amp;EVP_MD_CTX_free)&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function">EVP_PKEY_ptr <span class="title">generate_rsa_key</span><span class="params">(<span class="type">int</span> bits = <span class="number">2048</span>)</span> </span>&#123;</span><br><span class="line">    EVP_PKEY_CTX *ctx = <span class="built_in">EVP_PKEY_CTX_new_id</span>(EVP_PKEY_RSA, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!ctx) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_PKEY_keygen_init</span>(ctx) &lt;= <span class="number">0</span>) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_PKEY_CTX_set_rsa_keygen_bits</span>(ctx, bits) &lt;= <span class="number">0</span>) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    EVP_PKEY *raw_pkey = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_PKEY_keygen</span>(ctx, &amp;raw_pkey) &lt;= <span class="number">0</span>) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">EVP_PKEY_CTX_free</span>(ctx);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">EVP_PKEY_ptr</span>(raw_pkey, EVP_PKEY_free);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; <span class="title">sign_message</span><span class="params">(EVP_PKEY *pkey, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *msg, <span class="type">size_t</span> msg_len)</span> </span>&#123;</span><br><span class="line">    <span class="function">EVP_MD_CTX_ptr <span class="title">ctx</span><span class="params">(EVP_MD_CTX_new(), EVP_MD_CTX_free)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!ctx) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestSignInit</span>(ctx.<span class="built_in">get</span>(), <span class="literal">NULL</span>, <span class="built_in">EVP_sha256</span>(), <span class="literal">NULL</span>, pkey) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestSignUpdate</span>(ctx.<span class="built_in">get</span>(), msg, msg_len) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> sig_len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestSignFinal</span>(ctx.<span class="built_in">get</span>(), <span class="literal">NULL</span>, &amp;sig_len) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; <span class="title">signature</span><span class="params">(sig_len)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestSignFinal</span>(ctx.<span class="built_in">get</span>(), signature.<span class="built_in">data</span>(), &amp;sig_len) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    signature.<span class="built_in">resize</span>(sig_len);</span><br><span class="line">    <span class="keyword">return</span> signature;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">verify_signature</span><span class="params">(EVP_PKEY *pkey, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *msg, <span class="type">size_t</span> msg_len,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *sig, <span class="type">size_t</span> sig_len)</span> </span>&#123;</span><br><span class="line">    <span class="function">EVP_MD_CTX_ptr <span class="title">ctx</span><span class="params">(EVP_MD_CTX_new(), EVP_MD_CTX_free)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!ctx) <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestVerifyInit</span>(ctx.<span class="built_in">get</span>(), <span class="literal">NULL</span>, <span class="built_in">EVP_sha256</span>(), <span class="literal">NULL</span>, pkey) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">EVP_DigestVerifyUpdate</span>(ctx.<span class="built_in">get</span>(), msg, msg_len) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">handle_openssl_error</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">EVP_DigestVerifyFinal</span>(ctx.<span class="built_in">get</span>(), sig, sig_len);</span><br><span class="line">    <span class="keyword">return</span> ret == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">save_keys</span><span class="params">(EVP_PKEY *pkey)</span> </span>&#123;</span><br><span class="line">    FILE *fpri = <span class="built_in">fopen</span>(<span class="string">&quot;private.pem&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    FILE *fpub = <span class="built_in">fopen</span>(<span class="string">&quot;public.pem&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!fpri || !fpub) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;无法打开文件保存密钥\n&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PEM_write_PrivateKey</span>(fpri, pkey, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">PEM_write_PUBKEY</span>(fpub, pkey);</span><br><span class="line">    <span class="built_in">fclose</span>(fpri);</span><br><span class="line">    <span class="built_in">fclose</span>(fpub);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">OpenSSL_add_all_algorithms</span>();</span><br><span class="line">    <span class="built_in">ERR_load_crypto_strings</span>();</span><br><span class="line"></span><br><span class="line">    std::string message = <span class="string">&quot;This is a test.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成 RSA 密钥对</span></span><br><span class="line">    EVP_PKEY_ptr key = <span class="built_in">generate_rsa_key</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;[+] 密钥对生成完成\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 签名消息</span></span><br><span class="line">    std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; sig = <span class="built_in">sign_message</span>(key.<span class="built_in">get</span>(),</span><br><span class="line">                                (<span class="type">unsigned</span> <span class="type">char</span> *)message.<span class="built_in">c_str</span>(), message.<span class="built_in">size</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;[+] 签名完成，长度 = &quot;</span> &lt;&lt; sig.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证签名</span></span><br><span class="line">    <span class="type">bool</span> ok = <span class="built_in">verify_signature</span>(key.<span class="built_in">get</span>(),</span><br><span class="line">                               (<span class="type">unsigned</span> <span class="type">char</span> *)message.<span class="built_in">c_str</span>(), message.<span class="built_in">size</span>(),</span><br><span class="line">                               sig.<span class="built_in">data</span>(), sig.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[+] 签名验证成功 ✅\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[!] 签名验证失败 ❌\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存密钥</span></span><br><span class="line">    <span class="built_in">save_keys</span>(key.<span class="built_in">get</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;[+] 密钥对保存为 PEM 文件\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">EVP_cleanup</span>();</span><br><span class="line">    <span class="built_in">CRYPTO_cleanup_all_ex_data</span>();</span><br><span class="line">    <span class="built_in">ERR_free_strings</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">huanghunr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/12/31/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86/">http://example.com/2024/12/31/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86%E3%80%81%E7%BC%96%E7%A0%81/">加解密、编码</a></div><div class="post-share"><div class="social-share" data-image="https://huanghunr-blog.oss-cn-hangzhou.aliyuncs.com/website/img/qiaomi1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/06/%E8%BD%AF%E4%BB%B6%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B/" title="2024软件创新大赛部分Re-wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">2024软件创新大赛部分Re-wp</div></div><div class="info-2"><div class="info-item-1">主函数在start的第一个参数里面。去除如下花指令  一个rc4加密，密钥在第一个生成盒函数的参数里。第二个函数是加密函数，动调密钥会被修改。  在第二个函数的call处下断点动调就可以看到加密函数，进入加密函数后发现花指令，和上面一样的nop掉后可以发现魔改RC4。   我们输入一串字符进行动调，在主函数的unk_5C6CC0中下硬件断点。后面会断在如下位置,这里就是比较的位置。去除这里的花指令后就可以看到逻辑，密文就是上面这些。所有数据都已经拿到，记得把密文转一下端序（见python脚本）,最后还有一个异或0x23。 密文:25cd54af511c58d3a84b4f56ec835dd4f6474a6fe073b0a5a8c317815e2bf4f671ea2fffa8639957 密钥:921C2B1FBAFBA2FF07697D77188C   1234567a = [0x0D3581C51AF54CD25,0x0D45D83EC564F4BA8,0x0A5B073E06F4A47F6,0x0F6F42B5E8117C3A8,0x579963A8FF2FEA71]b=&q...</div></div></div></a><a class="pagination-related" href="/2024/12/25/%E5%9B%BD%E8%B5%9B2024/" title="2024长城杯初赛Re部分复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">2024长城杯初赛Re部分复现</div></div><div class="info-2"><div class="info-item-1">dump原程序是一个命令行工具，需要用命令行参数来进行使用，使用方法是在命令行输入以下命令 1re.exe [data]  我们输入的数据会被加密，我们尝试输入几个字符就可以发现每个字符加密的对应结果是相同的，也就是单字节加密，那么我们就可以输入所有可打印字符得到加密后的结果，再把结果和原字符的数据映射起来就可以依据密文得出明文。 在这里密文被以二进制的形式保存都在flag文件中，我们需要用读文件的方式把密文读入。 脚本如下 在这个脚本中我尝试直接获得可打印字符，但是最后对比了其他人的wp，发现引号是不会被re.exe输出的，也就是如果你把引号也输入进去获取映射表，那么你的获得的映射表就会少一位，导致映射错误。在最后我们会发现还缺少了一个字符，但是base64编码的样子已经出来了，我们手动添加一个字符解码看看规律。  解码后我们会发现很多奇怪的数字，感觉上像是一个时间戳，于是我们过滤掉那些含有符号的结果，最终找到上面的结果，把每个都输入一下就可以发现flag就是(原题中告诉了我们第十三位为4，我们假设不知道，分析数据解决) flag{MTczMDc4MzQ2Ng&#x3D;&#x...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/tx4.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">huanghunr</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/huanghunr"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Base64"><span class="toc-number">1.</span> <span class="toc-text">Base64</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E5%BD%A2%E5%BC%8F%EF%BC%88%E7%89%B9%E5%BE%81%EF%BC%89"><span class="toc-number">1.0.1.</span> <span class="toc-text">一般形式（特征）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Salsa20"><span class="toc-number">2.</span> <span class="toc-text">Salsa20</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">2.1.</span> <span class="toc-text">加解密脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ChaCha20"><span class="toc-number">3.</span> <span class="toc-text">ChaCha20</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC-1"><span class="toc-number">3.1.</span> <span class="toc-text">加解密脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RC4"><span class="toc-number">4.</span> <span class="toc-text">RC4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E5%BD%A2%E5%BC%8F%EF%BC%88%E7%89%B9%E5%BE%81%EF%BC%89-1"><span class="toc-number">4.0.1.</span> <span class="toc-text">一般形式（特征）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TEA"><span class="toc-number">5.</span> <span class="toc-text">TEA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">5.0.1.</span> <span class="toc-text">代码分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%8A%A0%E5%AF%86%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">分组加密的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XTEA"><span class="toc-number">7.</span> <span class="toc-text">XTEA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">7.0.1.</span> <span class="toc-text">代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXTEA"><span class="toc-number">8.</span> <span class="toc-text">XXTEA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-1"><span class="toc-number">8.0.1.</span> <span class="toc-text">代码分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TEA%E7%B3%BB%E5%88%97%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">8.1.</span> <span class="toc-text">TEA系列的特征</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AES"><span class="toc-number">9.</span> <span class="toc-text">AES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC-2"><span class="toc-number">9.0.1.</span> <span class="toc-text">加解密脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SM4"><span class="toc-number">10.</span> <span class="toc-text">SM4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">10.0.1.</span> <span class="toc-text">常用解密脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#blowfish"><span class="toc-number">11.</span> <span class="toc-text">blowfish</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.0.1.</span> <span class="toc-text">代码实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DES"><span class="toc-number">12.</span> <span class="toc-text">DES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">12.0.1.</span> <span class="toc-text">加解密实现代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRC64"><span class="toc-number">13.</span> <span class="toc-text">CRC64</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC-%E7%89%B9%E5%BE%81"><span class="toc-number">13.0.1.</span> <span class="toc-text">解密脚本(特征)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crc32"><span class="toc-number">14.</span> <span class="toc-text">crc32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hash"><span class="toc-number">15.</span> <span class="toc-text">Hash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MD5"><span class="toc-number">15.0.1.</span> <span class="toc-text">MD5</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skip32"><span class="toc-number">16.</span> <span class="toc-text">skip32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA"><span class="toc-number">17.</span> <span class="toc-text">RSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opensslEVP%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C"><span class="toc-number">18.</span> <span class="toc-text">opensslEVP签名校验</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/10/D3CTF2025/" title="D^3CTF2025 Re-wp&amp;复现">D^3CTF2025 Re-wp&amp;复现</a><time datetime="2025-07-09T16:00:00.000Z" title="Created 2025-07-10 00:00:00">2025-07-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/10/r3ctf2025/" title="2025 r3CTF Re-部分复现">2025 r3CTF Re-部分复现</a><time datetime="2025-07-09T16:00:00.000Z" title="Created 2025-07-10 00:00:00">2025-07-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/21/ISCC-re/" title="2025ISCC 复现">2025ISCC 复现</a><time datetime="2025-05-20T16:00:00.000Z" title="Created 2025-05-21 00:00:00">2025-05-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/miniLCTF2025/" title="2025miniLCTF 部分Re-wp+复现">2025miniLCTF 部分Re-wp+复现</a><time datetime="2025-05-18T16:00:00.000Z" title="Created 2025-05-19 00:00:00">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/01/%E7%9F%A9%E9%98%B5%E6%93%8D%E4%BD%9C%E5%AD%A6%E4%B9%A0/" title="矩阵逆向初步学习">矩阵逆向初步学习</a><time datetime="2025-04-30T16:00:00.000Z" title="Created 2025-05-01 00:00:00">2025-05-01</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient( 135deg, #FFD89B 10%, #FCA17D 100%);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By huanghunr</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><span>桂ICP备2024049894号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>